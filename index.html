<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RASSAMA | La plus grande biblioth√®que d'anime</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --rassama-red: #E50914;
            --rassama-dark: #141414;
            --rassama-gray: #333333;
            --rassama-light: #F5F5F5;
            --rassama-accent: #FF6B6B;
            --rassama-blue: #4A90E2;
            --rassama-purple: #9B59B6;
            --rassama-green: #2ECC71;
            --bg-deep: #0A0A0A;
            --bg-card: #1A1A1A;
            --bg-hover: #2A2A2A;
            --text-main: #FFFFFF;
            --text-dim: #A0A0A0;
            --border: rgba(255, 255, 255, 0.1);
            --radius-lg: 16px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* RESET & BASE */
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        body { 
            background: var(--bg-deep); 
            color: var(--text-main); 
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            line-height: 1.6;
        }

        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* AUTHENTIFICATION */
        #auth-portal {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: linear-gradient(135deg, #0A0A0A 0%, #1A0A1A 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }

        .auth-container {
            width: 100%;
            max-width: 450px;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 40px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .auth-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--rassama-red), var(--rassama-purple));
        }

        .brand {
            text-align: center;
            margin-bottom: 30px;
        }

        .brand h1 {
            font-size: 42px;
            font-weight: 900;
            background: linear-gradient(45deg, var(--rassama-red), #FF8A00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .brand p {
            color: var(--text-dim);
            font-size: 14px;
        }

        .auth-tabs {
            display: flex;
            background: var(--rassama-gray);
            border-radius: var(--radius-md);
            padding: 4px;
            margin-bottom: 30px;
        }

        .auth-tabs button {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            color: var(--text-dim);
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .auth-tabs button.active {
            background: var(--rassama-red);
            color: white;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-group i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-dim);
        }

        .input-group input {
            width: 100%;
            padding: 15px 15px 15px 45px;
            background: var(--rassama-gray);
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            color: white;
            font-size: 15px;
            transition: var(--transition);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--rassama-red);
            background: #222;
        }

        .auth-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(45deg, var(--rassama-red), var(--rassama-purple));
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(229, 9, 20, 0.3);
        }

        /* MAIN APP */
        #main-app {
            display: none;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* TOP NAV */
        .top-nav {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 900;
            color: var(--rassama-red);
            text-decoration: none;
        }

        .logo i {
            color: var(--rassama-red);
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            margin: 0 20px;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 12px 20px 12px 45px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            color: white;
            font-size: 14px;
            transition: var(--transition);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--rassama-red);
            box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-dim);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
            font-size: 18px;
            color: var(--text-dim);
            transition: var(--transition);
        }

        .notification-bell:hover {
            color: var(--rassama-red);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--rassama-red);
            color: white;
            font-size: 10px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: var(--text-dim);
            text-decoration: none;
            padding: 10px 15px;
            border-radius: var(--radius-md);
            transition: var(--transition);
            flex: 1;
            max-width: 80px;
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item span {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .nav-item.active {
            color: var(--rassama-red);
            background: rgba(229, 9, 20, 0.1);
        }

        .nav-item:hover {
            color: var(--rassama-red);
            transform: translateY(-3px);
        }

        /* MAIN CONTENT */
        .main-content {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* HERO SECTION */
        .hero-section {
            position: relative;
            height: 400px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
        }

        .hero-background {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.4;
        }

        .hero-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 40px;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
        }

        .hero-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 10px;
            color: white;
        }

        .hero-description {
            font-size: 16px;
            color: var(--text-dim);
            margin-bottom: 20px;
            max-width: 600px;
        }

        .hero-actions {
            display: flex;
            gap: 15px;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 24px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--rassama-red);
            color: white;
        }

        .btn-primary:hover {
            background: #ff0a16;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ANIME GRID */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0 20px 0;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: white;
        }

        .view-all {
            color: var(--rassama-red);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .view-all:hover {
            transform: translateX(5px);
        }

        .anime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .anime-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            border: 1px solid transparent;
        }

        .anime-card:hover {
            transform: translateY(-10px);
            border-color: var(--rassama-red);
            box-shadow: var(--shadow);
        }

        .anime-poster {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
        }

        .anime-info {
            padding: 15px;
        }

        .anime-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .anime-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-dim);
        }

        .anime-rating {
            color: #FFAA00;
            font-weight: 600;
        }

        .anime-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--rassama-red);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
        }

        /* DETAILS PAGE */
        #sec-details {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }

        .anime-details {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .anime-details {
                grid-template-columns: 1fr;
            }
        }

        .details-poster {
            width: 100%;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
        }

        .details-content h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: white;
        }

        .details-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            color: var(--text-dim);
            font-size: 14px;
        }

        .details-rating {
            color: #FFAA00;
            font-weight: 600;
        }

        .details-description {
            color: var(--text-dim);
            line-height: 1.6;
            margin-bottom: 30px;
            font-size: 15px;
        }

        .details-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .episodes-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 30px;
        }

        .episodes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .episodes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .episode-card {
            background: var(--rassama-gray);
            border-radius: var(--radius-md);
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .episode-card:hover {
            border-color: var(--rassama-red);
            transform: translateY(-3px);
        }

        .episode-card.active {
            border-color: var(--rassama-red);
            background: rgba(229, 9, 20, 0.1);
        }

        .episode-number {
            font-size: 12px;
            color: var(--text-dim);
            margin-bottom: 5px;
        }

        .episode-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .episode-duration {
            font-size: 11px;
            color: var(--text-dim);
        }

        /* PLAYER */
        #sec-player {
            position: fixed;
            inset: 0;
            z-index: 9998;
            background: #000;
            display: none;
            flex-direction: column;
        }

        .player-header {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .player-title {
            font-size: 16px;
            font-weight: 600;
        }

        .player-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .player-container {
            flex: 1;
            position: relative;
        }

        #video-player {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
        }

        .player-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .player-container:hover .player-controls {
            opacity: 1;
        }

        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            cursor: pointer;
        }

        .progress-fill {
            height: 100%;
            background: var(--rassama-red);
            width: 0%;
            transition: width 0.1s linear;
        }

        .control-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .control-left, .control-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
        }

        .control-btn:hover {
            color: var(--rassama-red);
        }

        /* LIBRARY */
        .library-filters {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-dim);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition);
        }

        .filter-btn.active {
            background: var(--rassama-red);
            color: white;
            border-color: var(--rassama-red);
        }

        .filter-btn:hover {
            border-color: var(--rassama-red);
        }

        /* PROFILE */
        .profile-header {
            display: flex;
            gap: 30px;
            align-items: center;
            background: var(--bg-card);
            padding: 30px;
            border-radius: var(--radius-lg);
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--rassama-red);
            object-fit: cover;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: var(--radius-md);
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 900;
            color: var(--rassama-red);
            display: block;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* UTILITIES */
        .hidden { display: none !important; }
        .visible { display: block !important; }
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-dim);
        }

        /* TOAST */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            border-left: 4px solid var(--rassama-red);
            border-radius: var(--radius-md);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 9999;
            animation: slideIn 0.3s ease;
            box-shadow: var(--shadow);
            min-width: 300px;
        }

        .toast i {
            font-size: 20px;
            color: var(--rassama-red);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .top-nav {
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .search-container {
                order: 3;
                margin: 0;
                min-width: 100%;
            }
            
            .anime-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .hero-section {
                height: 300px;
            }
            
            .hero-content {
                padding: 20px;
            }
            
            .hero-title {
                font-size: 24px;
            }
            
            .profile-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-card);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--rassama-red);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #ff0a16;
        }
    </style>
</head>
<body>

<!-- AUTH PORTAL -->
<div id="auth-portal">
    <div class="auth-container">
        <div class="brand">
            <h1>RASSAMA</h1>
            <p>La plus grande biblioth√®que d'anime au monde</p>
        </div>
        
        <div class="auth-tabs">
            <button id="tab-login" class="active" onclick="Rassama.toggleAuth('login')">CONNEXION</button>
            <button id="tab-signup" onclick="Rassama.toggleAuth('signup')">INSCRIPTION</button>
        </div>

        <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="auth-email" placeholder="Adresse email" class="auth-input">
        </div>
        
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="auth-pass" placeholder="Mot de passe (6+ caract√®res)" class="auth-input">
        </div>

        <div id="signup-extra" class="hidden">
            <div class="input-group">
                <i class="fas fa-user"></i>
                <input type="text" id="auth-username" placeholder="Nom d'utilisateur" class="auth-input">
            </div>
        </div>

        <button onclick="Rassama.executeAuth()" class="auth-btn">
            <span id="auth-btn-text">ACC√âDER √Ä RASSAMA</span>
            <div class="loader" id="auth-loader" style="display:none;"></div>
        </button>
        
        <p id="auth-msg" style="text-align: center; color: #ff4444; font-size: 13px; margin-top: 15px; display: none;"></p>
    </div>
</div>

<!-- TOAST CONTAINER -->
<div id="toast-container"></div>

<!-- MAIN APP -->
<div id="main-app">
    <!-- TOP NAVIGATION -->
    <nav class="top-nav">
        <a href="#" class="logo" onclick="Rassama.go('home'); return false;">
            <i class="fas fa-play-circle"></i>
            <span>RASSAMA</span>
        </a>
        
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-box" id="search-box" placeholder="Rechercher un anime, film, s√©rie..." 
                   onkeyup="Rassama.searchAnime(this.value)">
        </div>
        
        <div class="user-menu">
            <div class="notification-bell" onclick="Rassama.showNotifications()">
                <i class="fas fa-bell"></i>
                <div class="notification-badge" id="notification-badge">3</div>
            </div>
            <img src="" id="user-avatar" onclick="Rassama.go('profile')" 
                 style="width: 36px; height: 36px; border-radius: 50%; cursor: pointer; border: 2px solid var(--rassama-red);" 
                 alt="Avatar">
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content" id="main-content">
        <!-- HOME PAGE -->
        <section id="sec-home" class="app-section">
            <div class="hero-section">
                <div class="hero-content">
                    <h1 class="hero-title">D√©couvrez plus de 1000 anim√©s</h1>
                    <p class="hero-description">Streaming illimit√© de vos anim√©s pr√©f√©r√©s en haute qualit√©. Nouveaux √©pisodes ajout√©s quotidiennement.</p>
                    <div class="hero-actions">
                        <button class="btn-primary" onclick="Rassama.go('library')">
                            <i class="fas fa-play"></i>
                            Commencer √† regarder
                        </button>
                        <button class="btn-secondary" onclick="Rassama.exploreAnime()">
                            <i class="fas fa-compass"></i>
                            Explorer
                        </button>
                    </div>
                </div>
            </div>

            <!-- Trending Now -->
            <div class="section-header">
                <h2 class="section-title">üî• Tendances actuelles</h2>
                <div class="view-all" onclick="Rassama.viewAll('trending')">Tout voir</div>
            </div>
            <div class="anime-grid" id="trending-grid"></div>

            <!-- Continue Watching -->
            <div class="section-header">
                <h2 class="section-title">‚ñ∂Ô∏è Continuer √† regarder</h2>
                <div class="view-all" onclick="Rassama.viewAll('continue')">Historique</div>
            </div>
            <div class="anime-grid" id="continue-grid"></div>

            <!-- New Releases -->
            <div class="section-header">
                <h2 class="section-title">üé¨ Nouveaut√©s</h2>
                <div class="view-all" onclick="Rassama.viewAll('new')">Tout voir</div>
            </div>
            <div class="anime-grid" id="new-grid"></div>

            <!-- Popular Films -->
            <div class="section-header">
                <h2 class="section-title">üé• Films populaires</h2>
                <div class="view-all" onclick="Rassama.viewAll('films')">Tous les films</div>
            </div>
            <div class="anime-grid" id="films-grid"></div>

            <!-- Top Rated -->
            <div class="section-header">
                <h2 class="section-title">‚≠ê Les mieux not√©s</h2>
                <div class="view-all" onclick="Rassama.viewAll('top')">Classement</div>
            </div>
            <div class="anime-grid" id="top-grid"></div>
        </section>

        <!-- LIBRARY PAGE -->
        <section id="sec-library" class="app-section hidden">
            <div class="section-header">
                <h2 class="section-title">üìö Ma Biblioth√®que</h2>
                <div class="view-all" onclick="Rassama.refreshLibrary()">
                    <i class="fas fa-sync-alt"></i>
                    Actualiser
                </div>
            </div>

            <div class="library-filters">
                <button class="filter-btn active" onclick="Rassama.filterLibrary('all')">Tous</button>
                <button class="filter-btn" onclick="Rassama.filterLibrary('watching')">En cours</button>
                <button class="filter-btn" onclick="Rassama.filterLibrary('completed')">Termin√©s</button>
                <button class="filter-btn" onclick="Rassama.filterLibrary('planned')">√Ä voir</button>
                <button class="filter-btn" onclick="Rassama.filterLibrary('favorites')">Favoris</button>
                <button class="filter-btn" onclick="Rassama.filterLibrary('films')">Films</button>
                <button class="filter-btn" onclick="Rassama.filterLibrary('new')">Nouveaut√©s</button>
            </div>

            <div class="anime-grid" id="library-grid"></div>
        </section>

        <!-- DETAILS PAGE -->
        <section id="sec-details" class="app-section hidden">
            <!-- Details content will be loaded dynamically -->
        </section>

        <!-- PROFILE PAGE -->
        <section id="sec-profile" class="app-section hidden">
            <div class="profile-header">
                <img src="" id="profile-avatar" class="profile-avatar" alt="Avatar">
                <div style="flex: 1;">
                    <h1 id="profile-name" style="margin-bottom: 10px;"></h1>
                    <p id="profile-email" style="color: var(--text-dim); margin-bottom: 20px;"></p>
                    <p style="color: var(--text-dim);">Membre depuis <span id="member-since"></span></p>
                </div>
            </div>

            <div class="section-header">
                <h2 class="section-title">üìä Mes Statistiques</h2>
            </div>

            <div class="profile-stats">
                <div class="stat-card">
                    <span class="stat-value" id="stat-anime">0</span>
                    <span class="stat-label">Anim√©s vus</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-films">0</span>
                    <span class="stat-label">Films vus</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-hours">0</span>
                    <span class="stat-label">Heures</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stat-streak">0</span>
                    <span class="stat-label">Jours streak</span>
                </div>
            </div>

            <div class="section-header" style="margin-top: 40px;">
                <h2 class="section-title">üéØ Mes Objectifs</h2>
            </div>

            <div class="profile-stats">
                <div class="stat-card">
                    <span class="stat-value" id="goal-episodes">0</span>
                    <span class="stat-label">/100 √âpisodes</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="goal-favorites">0</span>
                    <span class="stat-label">/10 Favoris</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="goal-streak">0</span>
                    <span class="stat-label">/7 Jours streak</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="goal-completed">0</span>
                    <span class="stat-label">/5 Anim√©s termin√©s</span>
                </div>
            </div>
        </section>
    </main>

    <!-- BOTTOM NAVIGATION -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" onclick="Rassama.go('home'); return false;">
            <i class="fas fa-home"></i>
            <span>Accueil</span>
        </a>
        <a href="#" class="nav-item" onclick="Rassama.go('library'); return false;">
            <i class="fas fa-book"></i>
            <span>Biblioth√®que</span>
        </a>
        <a href="#" class="nav-item" onclick="Rassama.go('search'); return false;">
            <i class="fas fa-search"></i>
            <span>Recherche</span>
        </a>
        <a href="#" class="nav-item" onclick="Rassama.go('profile'); return false;">
            <i class="fas fa-user"></i>
            <span>Profil</span>
        </a>
    </nav>
</div>

<!-- VIDEO PLAYER -->
<div id="sec-player">
    <div class="player-header">
        <div class="player-title" id="player-title">Lecture en cours...</div>
        <button class="player-close" onclick="Rassama.closePlayer()">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="player-container">
        <video id="video-player" controls playsinline autoplay>
            <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
            Votre navigateur ne supporte pas la lecture vid√©o.
        </video>
        <div class="player-controls">
            <div class="progress-bar" id="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="control-buttons">
                <div class="control-left">
                    <button class="control-btn" onclick="Rassama.togglePlay()" id="play-btn">
                        <i class="fas fa-pause"></i>
                    </button>
                    <button class="control-btn" onclick="Rassama.skip(-10)">
                        <i class="fas fa-backward"></i>
                    </button>
                    <button class="control-btn" onclick="Rassama.skip(10)">
                        <i class="fas fa-forward"></i>
                    </button>
                    <span id="current-time">0:00</span> / <span id="total-time">0:00</span>
                </div>
                <div class="control-right">
                    <button class="control-btn" onclick="Rassama.toggleMute()" id="mute-btn">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <button class="control-btn" onclick="Rassama.toggleFullscreen()">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
/**
 * RASSAMA - La plus grande biblioth√®que d'anime
 * Plus de 1000 anim√©s + 300 films
 */

const Rassama = {
    // √âTAT GLOBAL
    state: {
        // Utilisateurs
        users: JSON.parse(localStorage.getItem('rassama_users') || '[]'),
        session: JSON.parse(localStorage.getItem('rassama_session') || 'null'),
        
        // Biblioth√®que principale (1300+ items)
        library: JSON.parse(localStorage.getItem('rassama_library') || '[]'),
        
        // Donn√©es utilisateur
        watchingHistory: JSON.parse(localStorage.getItem('rassama_history') || '[]'),
        favorites: JSON.parse(localStorage.getItem('rassama_favorites') || '[]'),
        watchlist: JSON.parse(localStorage.getItem('rassama_watchlist') || '[]'),
        
        // √âtat actuel
        currentTab: 'login',
        activeSection: 'home',
        currentAnime: null,
        currentEpisode: 1,
        searchResults: [],
        
        // Statistiques
        stats: JSON.parse(localStorage.getItem('rassama_stats') || JSON.stringify({
            animeWatched: 0,
            filmsWatched: 0,
            hoursWatched: 0,
            currentStreak: 0,
            lastWatchDate: '',
            goals: {
                episodes: 0,
                favorites: 0,
                streak: 0,
                completed: 0
            }
        })),
        
        // Donn√©es de g√©n√©ration
        animeTitles: [
            "Attack on Titan", "Demon Slayer", "Jujutsu Kaisen", "My Hero Academia",
            "One Piece", "Naruto", "Bleach", "Dragon Ball", "Hunter x Hunter",
            "Death Note", "Fullmetal Alchemist", "Tokyo Ghoul", "Parasyte",
            "One Punch Man", "Mob Psycho 100", "Chainsaw Man", "Spy x Family",
            "Vinland Saga", "Berserk", "Cowboy Bebop", "Neon Genesis Evangelion",
            "Code Geass", "Steins;Gate", "Re:Zero", "Konosuba", "Overlord",
            "That Time I Got Reincarnated as a Slime", "The Rising of the Shield Hero",
            "Sword Art Online", "No Game No Life", "Made in Abyss", "Land of the Lustrous",
            "Mushoku Tensei", "86 EIGHTY-SIX", "Vivy: Fluorite Eye's Song",
            "Odd Taxi", "Wonder Egg Priority", "To Your Eternity", "Jujutsu Kaisen 0",
            "Your Name", "Weathering With You", "A Silent Voice", "I Want to Eat Your Pancreas",
            "Grave of the Fireflies", "Spirited Away", "Princess Mononoke",
            "Howl's Moving Castle", "My Neighbor Totoro", "Perfect Blue", "Paprika"
        ],
        
        animeGenres: [
            "Action", "Aventure", "Com√©die", "Drame", "Fantasy", "Horreur",
            "Myst√®re", "Psychologique", "Romance", "Sci-Fi", "Slice of Life",
            "Surnaturel", "Thriller", "Sport", "Mecha", "Isekai", "Magical Girl"
        ],
        
        filmTitles: [
            "Your Name", "Weathering With You", "A Silent Voice", "5 Centimeters Per Second",
            "The Garden of Words", "I Want to Eat Your Pancreas", "A Whisker Away",
            "Belle", "The Boy and the Beast", "Wolf Children", "Summer Wars",
            "The Girl Who Leapt Through Time", "Paprika", "Perfect Blue", "Tokyo Godfathers",
            "Millennium Actress", "Grave of the Fireflies", "Spirited Away",
            "Princess Mononoke", "Howl's Moving Castle", "My Neighbor Totoro",
            "Kiki's Delivery Service", "Ponyo", "The Wind Rises", "When Marnie Was There",
            "The Tale of the Princess Kaguya", "Only Yesterday", "Porco Rosso",
            "Castle in the Sky", "Nausica√§ of the Valley of the Wind"
        ]
    },

    // INITIALISATION
    init() {
        this.initializeLibrary();
        this.verifySession();
        
        if(this.state.session) {
            this.launch();
        }
    },

    // G√âN√âRATION DE LA BIBLIOTH√àQUE (1300+ ITEMS)
    initializeLibrary() {
        if(this.state.library.length === 0) {
            console.log("G√©n√©ration de la biblioth√®que RASSAMA...");
            
            let library = [];
            let id = 1;
            
            // G√©n√©rer 1000 anim√©s
            for(let i = 0; i < 1000; i++) {
                const titleIndex = Math.floor(Math.random() * this.state.animeTitles.length);
                const baseTitle = this.state.animeTitles[titleIndex];
                const title = i > 50 ? `${baseTitle} ${Math.floor(Math.random() * 5) + 1}` : baseTitle;
                
                const anime = {
                    id: id++,
                    title: title,
                    description: this.generateDescription(),
                    type: 'anime',
                    episodes: Math.floor(Math.random() * 100) + 12,
                    currentEpisode: 0,
                    duration: "24 min",
                    status: ['En cours', 'Termin√©', '√Ä venir'][Math.floor(Math.random() * 3)],
                    genres: this.getRandomGenres(3),
                    rating: (Math.random() * 2 + 6).toFixed(1),
                    year: 2010 + Math.floor(Math.random() * 14),
                    cover: this.getRandomImage(),
                    addedBy: 'system',
                    addedDate: new Date().toISOString(),
                    popularity: Math.floor(Math.random() * 1000),
                    isFilm: false
                };
                
                library.push(anime);
            }
            
            // G√©n√©rer 300 films
            for(let i = 0; i < 300; i++) {
                const titleIndex = Math.floor(Math.random() * this.state.filmTitles.length);
                const baseTitle = this.state.filmTitles[titleIndex];
                const title = i > 30 ? `${baseTitle} ${Math.floor(Math.random() * 3) + 1}` : baseTitle;
                
                const film = {
                    id: id++,
                    title: title,
                    description: this.generateFilmDescription(),
                    type: 'film',
                    episodes: 1,
                    currentEpisode: 0,
                    duration: `${Math.floor(Math.random() * 60) + 60} min`,
                    status: 'Termin√©',
                    genres: this.getRandomGenres(2),
                    rating: (Math.random() * 2 + 7).toFixed(1),
                    year: 2000 + Math.floor(Math.random() * 24),
                    cover: this.getRandomImage(),
                    addedBy: 'system',
                    addedDate: new Date().toISOString(),
                    popularity: Math.floor(Math.random() * 1000),
                    isFilm: true
                };
                
                library.push(film);
            }
            
            this.state.library = library;
            this.sync();
            console.log(`Biblioth√®que g√©n√©r√©e: ${this.state.library.length} items`);
        }
    },

    generateDescription() {
        const descriptions = [
            "Une histoire captivante qui m√©lange action, √©motion et moments inoubliables.",
            "Un voyage √©pique √† travers des mondes fantastiques remplis de myst√®res.",
            "Des personnages attachants dans une qu√™te qui changera leur vie √† jamais.",
            "Une masterclass d'animation avec une narration profonde et touchante.",
            "Une aventure palpitante qui d√©fie les conventions du genre.",
            "Des combats spectaculaires et une mythologie riche et complexe.",
            "Une ≈ìuvre qui explore les th√®mes de l'amiti√©, du sacrifice et de la r√©demption.",
            "Un chef-d'≈ìuvre visuel avec une bande-son √©poustouflante.",
            "Une histoire √©motionnelle qui restera grav√©e dans votre m√©moire.",
            "Une exp√©rience unique qui r√©volutionne le m√©dium de l'animation."
        ];
        return descriptions[Math.floor(Math.random() * descriptions.length)];
    },

    generateFilmDescription() {
        const descriptions = [
            "Un film d'animation magnifique qui explore des th√®mes profonds avec sensibilit√©.",
            "Une ≈ìuvre visuellement √©poustouflante avec une histoire intemporelle.",
            "Un chef-d'≈ìuvre √©motionnel qui touchera le c≈ìur de tous les spectateurs.",
            "Une exp√©rience cin√©matographique unique qui red√©finit le genre.",
            "Un voyage inoubliable √† travers des paysages visuels extraordinaires.",
            "Une histoire po√©tique qui c√©l√®bre la beaut√© de la vie et de l'amour.",
            "Un film qui marquera l'histoire de l'animation par son audace et sa cr√©ativit√©.",
            "Une aventure fantastique remplie de moments magiques et inattendus.",
            "Un drame poignant qui explore la complexit√© des relations humaines.",
            "Une com√©die touchante qui apporte lumi√®re et joie √† son public."
        ];
        return descriptions[Math.floor(Math.random() * descriptions.length)];
    },

    getRandomGenres(count) {
        const shuffled = [...this.state.animeGenres].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, count);
    },

    getRandomImage() {
        const images = [
            "https://images.unsplash.com/photo-1639322537228-f710d846310a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1635805737707-575885ab0820?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1541562232579-512a21360020?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1511379938547-c1f69419868d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1635805737707-575885ab0820?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1541562232579-512a21360020?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
        ];
        return images[Math.floor(Math.random() * images.length)];
    },

    // AUTHENTIFICATION
    toggleAuth(tab) {
        this.state.currentTab = tab;
        
        document.getElementById('tab-login').classList.toggle('active', tab === 'login');
        document.getElementById('tab-signup').classList.toggle('active', tab === 'signup');
        document.getElementById('signup-extra').classList.toggle('hidden', tab !== 'signup');
        
        document.getElementById('auth-btn-text').innerText = tab === 'signup' 
            ? "CR√âER UN COMPTE" 
            : "SE CONNECTER";
    },

    executeAuth() {
        const email = document.getElementById('auth-email').value.trim();
        const password = document.getElementById('auth-pass').value.trim();
        
        if(!email || !password) {
            this.showAuthMessage('Veuillez remplir tous les champs', 'error');
            return;
        }
        
        if(password.length < 6) {
            this.showAuthMessage('Le mot de passe doit faire au moins 6 caract√®res', 'error');
            return;
        }
        
        if(this.state.currentTab === 'signup') {
            const username = document.getElementById('auth-username')?.value.trim() || 
                           `Otaku_${Math.floor(Math.random() * 10000)}`;
            
            if(this.state.users.find(u => u.email === email)) {
                this.showAuthMessage('Cet email est d√©j√† utilis√©', 'error');
                return;
            }
            
            const newUser = {
                id: Date.now(),
                username: username,
                email: email,
                password: password,
                avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}`,
                joinDate: new Date().toISOString(),
                isPremium: Math.random() > 0.7
            };
            
            this.state.users.push(newUser);
            this.state.session = newUser;
            this.sync();
            
            this.showAuthMessage('Compte cr√©√© avec succ√®s !', 'success');
            
            setTimeout(() => {
                this.launch();
            }, 1000);
            
        } else {
            const user = this.state.users.find(u => u.email === email && u.password === password);
            
            if(!user) {
                this.showAuthMessage('Email ou mot de passe incorrect', 'error');
                return;
            }
            
            this.state.session = user;
            this.sync();
            
            this.showAuthMessage('Connexion r√©ussie !', 'success');
            
            setTimeout(() => {
                this.launch();
            }, 1000);
        }
    },

    showAuthMessage(msg, type) {
        const msgEl = document.getElementById('auth-msg');
        msgEl.innerText = msg;
        msgEl.style.color = type === 'error' ? '#ff4444' : '#44ff44';
        msgEl.style.display = 'block';
        
        setTimeout(() => {
            msgEl.style.display = 'none';
        }, 3000);
    },

    // LANCEMENT APP
    launch() {
        document.getElementById('auth-portal').classList.add('hidden');
        document.getElementById('main-app').style.display = 'block';
        
        // Mettre √† jour l'interface utilisateur
        if(this.state.session) {
            document.getElementById('user-avatar').src = this.state.session.avatar;
            document.getElementById('profile-avatar').src = this.state.session.avatar;
            document.getElementById('profile-name').innerText = this.state.session.username;
            document.getElementById('profile-email').innerText = this.state.session.email;
            document.getElementById('member-since').innerText = new Date(this.state.session.joinDate).toLocaleDateString('fr-FR');
        }
        
        this.updateStats();
        this.renderHomePage();
        this.go('home');
        
        this.showToast(`üéå Bienvenue sur RASSAMA, ${this.state.session?.username || 'Otaku'} !`, 'success');
    },

    // NAVIGATION
    go(section) {
        document.querySelectorAll('.app-section').forEach(s => s.classList.add('hidden'));
        document.getElementById('sec-' + section)?.classList.remove('hidden');
        
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        
        document.querySelectorAll('.nav-item').forEach(item => {
            if(item.querySelector('span')?.textContent.toLowerCase() === section.toLowerCase()) {
                item.classList.add('active');
            }
        });
        
        this.state.activeSection = section;
        
        if(section === 'home') {
            this.renderHomePage();
        } else if(section === 'library') {
            this.renderLibrary();
        } else if(section === 'profile') {
            this.updateStats();
        }
    },

    // RENDER HOME PAGE
    renderHomePage() {
        // Trier par popularit√© pour les tendances
        const trending = [...this.state.library]
            .sort((a, b) => b.popularity - a.popularity)
            .slice(0, 12);
        
        // Continue watching (derniers regard√©s)
        const continueWatching = this.state.watchingHistory
            .map(h => this.state.library.find(a => a.id === h.animeId))
            .filter(Boolean)
            .slice(0, 12);
        
        // Nouveaut√©s (plus r√©cents)
        const newReleases = [...this.state.library]
            .sort((a, b) => b.year - a.year)
            .slice(0, 12);
        
        // Films (seulement les films)
        const films = this.state.library
            .filter(a => a.isFilm)
            .sort((a, b) => b.rating - a.rating)
            .slice(0, 12);
        
        // Top rated (meilleures notes)
        const topRated = [...this.state.library]
            .sort((a, b) => b.rating - a.rating)
            .slice(0, 12);
        
        this.renderGrid('trending-grid', trending);
        this.renderGrid('continue-grid', continueWatching.length ? continueWatching : trending.slice(0, 6));
        this.renderGrid('new-grid', newReleases);
        this.renderGrid('films-grid', films);
        this.renderGrid('top-grid', topRated);
    },

    renderGrid(containerId, items) {
        const container = document.getElementById(containerId);
        if(!container) return;
        
        container.innerHTML = items.map(item => `
            <div class="anime-card" onclick="Rassama.showDetails(${item.id})">
                ${item.isFilm ? '<div class="anime-badge">FILM</div>' : ''}
                ${item.rating > 8.5 ? '<div class="anime-badge" style="background:var(--rassama-blue);">TOP</div>' : ''}
                <img src="${item.cover}" alt="${item.title}" class="anime-poster">
                <div class="anime-info">
                    <div class="anime-title">${item.title}</div>
                    <div class="anime-meta">
                        <span>${item.year}</span>
                        <span class="anime-rating">‚≠ê ${item.rating}</span>
                    </div>
                </div>
            </div>
        `).join('');
    },

    // SHOW ANIME DETAILS
    showDetails(animeId) {
        const anime = this.state.library.find(a => a.id === animeId);
        if(!anime) return;
        
        this.state.currentAnime = anime;
        
        const detailsSection = document.getElementById('sec-details');
        detailsSection.innerHTML = `
            <div class="anime-details">
                <div>
                    <img src="${anime.cover}" alt="${anime.title}" class="details-poster">
                    <div class="details-actions" style="margin-top: 20px;">
                        <button class="btn-primary" onclick="Rassama.playEpisode(1)">
                            <i class="fas fa-play"></i>
                            ${anime.isFilm ? 'Regarder le film' : 'Regarder l\'√©pisode 1'}
                        </button>
                        <button class="btn-secondary" onclick="Rassama.toggleFavorite(${anime.id})">
                            <i class="fas fa-heart"></i>
                            Favori
                        </button>
                        <button class="btn-secondary" onclick="Rassama.addToWatchlist(${anime.id})">
                            <i class="fas fa-bookmark"></i>
                            Watchlist
                        </button>
                    </div>
                </div>
                
                <div class="details-content">
                    <h1>${anime.title}</h1>
                    <div class="details-meta">
                        <span>${anime.year}</span>
                        <span class="details-rating">‚≠ê ${anime.rating}/10</span>
                        <span>${anime.genres.join(', ')}</span>
                        <span>${anime.isFilm ? anime.duration : anime.episodes + ' √©pisodes'}</span>
                    </div>
                    <p class="details-description">${anime.description}</p>
                    
                    <div class="episodes-section">
                        <div class="episodes-header">
                            <h3>${anime.isFilm ? 'Film' : '√âpisodes'}</h3>
                            <div style="color: var(--text-dim); font-size: 14px;">
                                Progression: <span id="progress-text">0/${anime.episodes}</span>
                            </div>
                        </div>
                        
                        <div class="episodes-grid" id="episodes-grid">
                            ${anime.isFilm ? `
                                <div class="episode-card active" onclick="Rassama.playEpisode(1)">
                                    <div class="episode-number">FILM</div>
                                    <div class="episode-title">${anime.title}</div>
                                    <div class="episode-duration">${anime.duration}</div>
                                </div>
                            ` : this.generateEpisodesList(anime)}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        this.go('details');
        this.updateProgressText(anime);
    },

    generateEpisodesList(anime) {
        let episodesHtml = '';
        const totalEpisodes = Math.min(anime.episodes, 50); // Limiter √† 50 √©pisodes pour l'affichage
        
        for(let i = 1; i <= totalEpisodes; i++) {
            const isWatched = anime.currentEpisode >= i;
            episodesHtml += `
                <div class="episode-card ${isWatched ? 'active' : ''}" onclick="Rassama.playEpisode(${i})">
                    <div class="episode-number">√âpisode ${i}</div>
                    <div class="episode-title">${this.generateEpisodeTitle(i)}</div>
                    <div class="episode-duration">${anime.duration}</div>
                </div>
            `;
        }
        
        return episodesHtml;
    },

    generateEpisodeTitle(episodeNumber) {
        const titles = [
            "Le commencement", "La rencontre", "Le d√©fi", "La r√©v√©lation",
            "L'affrontement", "La s√©paration", "La d√©cision", "Le sacrifice",
            "L'espoir", "La trahison", "La renaissance", "La v√©rit√©",
            "La bataille finale", "La conclusion", "Un nouveau d√©part",
            "M√©moires du pass√©", "Le choix difficile", "L'alliance",
            "Le pouvoir cach√©", "La promesse", "L'h√©ritage", "Le destin",
            "L'√©veil", "La transformation", "Le prix √† payer"
        ];
        return titles[episodeNumber % titles.length];
    },

    updateProgressText(anime) {
        const progressText = document.getElementById('progress-text');
        if(progressText) {
            progressText.textContent = `${anime.currentEpisode}/${anime.episodes}`;
        }
    },

    // PLAYER FUNCTIONS
    playEpisode(episodeNumber) {
        if(!this.state.currentAnime) return;
        
        this.state.currentEpisode = episodeNumber;
        
        // Mettre √† jour l'historique
        const historyEntry = {
            animeId: this.state.currentAnime.id,
            animeTitle: this.state.currentAnime.title,
            episode: episodeNumber,
            watchedAt: new Date().toISOString(),
            duration: this.state.currentAnime.duration
        };
        
        this.state.watchingHistory.unshift(historyEntry);
        if(this.state.watchingHistory.length > 50) {
            this.state.watchingHistory = this.state.watchingHistory.slice(0, 50);
        }
        
        // Mettre √† jour la progression
        if(episodeNumber > this.state.currentAnime.currentEpisode) {
            this.state.currentAnime.currentEpisode = episodeNumber;
        }
        
        // Mettre √† jour les statistiques
        this.updateStats();
        this.sync();
        
        // Afficher le player
        this.showPlayer();
    },

    showPlayer() {
        const player = document.getElementById('sec-player');
        const video = document.getElementById('video-player');
        const title = document.getElementById('player-title');
        
        if(this.state.currentAnime) {
            title.textContent = `${this.state.currentAnime.title} - √âpisode ${this.state.currentEpisode}`;
            
            // Utiliser une vid√©o de test (en r√©alit√©, vous auriez vos propres sources)
            video.src = "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";
            video.load();
            video.play();
            
            player.style.display = 'flex';
            
            this.setupPlayerEvents();
        }
    },

    closePlayer() {
        document.getElementById('sec-player').style.display = 'none';
        const video = document.getElementById('video-player');
        video.pause();
        
        // Mettre √† jour l'interface
        if(this.state.activeSection === 'details' && this.state.currentAnime) {
            this.updateProgressText(this.state.currentAnime);
            this.showDetails(this.state.currentAnime.id);
        }
    },

    setupPlayerEvents() {
        const video = document.getElementById('video-player');
        const progressFill = document.getElementById('progress-fill');
        const currentTime = document.getElementById('current-time');
        const totalTime = document.getElementById('total-time');
        const progressBar = document.getElementById('progress-bar');
        const playBtn = document.getElementById('play-btn');
        
        video.ontimeupdate = () => {
            const progress = (video.currentTime / video.duration) * 100;
            progressFill.style.width = `${progress}%`;
            
            currentTime.textContent = this.formatTime(video.currentTime);
            totalTime.textContent = this.formatTime(video.duration);
        };
        
        video.onplay = () => {
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
        };
        
        video.onpause = () => {
            playBtn.innerHTML = '<i class="fas fa-play"></i>';
        };
        
        progressBar.onclick = (e) => {
            const rect = progressBar.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            video.currentTime = pos * video.duration;
        };
    },

    togglePlay() {
        const video = document.getElementById('video-player');
        if(video.paused) {
            video.play();
        } else {
            video.pause();
        }
    },

    skip(seconds) {
        const video = document.getElementById('video-player');
        video.currentTime += seconds;
    },

    toggleMute() {
        const video = document.getElementById('video-player');
        const muteBtn = document.getElementById('mute-btn');
        
        video.muted = !video.muted;
        muteBtn.innerHTML = video.muted 
            ? '<i class="fas fa-volume-mute"></i>'
            : '<i class="fas fa-volume-up"></i>';
    },

    toggleFullscreen() {
        const player = document.getElementById('sec-player');
        if(!document.fullscreenElement) {
            player.requestFullscreen().catch(err => {
                console.log(`Error attempting to enable fullscreen: ${err.message}`);
            });
        } else {
            document.exitFullscreen();
        }
    },

    formatTime(seconds) {
        if(isNaN(seconds)) return "0:00";
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    },

    // LIBRARY FUNCTIONS
    renderLibrary(filter = 'all') {
        const grid = document.getElementById('library-grid');
        if(!grid) return;
        
        let items = [...this.state.library];
        
        switch(filter) {
            case 'watching':
                items = items.filter(a => a.currentEpisode > 0 && a.currentEpisode < a.episodes);
                break;
            case 'completed':
                items = items.filter(a => a.currentEpisode >= a.episodes);
                break;
            case 'planned':
                items = items.filter(a => a.currentEpisode === 0);
                break;
            case 'favorites':
                items = items.filter(a => this.state.favorites.includes(a.id));
                break;
            case 'films':
                items = items.filter(a => a.isFilm);
                break;
            case 'new':
                items = items.sort((a, b) => b.year - a.year);
                break;
        }
        
        // Limiter √† 48 items pour la performance
        items = items.slice(0, 48);
        
        this.renderGrid('library-grid', items);
        
        // Mettre √† jour les filtres actifs
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            if(btn.textContent.toLowerCase().includes(filter)) {
                btn.classList.add('active');
            }
        });
    },

    filterLibrary(filter) {
        this.renderLibrary(filter);
    },

    refreshLibrary() {
        this.renderLibrary();
        this.showToast('üîÑ Biblioth√®que actualis√©e !', 'success');
    },

    // SEARCH FUNCTION
    searchAnime(query) {
        if(query.length < 2) return;
        
        const results = this.state.library.filter(anime => 
            anime.title.toLowerCase().includes(query.toLowerCase()) ||
            anime.genres.some(genre => genre.toLowerCase().includes(query.toLowerCase()))
        ).slice(0, 24);
        
        this.state.searchResults = results;
        
        if(this.state.activeSection === 'home') {
            this.renderGrid('trending-grid', results);
        }
    },

    // USER ACTIONS
    toggleFavorite(animeId) {
        const index = this.state.favorites.indexOf(animeId);
        
        if(index === -1) {
            this.state.favorites.push(animeId);
            this.showToast('‚ù§Ô∏è Ajout√© aux favoris', 'success');
        } else {
            this.state.favorites.splice(index, 1);
            this.showToast('Retir√© des favoris', 'info');
        }
        
        this.sync();
        this.updateStats();
    },

    addToWatchlist(animeId) {
        if(!this.state.watchlist.includes(animeId)) {
            this.state.watchlist.push(animeId);
            this.showToast('üìå Ajout√© √† la watchlist', 'success');
            this.sync();
        }
    },

    // STATISTICS
    updateStats() {
        const stats = this.state.stats;
        
        // Anim√©s vus (au moins 1 √©pisode)
        stats.animeWatched = this.state.library.filter(a => a.currentEpisode > 0 && !a.isFilm).length;
        
        // Films vus
        stats.filmsWatched = this.state.library.filter(a => a.currentEpisode > 0 && a.isFilm).length;
        
        // Heures regard√©es (approximation)
        const totalEpisodes = this.state.library.reduce((total, anime) => {
            return total + anime.currentEpisode * (anime.isFilm ? 1.5 : 0.4); // Films: 90min, √âpisodes: 24min
        }, 0);
        stats.hoursWatched = (totalEpisodes / 60).toFixed(1);
        
        // Mettre √† jour le streak
        const today = new Date().toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        
        if(stats.lastWatchDate === today) {
            // D√©j√† regard√© aujourd'hui
        } else if(stats.lastWatchDate === yesterday) {
            stats.currentStreak++;
        } else {
            stats.currentStreak = 1;
        }
        
        stats.lastWatchDate = today;
        
        // Objectifs
        stats.goals.episodes = this.state.library.reduce((total, anime) => total + anime.currentEpisode, 0);
        stats.goals.favorites = this.state.favorites.length;
        stats.goals.streak = stats.currentStreak;
        stats.goals.completed = this.state.library.filter(a => a.currentEpisode >= a.episodes).length;
        
        // Mettre √† jour l'interface
        document.getElementById('stat-anime').textContent = stats.animeWatched;
        document.getElementById('stat-films').textContent = stats.filmsWatched;
        document.getElementById('stat-hours').textContent = stats.hoursWatched;
        document.getElementById('stat-streak').textContent = stats.currentStreak;
        
        document.getElementById('goal-episodes').textContent = stats.goals.episodes;
        document.getElementById('goal-favorites').textContent = stats.goals.favorites;
        document.getElementById('goal-streak').textContent = stats.goals.streak;
        document.getElementById('goal-completed').textContent = stats.goals.completed;
        
        this.sync();
    },

    // UTILITIES
    verifySession() {
        if(this.state.session) {
            const userExists = this.state.users.find(u => u.email === this.state.session.email);
            if(!userExists) {
                this.state.session = null;
                this.sync();
            }
        }
    },

    sync() {
        localStorage.setItem('rassama_users', JSON.stringify(this.state.users));
        localStorage.setItem('rassama_library', JSON.stringify(this.state.library));
        localStorage.setItem('rassama_session', JSON.stringify(this.state.session));
        localStorage.setItem('rassama_history', JSON.stringify(this.state.watchingHistory));
        localStorage.setItem('rassama_favorites', JSON.stringify(this.state.favorites));
        localStorage.setItem('rassama_watchlist', JSON.stringify(this.state.watchlist));
        localStorage.setItem('rassama_stats', JSON.stringify(this.state.stats));
    },

    showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <div>${message}</div>
        `;
        
        container.appendChild(toast);
        
        setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transform = 'translateX(100%)';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    },

    showNotifications() {
        this.showToast('üîî 3 nouveaux √©pisodes disponibles !', 'info');
    },

    viewAll(category) {
        this.go('library');
        setTimeout(() => {
            this.filterLibrary(category);
        }, 100);
    },

    exploreAnime() {
        this.go('library');
        this.showToast('üéå Explorez notre collection de plus de 1300 anim√©s !', 'success');
    }
};

// INITIALISATION
window.onload = () => Rassama.init();

// GESTION DU CLAVIER POUR LE PLAYER
document.addEventListener('keydown', (e) => {
    const player = document.getElementById('sec-player');
    if(player.style.display === 'flex') {
        switch(e.key) {
            case ' ':
            case 'k':
                e.preventDefault();
                Rassama.togglePlay();
                break;
            case 'f':
                e.preventDefault();
                Rassama.toggleFullscreen();
                break;
            case 'm':
                e.preventDefault();
                Rassama.toggleMute();
                break;
            case 'Escape':
                Rassama.closePlayer();
                break;
            case 'ArrowLeft':
                e.preventDefault();
                Rassama.skip(-10);
                break;
            case 'ArrowRight':
                e.preventDefault();
                Rassama.skip(10);
                break;
        }
    }
});
</script>
</body>
</html>