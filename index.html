<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RASSTUBE BLACK EDITION</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --red: #ff0000; --bg: #000; --card: #121212; --text: #fff; --ai: #4285f4; --gray: #222; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; padding-bottom: 75px; }

        /* --- AUTH SYSTEM --- */
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 25px; }
        .auth-box { background: #111; padding: 30px; border-radius: 25px; width: 100%; max-width: 400px; text-align: center; border: 1px solid #333; }
        .avatar-select { width: 90px; height: 90px; border-radius: 50%; background: #222; margin: 0 auto 15px; border: 2px solid var(--red); object-fit: cover; cursor: pointer; }
        .auth-input { width: 100%; padding: 15px; background: #222; border: 1px solid #444; color: white; border-radius: 12px; margin-bottom: 15px; font-size: 16px; }

        /* --- HEADER & SEARCH --- */
        header { position: sticky; top: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); padding: 10px 15px; border-bottom: 1px solid #222; z-index: 1000; }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .logo { color: var(--red); font-weight: 900; font-size: 24px; letter-spacing: -1px; }
        .search-container { display: flex; background: #1a1a1a; border-radius: 10px; padding: 8px 12px; margin-top: 10px; align-items: center; }
        .search-container input { background: transparent; border: none; color: white; flex: 1; margin-left: 10px; outline: none; }

        /* --- NAVIGATION --- */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #0a0a0a; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #222; z-index: 1000; }
        .nav-btn { color: #888; text-align: center; font-size: 10px; flex: 1; cursor: pointer; }
        .nav-btn.active { color: var(--red); }
        .nav-btn i { font-size: 20px; margin-bottom: 3px; }

        /* --- PAGES --- */
        .page { display: none; padding: 15px; animation: slideUp 0.3s ease; }
        .active-page { display: block; }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- CONTENT CARDS --- */
        .v-card { background: var(--card); border-radius: 15px; overflow: hidden; margin-bottom: 20px; }
        .v-card video { width: 100%; aspect-ratio: 16/9; background: #000; }
        .v-body { padding: 12px; }
        .v-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .icon-group { display: flex; gap: 20px; font-size: 20px; }
        .sub-btn { background: var(--red); color: white; border: none; padding: 6px 15px; border-radius: 20px; font-weight: bold; font-size: 12px; }
        .sub-btn.active { background: #333; }

        /* --- RSHOT GRID --- */
        .rshot-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .rshot-item { aspect-ratio: 9/16; background: #111; border-radius: 10px; overflow: hidden; position: relative; }
        .rshot-item video { width: 100%; height: 100%; object-fit: cover; }

        /* --- CHAT AREA --- */
        .chat-view { height: calc(100vh - 300px); overflow-y: auto; background: #050505; border-radius: 15px; padding: 15px; border: 1px solid #222; }
        .bubble { margin-bottom: 12px; padding: 10px 15px; border-radius: 18px; max-width: 80%; font-size: 14px; position: relative; }
        .me { background: var(--red); align-self: flex-end; margin-left: auto; border-bottom-right-radius: 4px; }
        .other { background: var(--gray); border-bottom-left-radius: 4px; }
        .ai-bubble { border-left: 4px solid var(--ai); background: #1a1a1a; }
        .chat-bar { position: fixed; bottom: 65px; left: 0; width: 100%; background: #000; padding: 10px; display: flex; gap: 10px; border-top: 1px solid #222; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-box">
        <h1 style="color:var(--red); margin:0;">RASSTUBE</h1>
        <p style="color:#666; margin-bottom:20px;">Crée ton profil pour commencer</p>
        <img id="pfp-prev" class="avatar-select" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" onclick="document.getElementById('file-pfp').click()">
        <input type="file" id="file-pfp" hidden accept="image/*" onchange="previewPfp(this)">
        <input type="text" id="user-name" class="auth-input" placeholder="Pseudo...">
        <button class="auth-input" style="background:var(--red); border:none; font-weight:bold;" onclick="login()">REJOINDRE</button>
    </div>
</div>

<header id="app-header" style="display:none;">
    <div class="header-top">
        <div class="logo">RASSTUBE</div>
        <div id="user-info" style="display:flex; align-items:center; gap:10px;"></div>
    </div>
    <div class="search-container">
        <i class="fas fa-search" style="color:#555"></i>
        <input type="text" id="search-in" placeholder="Rechercher une vidéo..." onkeyup="doSearch()">
    </div>
</header>

<main id="app-main" style="display:none;">
    <div id="p-home" class="page active-page">
        <div id="feed-home"></div>
    </div>

    <div id="p-rshot" class="page">
        <h3 style="color:#ff0055;"><i class="fas fa-bolt"></i> RShots Verticaux</h3>
        <div id="feed-rshot" class="rshot-grid"></div>
    </div>

    <div id="p-chat" class="page">
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <button onclick="switchChat('global')" id="tg-global" style="flex:1; padding:10px; border-radius:10px; border:none; background:var(--red); color:white; font-weight:bold;">Chat Global</button>
            <button onclick="switchChat('ai')" id="tg-ai" style="flex:1; padding:10px; border-radius:10px; border:none; background:#222; color:white; font-weight:bold;">Gemini IA</button>
        </div>
        <div id="chat-box" class="chat-view"></div>
        <div class="chat-bar">
            <input type="text" id="chat-msg" class="auth-input" style="margin:0;" placeholder="Écris ici...">
            <button onclick="sendChat()" style="background:var(--red); border:none; color:white; width:50px; border-radius:12px;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div id="p-fav" class="page">
        <h3><i class="fas fa-heart" style="color:var(--red)"></i> Mes Favoris</h3>
        <div id="feed-fav"></div>
    </div>
</main>

<nav class="bottom-nav" id="app-nav" style="display:none;">
    <div class="nav-btn active" onclick="nav('p-home', this)"><i class="fas fa-home"></i><br>Accueil</div>
    <div class="nav-btn" onclick="nav('p-rshot', this)"><i class="fas fa-bolt"></i><br>RShot</div>
    <div class="nav-btn" onclick="nav('p-chat', this)"><i class="fas fa-comments"></i><br>Chat</div>
    <div class="nav-btn" onclick="nav('p-fav', this)"><i class="fas fa-heart"></i><br>Favoris</div>
</nav>

<script>
    let user = JSON.parse(localStorage.getItem('rasstube_user'));
    let db_content = [
        {id:1, type:'video', title:'Vlog au Congo', user:'Rass', url:'https://www.w3schools.com/html/mov_bbb.mp4'},
        {id:2, type:'rshot', title:'Fun Moment', user:'King', url:'https://www.w3schools.com/html/movie.mp4'}
    ];
    let favorites = JSON.parse(localStorage.getItem('rasstube_favs') || '[]');
    let messages = JSON.parse(localStorage.getItem('rasstube_msgs') || '[]');
    let currentChat = 'global';

    // --- AUTHENTIFICATION ---
    function previewPfp(input) {
        if(input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => document.getElementById('pfp-prev').src = e.target.result;
            reader.readAsDataURL(input.files[0]);
        }
    }

    function login() {
        const name = document.getElementById('user-name').value;
        const pfp = document.getElementById('pfp-prev').src;
        if(name.length < 2) return alert("Pseudo trop court");
        user = { name, pfp };
        localStorage.setItem('rasstube_user', JSON.stringify(user));
        location.reload();
    }

    // --- NAVIGATION ---
    function nav(pageId, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById(pageId).classList.add('active-page');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        if(pageId === 'p-chat') renderChat();
        if(pageId === 'p-home') renderHome();
    }

    // --- LOGIQUE CONTENU ---
    function renderHome(filter = "") {
        const feed = document.getElementById('feed-home');
        feed.innerHTML = db_content.filter(i => i.type === 'video' && i.title.toLowerCase().includes(filter.toLowerCase())).map(i => `
            <div class="v-card">
                <video src="${i.url}" controls></video>
                <div class="v-body">
                    <button class="sub-btn" onclick="this.classList.toggle('active'); this.innerText=this.classList.contains('active')?'Abonné':'S\'abonner'">S'abonner</button>
                    <b>${i.title}</b><br><small>@${i.user}</small>
                    <div class="v-actions">
                        <div class="icon-group">
                            <i class="far fa-heart" onclick="this.classList.toggle('fas'); this.style.color=this.classList.contains('fas')?'red':'white'"></i>
                            <i class="fas fa-star" style="color:${favorites.includes(i.id)?'gold':'#444'}" onclick="toggleFav(${i.id})"></i>
                            <i class="fas fa-share"></i>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');

        const rfeed = document.getElementById('feed-rshot');
        rfeed.innerHTML = db_content.filter(i => i.type === 'rshot').map(i => `
            <div class="rshot-item"><video src="${i.url}" loop onclick="this.paused?this.play():this.pause()"></video></div>
        `).join('');
    }

    function toggleFav(id) {
        if(favorites.includes(id)) favorites = favorites.filter(f => f !== id);
        else favorites.push(id);
        localStorage.setItem('rasstube_favs', JSON.stringify(favorites));
        renderHome();
        renderFavs();
    }

    function renderFavs() {
        const feed = document.getElementById('feed-fav');
        feed.innerHTML = db_content.filter(i => favorites.includes(i.id)).map(i => `<div class="v-card"><video src="${i.url}" controls></video><div class="v-body"><b>${i.title}</b></div></div>`).join('');
    }

    function doSearch() { renderHome(document.getElementById('search-in').value); }

    // --- LOGIQUE CHAT ---
    function switchChat(mode) {
        currentChat = mode;
        document.getElementById('tg-global').style.background = mode === 'global' ? 'var(--red)' : '#222';
        document.getElementById('tg-ai').style.background = mode === 'ai' ? 'var(--ai)' : '#222';
        renderChat();
    }

    function sendChat() {
        const input = document.getElementById('chat-msg');
        if(!input.value) return;
        messages.push({ text: input.value, user: user.name, type: 'me', mode: currentChat });
        
        if(currentChat === 'ai') {
            setTimeout(() => {
                messages.push({ text: "Je suis Gemini, l'IA de Rasstube. Comment puis-je t'aider ?", user: 'Gemini', type: 'ai', mode: 'ai' });
                renderChat();
            }, 800);
        }
        input.value = "";
        localStorage.setItem('rasstube_msgs', JSON.stringify(messages));
        renderChat();
    }

    function renderChat() {
        const box = document.getElementById('chat-box');
        box.innerHTML = messages.filter(m => m.mode === currentChat).map(m => `
            <div class="bubble ${m.type === 'me' ? 'me' : (m.type === 'ai' ? 'ai-bubble' : 'other')}">
                <small style="opacity:0.6; font-size:10px;">${m.user}</small><br>${m.text}
            </div>
        `).join('');
        box.scrollTop = box.scrollHeight;
    }

    // --- INIT ---
    window.onload = () => {
        if(user) {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app-header').style.display = 'block';
            document.getElementById('app-main').style.display = 'block';
            document.getElementById('app-nav').style.display = 'flex';
            document.getElementById('user-info').innerHTML = `<span>${user.name}</span><img src="${user.pfp}" style="width:30px;height:30px;border-radius:50%;border:1px solid red;">`;
            renderHome();
            renderFavs();
        }
    };
</script>
</body>
</html>
