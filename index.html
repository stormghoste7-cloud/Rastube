<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RASSTUBE ULTIMATE | v4.0 Elite Ecosystem</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #FF0032;
            --accent-soft: rgba(255, 0, 50, 0.15);
            --accent-glow: rgba(255, 0, 50, 0.5);
            --bg-deep: #050505;
            --bg-card: #0F0F0F;
            --bg-elevated: #1A1A1A;
            --bg-input: #121212;
            --text-main: #FFFFFF;
            --text-dim: #909090;
            --border: rgba(255, 255, 255, 0.08);
            --ai-color: #00D1FF;
            --success: #00FF85;
            --warning: #FFAA00;
            --youtube-red: #FF0000;
            --instagram-purple: #E4405F;
            --tiktok-pink: #FF0050;
            --radius-xl: 32px;
            --radius-lg: 20px;
            --radius-md: 12px;
            --shadow-lg: 0 20px 40px rgba(0,0,0,0.6);
            --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        /* RESET & BASE */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: var(--bg-deep); color: var(--text-main); 
            margin: 0; font-family: 'Plus Jakarta Sans', sans-serif;
            overflow-x: hidden; -webkit-user-select: none;
            min-height: 100vh;
        }

        /* ANIMATIONS */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseAccent { 0% { box-shadow: 0 0 0 0 var(--accent-glow); } 70% { box-shadow: 0 0 0 15px rgba(255, 0, 50, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 50, 0); } }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes heartbeat { 0% { transform: scale(1); } 25% { transform: scale(1.1); } 50% { transform: scale(1); } 75% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* --- AUTHENTIFICATION ENGINE --- */
        #auth-portal {
            position: fixed; 
            inset: 0; 
            z-index: 9999; 
            background: radial-gradient(circle at top right, #1a0505, #000);
            display: flex; 
            align-items: flex-start;
            justify-content: center; 
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .auth-container {
            width: 100%; 
            max-width: 440px; 
            background: var(--bg-card);
            border-radius: var(--radius-xl); 
            border: 1px solid var(--border);
            padding: 40px 35px; 
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.8s ease;
            margin: 20px 0;
        }

        .auth-tabs {
            display: flex; background: var(--bg-input); padding: 6px;
            border-radius: 18px; margin-bottom: 30px; border: 1px solid var(--border);
        }

        .auth-tabs button {
            flex: 1; padding: 14px; border: none; background: none;
            color: var(--text-dim); font-weight: 700; cursor: pointer;
            border-radius: 14px; transition: var(--transition);
        }

        .auth-tabs button.active { background: var(--accent); color: white; box-shadow: 0 4px 15px var(--accent-glow); }

        .input-box { margin-bottom: 20px; position: relative; }
        .input-box i { position: absolute; left: 18px; top: 18px; color: var(--text-dim); font-size: 18px; }
        .input-control {
            width: 100%; padding: 18px 18px 18px 52px; background: var(--bg-input);
            border: 1px solid var(--border); border-radius: 18px; color: white;
            font-size: 15px; transition: var(--transition);
        }
        .input-control:focus { border-color: var(--accent); outline: none; background: #161616; }

        .pfp-selector { text-align: center; margin-bottom: 25px; }
        .pfp-main-preview {
            width: 110px; height: 110px; border-radius: 50%;
            border: 3px solid var(--accent); padding: 4px; object-fit: cover;
            margin-bottom: 15px; transition: var(--transition);
        }
        .pfp-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 15px;
        }
        .pfp-item {
            aspect-ratio: 1; border-radius: 14px; overflow: hidden; cursor: pointer;
            border: 2px solid transparent; transition: var(--transition);
        }
        .pfp-item.selected { border-color: var(--accent); transform: scale(1.1); }
        .pfp-item img { width: 100%; height: 100%; object-fit: cover; }

        /* --- CORE APP LAYOUT --- */
        #main-app { display: none; padding-bottom: 90px; min-height: 100vh; }

        .top-nav {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(25px);
            padding: 15px 20px; border-bottom: 1px solid var(--border);
        }

        .nav-wrapper {
            max-width: 1400px; margin: 0 auto;
            display: flex; justify-content: space-between; align-items: center;
        }

        .brand { 
            font-size: 28px; font-weight: 900; 
            background: linear-gradient(45deg, #FF0032, #FF8A00);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: -1.5px;
        }

        .search-bar {
            background: var(--bg-elevated); border-radius: 14px;
            padding: 10px 18px; display: flex; align-items: center;
            width: 40%; border: 1px solid var(--border);
        }
        .search-bar input { background: none; border: none; color: white; margin-left: 10px; width: 100%; outline: none; }

        /* --- SECTIONS --- */
        .content-container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

        /* Stories Instagram Style */
        .story-scroller {
            display: flex; gap: 18px; overflow-x: auto; padding: 10px 0 25px;
            scrollbar-width: none;
        }
        .story-scroller::-webkit-scrollbar { display: none; }
        .story-card {
            flex-shrink: 0; width: 85px; text-align: center; cursor: pointer;
        }
        .story-ring {
            width: 78px; height: 78px; border-radius: 50%; padding: 3px;
            background: linear-gradient(45deg, var(--instagram-purple), var(--tiktok-pink));
            margin-bottom: 8px; transition: var(--transition);
        }
        .story-card img { width: 100%; height: 100%; border-radius: 50%; border: 3px solid var(--bg-deep); object-fit: cover; }
        .story-card:active .story-ring { transform: scale(0.9); }
        .story-label { font-size: 11px; font-weight: 600; color: var(--text-dim); }

        /* --- RSSHORT SECTION (TikTok Style) --- */
        #sec-rsshort {
            position: relative;
            height: calc(100vh - 140px);
            overflow: hidden;
        }

        .rsshort-container {
            height: 100%;
            position: relative;
        }

        .rsshort-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0;
        }

        .rsshort-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 30px 20px 100px;
            color: white;
            z-index: 2;
        }

        .rsshort-side-buttons {
            position: absolute;
            right: 20px;
            bottom: 150px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            align-items: center;
            z-index: 3;
        }

        .rsshort-btn {
            background: none;
            border: none;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .rsshort-btn i {
            width: 50px;
            height: 50px;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: var(--transition);
        }

        .rsshort-btn.active i {
            color: var(--accent);
            background: rgba(255, 0, 50, 0.2);
        }

        .rsshort-btn:active i {
            transform: scale(1.2);
        }

        .rsshort-progress {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255,255,255,0.3);
            z-index: 4;
        }

        .rsshort-progress-bar {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.1s linear;
        }

        /* --- PHOTOS SECTION (Instagram Style) --- */
        .photos-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            margin-top: 20px;
        }

        .photo-item {
            aspect-ratio: 1;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .photo-item:hover img {
            transform: scale(1.05);
        }

        .photo-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .photo-item:hover .photo-overlay {
            opacity: 1;
        }

        .photo-stats {
            display: flex;
            gap: 20px;
            color: white;
            font-weight: 600;
        }

        .photo-stats span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- EXPLORE SECTION (YouTube Style) --- */
        .explore-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .explore-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .explore-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .explore-thumbnail {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
            display: block;
        }

        .explore-info {
            padding: 15px;
        }

        .explore-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .explore-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-dim);
            font-size: 13px;
        }

        /* --- HOME FEED (Mixed Content) --- */
        .feed-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .post {
            background: var(--bg-card); border-radius: var(--radius-lg);
            margin-bottom: 35px; border: 1px solid var(--border);
            overflow: hidden; animation: fadeIn 0.6s ease;
        }
        .post-head { padding: 18px; display: flex; align-items: center; justify-content: space-between; }
        .user-info { display: flex; align-items: center; gap: 14px; }
        .user-info img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent); }
        .user-meta h4 { margin: 0; font-size: 15px; font-weight: 700; }
        .user-meta span { font-size: 11px; color: var(--text-dim); }

        .post-media { width: 100%; background: #000; position: relative; cursor: pointer; }
        .post-media img, .post-media video { width: 100%; display: block; max-height: 650px; object-fit: contain; }

        .post-actions { padding: 15px 20px; display: flex; justify-content: space-around; font-size: 24px; }
        .action-btn { cursor: pointer; transition: var(--transition); color: var(--text-main); position: relative; }
        .action-btn:active { transform: scale(1.3); }
        .action-btn.active { color: var(--accent); }
        .action-btn.liked i { animation: heartbeat 0.5s ease; }

        .post-details { padding: 0 20px 20px; }
        .likes-count { font-weight: 800; font-size: 14px; margin-bottom: 8px; display: block; }
        .caption { font-size: 14px; line-height: 1.5; }
        .caption b { margin-right: 8px; color: var(--accent); }

        /* --- TRENDING SECTION --- */
        .trending-tags {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 15px 0;
            margin-bottom: 20px;
        }

        .trending-tag {
            padding: 8px 16px;
            background: var(--bg-input);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .trending-tag.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .trending-tag:hover {
            transform: translateY(-2px);
        }

        /* --- BOTTOM NAV (Modern) --- */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(15, 15, 15, 0.95); backdrop-filter: blur(30px);
            border-top: 1px solid var(--border); padding: 12px 10px 22px;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000;
        }
        .nav-item { 
            color: var(--text-dim); text-align: center; 
            flex: 1; transition: var(--transition); cursor: pointer; 
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .nav-item.active { color: var(--accent); transform: translateY(-5px); }
        .nav-item i { font-size: 22px; display: block; margin-bottom: 4px; }
        .nav-item span { font-size: 10px; font-weight: 700; text-transform: uppercase; }

        .fab-upload {
            background: var(--accent); width: 60px; height: 60px;
            border-radius: 22px; display: flex; align-items: center; justify-content: center;
            margin-top: -45px; border: 6px solid var(--bg-deep);
            color: white !important; font-size: 26px !important;
            animation: pulseAccent 2s infinite;
            cursor: pointer;
            z-index: 1001;
        }

        /* --- MODALS & OVERLAYS --- */
        .modal {
            position: fixed; inset: 0; z-index: 2000;
            background: rgba(0,0,0,0.95); display: none;
            padding: 20px; overflow-y: auto;
        }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content {
            background: var(--bg-card); border-radius: var(--radius-lg);
            max-width: 800px; width: 100%; overflow: hidden;
        }
        .modal-header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 20px; border-bottom: 1px solid var(--border);
        }
        .modal-header h3 { margin: 0; }

        /* --- TOAST SYSTEM --- */
        #notification-box {
            position: fixed; top: 25px; right: 25px; z-index: 10000;
            max-width: 350px;
        }
        .toast {
            background: var(--bg-elevated); border-left: 4px solid var(--accent);
            padding: 18px 25px; border-radius: 14px; margin-bottom: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: flex; align-items: center;
            gap: 15px; animation: slideInRight 0.5s ease;
        }
        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: #ff4444; }
        .toast.warning { border-left-color: var(--warning); }

        /* --- LOADER --- */
        .loader {
            width: 30px; height: 30px; border: 3px solid var(--border);
            border-top-color: var(--accent); border-radius: 50%;
            animation: spin 0.8s linear infinite; display: none;
        }
        .loader.active { display: inline-block; }

        /* --- LIVE BADGE --- */
        .live-badge {
            background: var(--youtube-red);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 4px;
            animation: pulseAccent 2s infinite;
        }

        /* --- SUBSCRIBE BUTTON --- */
        .subscribe-btn {
            background: var(--youtube-red);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-md);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-size: 13px;
        }
        .subscribe-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
        }
        .subscribe-btn.subscribed {
            background: var(--bg-elevated);
            color: var(--text-dim);
            border: 1px solid var(--border);
        }

        /* --- COMMENTS SECTION --- */
        .comments-section {
            margin-top: 20px;
            border-top: 1px solid var(--border);
            padding-top: 20px;
        }

        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            padding: 12px;
            border-radius: var(--radius-md);
            background: var(--bg-input);
        }

        .comment-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .comment-input input {
            flex: 1;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 12px;
            color: white;
            outline: none;
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            .nav-wrapper { flex-wrap: wrap; gap: 15px; }
            .search-bar { width: 100%; order: 3; }
            .content-container { padding: 0 15px; }
            .auth-container { 
                padding: 30px 25px; 
                margin: 10px 0;
            }
            #auth-portal { padding: 15px; }
            .pfp-grid { grid-template-columns: repeat(3, 1fr); }
            .bottom-bar { padding: 12px 5px 22px; }
            .nav-item i { font-size: 20px; }
            .nav-item span { font-size: 9px; }
            .photos-grid { grid-template-columns: repeat(2, 1fr); }
            .explore-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .brand { font-size: 24px; }
            .post-actions { font-size: 20px; }
            .story-card { width: 70px; }
            .story-ring { width: 65px; height: 65px; }
            .auth-container { padding: 25px 20px; }
            .rsshort-side-buttons { right: 10px; bottom: 120px; }
            .rsshort-btn i { width: 40px; height: 40px; font-size: 18px; }
        }

        /* --- UTILITY CLASSES --- */
        .hidden { display: none !important; }
        .visible { display: block !important; }
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-10 { gap: 10px; }
        .gap-20 { gap: 20px; }
        .w-full { width: 100%; }

        /* --- HASHTAGS --- */
        .hashtag {
            color: #0095f6;
            font-weight: 500;
            cursor: pointer;
        }

        /* --- REELS/RSSHORT INDICATOR --- */
        .reels-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: linear-gradient(45deg, var(--tiktok-pink), #00f2ea);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 12px;
            z-index: 3;
        }
    </style>
</head>
<body>

<div id="notification-box"></div>

<div id="auth-portal">
    <div class="auth-container">
        <div class="brand text-center" style="margin-bottom: 30px; font-size: 42px;">RASSTUBE</div>
        
        <div class="auth-tabs">
            <button id="tab-login" class="active" onclick="App.toggleAuth('login')">CONNEXION</button>
            <button id="tab-signup" onclick="App.toggleAuth('signup')">INSCRIPTION</button>
        </div>

        <div id="signup-profile-setup" class="hidden">
            <div class="pfp-selector">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Rass" class="pfp-main-preview" id="auth-pfp-preview">
                <div class="mt-20">
                    <button onclick="App.triggerPfpUpload()" style="background:var(--accent-soft); color:var(--accent); border:none; padding:10px 20px; border-radius:12px; font-weight:700; cursor:pointer; display: inline-flex; align-items: center; gap: 8px;">
                        <i class="fas fa-camera"></i> MA PHOTO
                    </button>
                </div>
                <input type="file" id="real-pfp-input" class="hidden" accept="image/*" onchange="App.handlePfpFile(event)">
                
                <div class="pfp-grid" id="default-avatars"></div>
            </div>
            
            <div class="input-box">
                <i class="fas fa-user-tag"></i>
                <input type="text" id="reg-pseudo" class="input-control" placeholder="Ton Pseudo Elite">
            </div>
        </div>

        <div class="input-box">
            <i class="fas fa-envelope"></i>
            <input type="email" id="auth-email" class="input-control" placeholder="Adresse e-mail">
        </div>
        
        <div class="input-box">
            <i class="fas fa-lock"></i>
            <input type="password" id="auth-pass" class="input-control" placeholder="Mot de passe (6+ caract√®res)">
        </div>

        <button onclick="App.executeAuth()" id="auth-btn" style="width: 100%; padding: 22px; background: var(--accent); color: white; border: none; border-radius: 20px; font-weight: 800; font-size: 16px; margin-top: 15px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <span id="auth-btn-text">REJOINDRE LE R√âSEAU</span>
            <div class="loader" id="auth-loader"></div>
        </button>
        
        <p id="auth-msg" style="text-align: center; color: #ff4444; font-size: 13px; margin-top: 20px; display: none;"></p>
    </div>
</div>

<div id="main-app">
    <header class="top-nav">
        <div class="nav-wrapper">
            <div class="brand">RASSTUBE</div>
            <div class="search-bar">
                <i class="fas fa-search" style="color:var(--text-dim)"></i>
                <input type="text" id="search-input" placeholder="Rechercher vid√©os, photos, personnes..." onkeyup="App.filterContent(this.value)">
            </div>
            <div style="display: flex; gap: 20px; align-items: center;">
                <i class="fas fa-bell" style="font-size: 20px; cursor: pointer;" title="Notifications" onclick="App.showNotifications()"></i>
                <i class="fas fa-paper-plane" style="font-size: 20px; cursor: pointer;" title="Messages" onclick="App.showMessages()"></i>
                <img src="" id="user-pfp-top" style="width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--accent); cursor: pointer;" onclick="App.go('profile')" alt="Profil">
            </div>
        </div>
    </header>

    <main class="content-container">
        <!-- HOME SECTION (Mixed Feed) -->
        <section id="sec-home" class="app-section">
            <div class="story-scroller" id="story-container"></div>
            
            <!-- Trending Tags -->
            <div class="trending-tags" id="trending-tags"></div>
            
            <!-- Main Feed -->
            <div class="feed-container" id="main-feed"></div>
        </section>

        <!-- RSSHORT SECTION (TikTok Style) -->
        <section id="sec-rsshort" class="app-section hidden">
            <div class="reels-indicator">
                <i class="fas fa-play-circle"></i> RSSHORT
            </div>
            <div class="rsshort-progress">
                <div class="rsshort-progress-bar" id="rsshort-progress"></div>
            </div>
            <div class="rsshort-container" id="rsshort-container"></div>
            <div class="rsshort-side-buttons" id="rsshort-side-buttons"></div>
            <div class="rsshort-overlay" id="rsshort-overlay"></div>
        </section>

        <!-- EXPLORE SECTION (YouTube Style) -->
        <section id="sec-explore" class="app-section hidden">
            <h2 style="margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-compass" style="color:var(--accent)"></i> Explorer
            </h2>
            
            <div class="trending-tags" id="explore-tags"></div>
            
            <div class="explore-grid" id="explore-grid"></div>
        </section>

        <!-- PHOTOS SECTION (Instagram Style) -->
        <section id="sec-photos" class="app-section hidden">
            <h2 style="margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-images" style="color:var(--instagram-purple)"></i> Photos
            </h2>
            
            <div class="photos-grid" id="photos-grid"></div>
        </section>

        <!-- UPLOAD SECTION -->
        <section id="sec-upload" class="app-section hidden">
            <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
                <h3 style="margin-top: 0; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-plus-circle" style="color:var(--accent)"></i> Nouvelle Publication
                </h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <!-- Left Column: Upload Options -->
                    <div>
                        <div style="border: 2px dashed var(--border); border-radius: var(--radius-lg); padding: 40px; text-align: center; cursor: pointer;" onclick="document.getElementById('file-upload').click()" id="upload-dropzone">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 50px; color: var(--accent); margin-bottom: 15px;"></i>
                            <p style="margin: 0; font-weight: 700; font-size: 18px;">Importer un fichier</p>
                            <p style="margin: 10px 0 0; font-size: 14px; color: var(--text-dim);">Vid√©o, photo ou RShort</p>
                            <input type="file" id="file-upload" class="hidden" accept="video/*,image/*" onchange="App.previewUpload(event)" multiple>
                        </div>

                        <div id="upload-preview" class="hidden" style="margin-top: 25px; border-radius: var(--radius-lg); overflow: hidden;"></div>
                    </div>

                    <!-- Right Column: Post Details -->
                    <div>
                        <div class="input-box">
                            <i class="fas fa-heading"></i>
                            <input type="text" id="up-title" class="input-control" placeholder="Titre de la publication">
                        </div>

                        <div class="input-box">
                            <i class="fas fa-tag"></i>
                            <input type="text" id="up-tags" class="input-control" placeholder="Hashtags (s√©par√©s par des virgules)">
                        </div>

                        <div class="input-box">
                            <i class="fas fa-globe"></i>
                            <select id="up-visibility" class="input-control" style="appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 12 12\"><path fill=\"%23909090\" d=\"M2 4l4 4 4-4z\"/></svg>'); background-repeat: no-repeat; background-position: right 18px center; background-size: 12px;">
                                <option value="public">üåç Public (tout le monde)</option>
                                <option value="followers">üîí Abonn√©s uniquement</option>
                                <option value="private">üë§ Priv√© (moi uniquement)</option>
                            </select>
                        </div>

                        <div class="input-box">
                            <i class="fas fa-layer-group"></i>
                            <select id="up-type" class="input-control" style="appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"12\" viewBox=\"0 0 12 12\"><path fill=\"%23909090\" d=\"M2 4l4 4 4-4z\"/></svg>'); background-repeat: no-repeat; background-position: right 18px center; background-size: 12px;">
                                <option value="video">üé¨ Vid√©o Standard</option>
                                <option value="photo">üì∑ Photo</option>
                                <option value="rshort">‚ö° RShort (format court)</option>
                                <option value="live">üî¥ Live</option>
                            </select>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 30px;">
                            <button onclick="App.publishPost()" style="flex: 1; padding: 18px; background: var(--accent); color: white; border: none; border-radius: var(--radius-md); font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
                                <i class="fas fa-paper-plane"></i>
                                <span id="publish-text">PUBLIER</span>
                                <div class="loader" id="publish-loader"></div>
                            </button>
                            
                            <button onclick="App.saveDraft()" style="padding: 18px 25px; background: var(--bg-input); color: var(--text-dim); border: 1px solid var(--border); border-radius: var(--radius-md); font-weight: 600; cursor: pointer;">
                                <i class="fas fa-save"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PROFILE SECTION -->
        <section id="sec-profile" class="app-section hidden">
            <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
                <!-- Profile Header -->
                <div style="display: flex; gap: 30px; margin-bottom: 40px; align-items: flex-start;">
                    <img src="" id="prof-pfp" style="width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--accent); padding: 5px; object-fit: cover;">
                    
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                            <h2 id="prof-name" style="margin: 0; font-size: 28px; font-weight: 800;"></h2>
                            <button onclick="App.editProfile()" style="background: var(--bg-input); border: 1px solid var(--border); color: var(--text-main); padding: 8px 20px; border-radius: var(--radius-md); font-weight: 600; cursor: pointer;">
                                <i class="fas fa-edit"></i> Modifier
                            </button>
                            <button onclick="App.logout()" style="background: var(--bg-input); border: 1px solid var(--border); color: #ff4444; padding: 8px 20px; border-radius: var(--radius-md); font-weight: 600; cursor: pointer;">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                        
                        <p id="prof-email" style="color: var(--text-dim); margin-top: 5px; margin-bottom: 20px;"></p>
                        
                        <p id="prof-bio" style="margin-bottom: 25px; line-height: 1.5;"></p>
                        
                        <div style="display: flex; gap: 30px;">
                            <div style="text-align: center;">
                                <b style="display: block; font-size: 18px;" id="count-posts">0</b>
                                <span style="font-size: 13px; color: var(--text-dim);">Publications</span>
                            </div>
                            <div style="text-align: center; cursor: pointer;" onclick="App.showFollowers()">
                                <b style="display: block; font-size: 18px;" id="count-followers">0</b>
                                <span style="font-size: 13px; color: var(--text-dim);">Abonn√©s</span>
                            </div>
                            <div style="text-align: center; cursor: pointer;" onclick="App.showFollowing()">
                                <b style="display: block; font-size: 18px;" id="count-following">0</b>
                                <span style="font-size: 13px; color: var(--text-dim);">Abonnements</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Tabs -->
                <div style="display: flex; border-bottom: 1px solid var(--border); margin-bottom: 30px;">
                    <button class="profile-tab active" onclick="App.switchProfileTab('posts')" style="padding: 15px 20px; background: none; border: none; color: var(--accent); border-bottom: 2px solid var(--accent); font-weight: 700; cursor: pointer;">
                        <i class="fas fa-th-large"></i> Publications
                    </button>
                    <button class="profile-tab" onclick="App.switchProfileTab('rshorts')" style="padding: 15px 20px; background: none; border: none; color: var(--text-dim); font-weight: 600; cursor: pointer;">
                        <i class="fas fa-play-circle"></i> RShorts
                    </button>
                    <button class="profile-tab" onclick="App.switchProfileTab('saved')" style="padding: 15px 20px; background: none; border: none; color: var(--text-dim); font-weight: 600; cursor: pointer;">
                        <i class="fas fa-bookmark"></i> Enregistr√©s
                    </button>
                </div>

                <!-- Profile Content -->
                <div id="profile-posts" class="profile-content">
                    <div class="photos-grid" id="profile-grid"></div>
                </div>
                
                <div id="profile-rshorts" class="profile-content hidden">
                    <div style="text-align: center; padding: 40px; color: var(--text-dim);" id="rshorts-container">
                        <i class="fas fa-play-circle" style="font-size: 50px; margin-bottom: 20px; color: var(--tiktok-pink);"></i>
                        <p>Aucun RShort pour le moment</p>
                    </div>
                </div>
                
                <div id="profile-saved" class="profile-content hidden">
                    <div style="text-align: center; padding: 40px; color: var(--text-dim);">
                        <i class="fas fa-bookmark" style="font-size: 50px; margin-bottom: 20px; color: var(--accent);"></i>
                        <p>Contenu enregistr√©</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- BOTTOM NAVIGATION -->
    <nav class="bottom-bar">
        <div class="nav-item active" onclick="App.go('home')">
            <i class="fas fa-home"></i>
            <span>Accueil</span>
        </div>
        <div class="nav-item" onclick="App.go('explore')">
            <i class="fas fa-compass"></i>
            <span>Explorer</span>
        </div>
        <div class="fab-upload" onclick="App.go('upload')" id="fab-upload-btn">
            <i class="fas fa-plus"></i>
        </div>
        <div class="nav-item" onclick="App.go('rsshort')">
            <i class="fas fa-play-circle"></i>
            <span>RShort</span>
        </div>
        <div class="nav-item" onclick="App.go('photos')">
            <i class="fas fa-images"></i>
            <span>Photos</span>
        </div>
    </nav>
</div>

<script>
/**
 * RASSTUBE ULTIMATE v4.0 - R√©seau Social Complet
 * Inspir√© de YouTube, TikTok et Instagram
 */

const App = {
    // √âTAT GLOBAL
    state: {
        users: JSON.parse(localStorage.getItem('rt_v4_users') || '[]'),
        posts: JSON.parse(localStorage.getItem('rt_v4_posts') || '[]'),
        session: JSON.parse(localStorage.getItem('rt_v4_session') || 'null'),
        currentTab: 'login',
        selectedPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rass',
        activeSection: 'home',
        isUploading: false,
        subscriptions: JSON.parse(localStorage.getItem('rt_v4_subscriptions') || '{}'),
        messages: JSON.parse(localStorage.getItem('rt_v4_messages') || '[]'),
        savedPosts: JSON.parse(localStorage.getItem('rt_v4_saved') || '[]'),
        currentRshort: 0,
        rshortPlaying: true,
        profileTab: 'posts',
        
        // Trending tags
        trendingTags: [
            { name: 'PourVous', count: 1254 },
            { name: 'Tendances', count: 892 },
            { name: 'Gaming', count: 756 },
            { name: 'Musique', count: 634 },
            { name: 'Mode', count: 521 },
            { name: 'Cuisine', count: 489 },
            { name: 'Sport', count: 432 },
            { name: 'Tech', count: 398 },
            { name: 'Voyage', count: 365 },
            { name: 'Art', count: 321 }
        ]
    },

    // INITIALISATION
    init() {
        this.verifySession();
        this.renderAvatars();
        this.sync();

        if(this.state.session) {
            this.launch();
        }
        
        // Cr√©er des donn√©es par d√©faut
        if(this.state.posts.length === 0) {
            this.createDefaultData();
        }
    },

    // CR√âATION DES DONN√âES PAR D√âFAUT
    createDefaultData() {
        const defaultUsers = [
            { 
                pseudo: 'Rayan', 
                email: 'rayan@example.com',
                pass: '123456',
                pfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rayan',
                bio: 'Gamer & Content Creator üéÆ',
                followers: 1245,
                following: 89
            },
            { 
                pseudo: 'Sarah', 
                email: 'sarah@example.com',
                pass: '123456',
                pfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah',
                bio: 'Photographe voyage üåç',
                followers: 892,
                following: 156
            },
            { 
                pseudo: 'Alex', 
                email: 'alex@example.com',
                pass: '123456',
                pfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Alex',
                bio: 'Chef cuisinier üë®‚Äçüç≥',
                followers: 2103,
                following: 234
            }
        ];
        
        defaultUsers.forEach(user => {
            if(!this.state.users.find(u => u.pseudo === user.pseudo)) {
                this.state.users.push({
                    id: Date.now() + Math.random(),
                    ...user,
                    joined: new Date().toLocaleDateString('fr-FR')
                });
            }
        });

        const defaultPosts = [
            {
                id: 1,
                author: 'Rayan',
                authorPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rayan',
                title: 'Nouveau record sur Fortnite ! üéÆ #gaming #fortnite',
                type: 'rshort',
                content: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4',
                likes: 1245,
                likedBy: ['Rayan', 'Sarah'],
                comments: 89,
                shares: 45,
                views: 12500,
                duration: 15,
                timestamp: new Date(Date.now() - 3600000).toISOString(),
                tags: ['gaming', 'fortnite', 'record']
            },
            {
                id: 2,
                author: 'Sarah',
                authorPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah',
                title: 'Coucher de soleil √† Bali üåÖ #voyage #bali #photographie',
                type: 'photo',
                content: 'https://images.unsplash.com/photo-1518548419970-58e3b4079ab2?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                likes: 892,
                likedBy: ['Sarah', 'Alex'],
                comments: 67,
                shares: 23,
                views: 8900,
                timestamp: new Date(Date.now() - 7200000).toISOString(),
                tags: ['voyage', 'bali', 'photographie']
            },
            {
                id: 3,
                author: 'Alex',
                authorPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Alex',
                title: 'Recette de p√¢tes carbonara traditionnelle üçù #cuisine #recette',
                type: 'video',
                content: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4',
                likes: 1567,
                likedBy: ['Alex', 'Rayan'],
                comments: 123,
                shares: 78,
                views: 25600,
                duration: 240,
                timestamp: new Date(Date.now() - 10800000).toISOString(),
                tags: ['cuisine', 'recette', 'italie']
            },
            {
                id: 4,
                author: 'Rayan',
                authorPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rayan',
                title: 'Montage gaming √©pique üé¨ #montage #gaming',
                type: 'video',
                content: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4',
                likes: 2345,
                likedBy: ['Rayan', 'Alex'],
                comments: 189,
                shares: 92,
                views: 45200,
                duration: 180,
                timestamp: new Date(Date.now() - 14400000).toISOString(),
                tags: ['gaming', 'montage', 'epic']
            }
        ];
        
        this.state.posts = defaultPosts;
        this.sync();
    },

    // V√âRIFICATION DE SESSION
    verifySession() {
        if(this.state.session) {
            const userExists = this.state.users.find(u => u.email === this.state.session.email);
            if(!userExists) {
                this.state.session = null;
                this.sync();
            }
        }
    },

    // SYNCHRONISATION
    sync() {
        try {
            localStorage.setItem('rt_v4_users', JSON.stringify(this.state.users));
            localStorage.setItem('rt_v4_posts', JSON.stringify(this.state.posts));
            localStorage.setItem('rt_v4_session', JSON.stringify(this.state.session));
            localStorage.setItem('rt_v4_subscriptions', JSON.stringify(this.state.subscriptions));
            localStorage.setItem('rt_v4_messages', JSON.stringify(this.state.messages));
            localStorage.setItem('rt_v4_saved', JSON.stringify(this.state.savedPosts));
        } catch(e) {
            console.error('Erreur de sauvegarde:', e);
            this.notify('Erreur de sauvegarde des donn√©es', 'error');
        }
    },

    // --- AUTHENTIFICATION ---
    toggleAuth(tab) {
        this.state.currentTab = tab;
        document.getElementById('tab-login').classList.toggle('active', tab === 'login');
        document.getElementById('tab-signup').classList.toggle('active', tab === 'signup');
        document.getElementById('signup-profile-setup').classList.toggle('hidden', tab === 'login');
        document.getElementById('auth-btn-text').innerText = tab === 'login' ? "SE CONNECTER" : "CR√âER MON COMPTE";
        
        document.getElementById('auth-msg').style.display = 'none';
    },

    validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    },

    executeAuth() {
        const email = document.getElementById('auth-email').value.trim();
        const pass = document.getElementById('auth-pass').value;
        const pseudo = document.getElementById('reg-pseudo')?.value.trim() || '';
        const msg = document.getElementById('auth-msg');
        const loader = document.getElementById('auth-loader');
        
        if(!email || !pass) {
            this.notify("Veuillez remplir tous les champs", "error");
            return;
        }
        
        if(!this.validateEmail(email)) {
            msg.innerText = "Email invalide !";
            msg.style.display = 'block';
            return;
        }
        
        if(pass.length < 6) {
            msg.innerText = "Mot de passe trop court (6+ caract√®res)";
            msg.style.display = 'block';
            return;
        }
        
        loader.classList.add('active');
        
        setTimeout(() => {
            if(this.state.currentTab === 'signup') {
                if(!pseudo) { 
                    this.notify("Pseudo requis", "error"); 
                    loader.classList.remove('active');
                    return; 
                }
                
                if(pseudo.length < 3) {
                    msg.innerText = "Pseudo trop court (3+ caract√®res)";
                    msg.style.display = 'block';
                    loader.classList.remove('active');
                    return;
                }
                
                if(this.state.users.find(u => u.email === email)) {
                    msg.innerText = "Cet email est d√©j√† utilis√© !";
                    msg.style.display = 'block';
                    loader.classList.remove('active');
                    return;
                }
                
                if(this.state.users.find(u => u.pseudo === pseudo)) {
                    msg.innerText = "Ce pseudo est d√©j√† pris !";
                    msg.style.display = 'block';
                    loader.classList.remove('active');
                    return;
                }

                const newUser = {
                    id: Date.now(),
                    pseudo,
                    email,
                    pass,
                    pfp: this.state.selectedPfp,
                    bio: "Nouvel utilisateur sur Rasstube !",
                    joined: new Date().toLocaleDateString('fr-FR'),
                    followers: 0,
                    following: 0
                };

                this.state.users.push(newUser);
                this.state.session = newUser;
                this.notify(`Compte cr√©√© avec succ√®s, ${pseudo} !`);
            } else {
                const user = this.state.users.find(u => u.email === email && u.pass === pass);
                if(!user) {
                    msg.innerText = "Email ou mot de passe incorrect";
                    msg.style.display = 'block';
                    loader.classList.remove('active');
                    return;
                }
                this.state.session = user;
                this.notify(`Heureux de vous revoir, ${user.pseudo} !`);
            }

            this.sync();
            loader.classList.remove('active');
            this.launch();
        }, 800);
    },

    // LANCEMENT APP
    launch() {
        document.getElementById('auth-portal').classList.add('hidden');
        document.getElementById('main-app').style.display = 'block';
        
        // Mettre √† jour l'interface
        document.getElementById('user-pfp-top').src = this.state.session.pfp;
        document.getElementById('prof-pfp').src = this.state.session.pfp;
        document.getElementById('prof-name').innerText = this.state.session.pseudo;
        document.getElementById('prof-email').innerText = this.state.session.email;
        document.getElementById('prof-bio').innerText = this.state.session.bio || "Aucune bio pour le moment";
        
        // Calculer les stats
        this.updateProfileStats();
        
        this.renderTrendingTags();
        this.renderFeed();
        this.renderStories();
        this.go('home');
    },

    updateProfileStats() {
        const userPosts = this.state.posts.filter(p => p.author === this.state.session.pseudo);
        document.getElementById('count-posts').innerText = userPosts.length;
        
        const userSubscriptions = this.state.subscriptions[this.state.session.pseudo] || { followers: [], following: [] };
        document.getElementById('count-followers').innerText = userSubscriptions.followers.length;
        document.getElementById('count-following').innerText = userSubscriptions.following.length;
    },

    // --- GESTION DES SECTIONS ---
    go(sec) {
        document.querySelectorAll('.app-section').forEach(s => s.classList.add('hidden'));
        document.getElementById('sec-' + sec).classList.remove('hidden');
        
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        
        const navIndexes = { home: 0, explore: 1, rsshort: 3, photos: 4 };
        if(navIndexes[sec] !== undefined) {
            document.querySelectorAll('.nav-item')[navIndexes[sec]].classList.add('active');
        }
        
        document.getElementById('fab-upload-btn').classList.toggle('active', sec === 'upload');
        
        switch(sec) {
            case 'profile': 
                this.renderProfile(); 
                break;
            case 'explore': 
                this.renderExplore(); 
                break;
            case 'rsshort':
                this.renderRshorts();
                break;
            case 'photos':
                this.renderPhotos();
                break;
            case 'upload':
                this.resetUploadForm();
                break;
        }
        
        this.state.activeSection = sec;
    },

    // --- TRENDING TAGS ---
    renderTrendingTags() {
        const container = document.getElementById('trending-tags');
        container.innerHTML = this.state.trendingTags.map(tag => `
            <div class="trending-tag" onclick="App.filterByTag('${tag.name}')">
                #${tag.name} <span style="color:var(--text-dim); font-size:12px;">${tag.count}</span>
            </div>
        `).join('');
    },

    filterByTag(tag) {
        const feed = document.getElementById('main-feed');
        const filtered = this.state.posts.filter(p => 
            p.tags && p.tags.includes(tag.toLowerCase())
        );
        
        if(filtered.length === 0) {
            feed.innerHTML = `
                <div style="text-align:center; padding:50px; color:var(--text-dim);">
                    <i class="fas fa-hashtag" style="font-size:40px; margin-bottom:15px;"></i>
                    <p>Aucune publication avec #${tag}</p>
                </div>`;
            return;
        }
        
        feed.innerHTML = filtered.map(p => this.renderPost(p)).join('');
    },

    // --- STORIES ---
    renderStories() {
        const cont = document.getElementById('story-container');
        const users = this.state.users
            .filter(u => u.pseudo !== this.state.session.pseudo)
            .slice(0, 10);
        
        cont.innerHTML = `
            <div class="story-card" onclick="App.addStory()">
                <div class="story-ring" style="background:var(--border); border:2px dashed var(--accent)">
                    <img src="${this.state.session.pfp}">
                    <div style="position:absolute; bottom:-5px; right:-5px; background:var(--accent); width:24px; height:24px; border-radius:50%; display:flex; align-items:center; justify-content:center; border:3px solid var(--bg-deep);">
                        <i class="fas fa-plus" style="font-size:10px;"></i>
                    </div>
                </div>
                <span class="story-label">Votre story</span>
            </div>
        ` + users.map(u => `
            <div class="story-card" onclick="App.viewStory('${u.pseudo}')">
                <div class="story-ring"><img src="${u.pfp}"></div>
                <span class="story-label">${u.pseudo}</span>
            </div>
        `).join('');
    },

    addStory() {
        this.notify('Fonctionnalit√© stories bient√¥t disponible !', 'info');
    },

    viewStory(user) {
        this.notify(`Story de ${user}`, 'info');
    },

    // --- RSSHORT SECTION (TikTok Style) ---
    renderRshorts() {
        const rshorts = this.state.posts.filter(p => p.type === 'rshort');
        if(rshorts.length === 0) {
            document.getElementById('rsshort-container').innerHTML = `
                <div style="display:flex; align-items:center; justify-content:center; height:100%; background:var(--bg-deep); color:white;">
                    <div style="text-align:center;">
                        <i class="fas fa-play-circle" style="font-size:60px; color:var(--tiktok-pink); margin-bottom:20px;"></i>
                        <h3>Aucun RShort disponible</h3>
                        <p>Soyez le premier √† cr√©er un RShort !</p>
                    </div>
                </div>
            `;
            return;
        }
        
        const currentRshort = rshorts[this.state.currentRshort];
        
        // Container principal
        document.getElementById('rsshort-container').innerHTML = `
            <video class="rsshort-video" id="rsshort-video" autoplay muted playsinline>
                <source src="${currentRshort.content}" type="video/mp4">
            </video>
        `;
        
        // Overlay avec infos
        document.getElementById('rsshort-overlay').innerHTML = `
            <div style="margin-bottom:15px;">
                <h3 style="margin:0 0 10px 0;">${currentRshort.author}</h3>
                <p style="margin:0; font-size:14px;">${currentRshort.title}</p>
            </div>
            <div style="display:flex; gap:15px; font-size:13px; color:var(--text-dim);">
                <span><i class="fas fa-music"></i> Son original</span>
                <span><i class="fas fa-eye"></i> ${this.formatNumber(currentRshort.views)} vues</span>
            </div>
        `;
        
        // Boutons lat√©raux
        document.getElementById('rsshort-side-buttons').innerHTML = `
            <div class="rsshort-btn ${currentRshort.likedBy.includes(this.state.session.pseudo) ? 'active' : ''}" onclick="App.likePost(${currentRshort.id})">
                <i class="fas fa-heart"></i>
                <span>${this.formatNumber(currentRshort.likes)}</span>
            </div>
            <div class="rsshort-btn" onclick="App.focusComment(${currentRshort.id})">
                <i class="fas fa-comment"></i>
                <span>${this.formatNumber(currentRshort.comments)}</span>
            </div>
            <div class="rsshort-btn" onclick="App.sharePost(${currentRshort.id})">
                <i class="fas fa-share"></i>
                <span>${this.formatNumber(currentRshort.shares)}</span>
            </div>
            <div class="rsshort-btn" onclick="App.toggleRshortPlay()">
                <i class="fas fa-${this.state.rshortPlaying ? 'pause' : 'play'}"></i>
                <span>${this.state.rshortPlaying ? 'Pause' : 'Play'}</span>
            </div>
        `;
        
        // Configurer la vid√©o
        const video = document.getElementById('rsshort-video');
        if(video) {
            video.onended = () => this.nextRshort();
            video.onclick = () => this.toggleRshortPlay();
            
            if(this.state.rshortPlaying) {
                video.play();
            } else {
                video.pause();
            }
        }
    },

    nextRshort() {
        const rshorts = this.state.posts.filter(p => p.type === 'rshort');
        this.state.currentRshort = (this.state.currentRshort + 1) % rshorts.length;
        this.renderRshorts();
    },

    prevRshort() {
        const rshorts = this.state.posts.filter(p => p.type === 'rshort');
        this.state.currentRshort = (this.state.currentRshort - 1 + rshorts.length) % rshorts.length;
        this.renderRshorts();
    },

    toggleRshortPlay() {
        this.state.rshortPlaying = !this.state.rshortPlaying;
        const video = document.getElementById('rsshort-video');
        if(video) {
            if(this.state.rshortPlaying) {
                video.play();
            } else {
                video.pause();
            }
            this.renderRshorts();
        }
    },

    // --- EXPLORE SECTION (YouTube Style) ---
    renderExplore() {
        const container = document.getElementById('explore-grid');
        const explorePosts = [...this.state.posts]
            .sort((a, b) => b.views - a.views)
            .slice(0, 12);
        
        if(explorePosts.length === 0) {
            container.innerHTML = `
                <div style="grid-column:1/-1; text-align:center; padding:50px; color:var(--text-dim);">
                    <i class="fas fa-compass" style="font-size:50px; margin-bottom:20px;"></i>
                    <h3>Rien √† explorer pour le moment</h3>
                    <p>Soyez le premier √† publier du contenu !</p>
                </div>`;
            return;
        }
        
        container.innerHTML = explorePosts.map(p => `
            <div class="explore-card" onclick="App.viewPost(${p.id})">
                <div style="position:relative;">
                    <img src="${p.type === 'photo' ? p.content : 'https://images.unsplash.com/photo-1611605698335-8b1569810432?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'}" class="explore-thumbnail">
                    ${p.type === 'video' || p.type === 'rshort' ? `
                        <div style="position:absolute; bottom:10px; right:10px; background:rgba(0,0,0,0.8); color:white; padding:4px 8px; border-radius:4px; font-size:12px;">
                            ${p.duration ? this.formatDuration(p.duration) : '0:00'}
                        </div>
                    ` : ''}
                </div>
                <div class="explore-info">
                    <div class="explore-title">${p.title.length > 50 ? p.title.substring(0, 50) + '...' : p.title}</div>
                    <div class="explore-meta">
                        <span>${p.author}</span>
                        <span>${this.formatNumber(p.views)} vues</span>
                    </div>
                </div>
            </div>
        `).join('');
    },

    // --- PHOTOS SECTION (Instagram Style) ---
    renderPhotos() {
        const container = document.getElementById('photos-grid');
        const photos = this.state.posts.filter(p => p.type === 'photo');
        
        if(photos.length === 0) {
            container.innerHTML = `
                <div style="grid-column:1/-1; text-align:center; padding:50px; color:var(--text-dim);">
                    <i class="fas fa-images" style="font-size:50px; margin-bottom:20px; color:var(--instagram-purple);"></i>
                    <h3>Aucune photo pour le moment</h3>
                    <p>Partagez vos premi√®res photos !</p>
                </div>`;
            return;
        }
        
        container.innerHTML = photos.map(p => `
            <div class="photo-item" onclick="App.viewPost(${p.id})">
                <img src="${p.content}" alt="${p.title}">
                <div class="photo-overlay">
                    <div class="photo-stats">
                        <span><i class="fas fa-heart"></i> ${this.formatNumber(p.likes)}</span>
                        <span><i class="fas fa-comment"></i> ${this.formatNumber(p.comments)}</span>
                    </div>
                </div>
            </div>
        `).join('');
    },

    // --- UPLOAD ---
    previewUpload(e) {
        const files = e.target.files;
        const preview = document.getElementById('upload-preview');
        
        if(!files || files.length === 0) return;
        
        preview.innerHTML = '';
        preview.classList.remove('hidden');
        
        Array.from(files).forEach((file, index) => {
            if(index >= 4) return; // Limite √† 4 fichiers
            
            if(file.size > 100 * 1024 * 1024) {
                this.notify(`${file.name} trop volumineux (max 100MB)`, 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (event) => {
                const item = document.createElement('div');
                item.style.cssText = 'margin-bottom:10px; border-radius:10px; overflow:hidden; position:relative;';
                
                if(file.type.includes('video')) {
                    item.innerHTML = `
                        <video src="${event.target.result}" style="width:100%; max-height:200px; object-fit:cover;" controls></video>
                        <div style="position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.7); color:white; padding:5px 10px; border-radius:5px; font-size:12px;">
                            ${this.formatDuration(file.duration || 0)}
                        </div>
                    `;
                } else {
                    item.innerHTML = `<img src="${event.target.result}" style="width:100%; max-height:200px; object-fit:cover;">`;
                }
                
                preview.appendChild(item);
            };
            reader.readAsDataURL(file);
        });
    },

    resetUploadForm() {
        document.getElementById('up-title').value = '';
        document.getElementById('up-tags').value = '';
        document.getElementById('upload-preview').innerHTML = '';
        document.getElementById('upload-preview').classList.add('hidden');
        document.getElementById('file-upload').value = '';
        document.getElementById('up-type').value = 'video';
        document.getElementById('up-visibility').value = 'public';
    },

    publishPost() {
        const fileInput = document.getElementById('file-upload');
        const files = fileInput.files;
        const title = document.getElementById('up-title').value.trim();
        const tags = document.getElementById('up-tags').value.split(',').map(t => t.trim()).filter(t => t);
        const type = document.getElementById('up-type').value;
        const visibility = document.getElementById('up-visibility').value;
        const publishBtn = document.getElementById('publish-text');
        const loader = document.getElementById('publish-loader');
        
        if(!files || files.length === 0) {
            this.notify("Veuillez s√©lectionner au moins un fichier", "error");
            return;
        }
        
        if(!title) {
            this.notify("Titre obligatoire", "error");
            return;
        }
        
        publishBtn.innerText = 'PUBLICATION...';
        loader.classList.add('active');
        this.state.isUploading = true;
        
        setTimeout(() => {
            Array.from(files).forEach((file, index) => {
                if(index >= 5) return; // Limite √† 5 publications
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const post = {
                        id: Date.now() + index,
                        author: this.state.session.pseudo,
                        authorPfp: this.state.session.pfp,
                        title: title + (files.length > 1 ? ` (${index + 1}/${files.length})` : ''),
                        type: type,
                        content: e.target.result,
                        likes: 0,
                        likedBy: [],
                        comments: 0,
                        shares: 0,
                        views: 0,
                        duration: file.type.includes('video') ? Math.floor(file.duration || 60) : null,
                        timestamp: new Date().toISOString(),
                        tags: tags,
                        visibility: visibility
                    };

                    this.state.posts.unshift(post);
                };
                reader.readAsDataURL(file);
            });
            
            this.sync();
            this.notify("Publication(s) en ligne !", "success");
            this.go('home');
            this.renderFeed();
            
            this.resetUploadForm();
            publishBtn.innerText = 'PUBLIER';
            loader.classList.remove('active');
            this.state.isUploading = false;
        }, 2000);
    },

    saveDraft() {
        this.notify("Brouillon enregistr√©", "info");
    },

    // --- RENDER POST ---
    renderPost(p) {
        const isLiked = p.likedBy.includes(this.state.session.pseudo);
        const isSaved = this.state.savedPosts.includes(p.id);
        const isSubscribed = this.isSubscribed(p.author);
        
        return `
            <div class="post" data-id="${p.id}">
                <div class="post-head">
                    <div class="user-info">
                        <img src="${p.authorPfp}" alt="${p.author}" onclick="App.viewUserProfile('${p.author}')">
                        <div class="user-meta">
                            <h4 onclick="App.viewUserProfile('${p.author}')" style="cursor:pointer;">${p.author}</h4>
                            <span>${this.formatTime(p.timestamp)} ‚Ä¢ ${p.visibility === 'public' ? 'üåç' : p.visibility === 'followers' ? 'üîí' : 'üë§'}</span>
                        </div>
                    </div>
                    <button class="subscribe-btn ${isSubscribed ? 'subscribed' : ''}" onclick="App.toggleSubscribe('${p.author}')">
                        ${isSubscribed ? 'Abonn√©' : "S'abonner"}
                    </button>
                </div>
                
                <div class="post-media" onclick="App.viewPost(${p.id})">
                    ${p.type === 'photo' ? 
                        `<img src="${p.content}" alt="${p.title}">` : 
                        `<video src="${p.content}" poster="https://images.unsplash.com/photo-1611605698335-8b1569810432?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" controls></video>`
                    }
                    ${p.type === 'rshort' ? `<div class="reels-indicator" style="top:10px; left:10px;"><i class="fas fa-play-circle"></i> RSHORT</div>` : ''}
                </div>
                
                <div class="post-actions">
                    <div class="action-btn ${isLiked ? 'active liked' : ''}" onclick="App.likePost(${p.id})" title="Aimer">
                        <i class="fas fa-heart"></i>
                        <span style="font-size:14px; margin-left:5px;">${this.formatNumber(p.likes)}</span>
                    </div>
                    <div class="action-btn" onclick="App.focusComment(${p.id})" title="Commenter">
                        <i class="fas fa-comment"></i>
                        <span style="font-size:14px; margin-left:5px;">${this.formatNumber(p.comments)}</span>
                    </div>
                    <div class="action-btn" onclick="App.sharePost(${p.id})" title="Partager">
                        <i class="fas fa-share"></i>
                        <span style="font-size:14px; margin-left:5px;">${this.formatNumber(p.shares)}</span>
                    </div>
                    <div class="action-btn ${isSaved ? 'active' : ''}" onclick="App.toggleSavePost(${p.id})" title="${isSaved ? 'Non enregistrer' : 'Enregistrer'}">
                        <i class="fas fa-bookmark"></i>
                    </div>
                </div>
                
                <div class="post-details">
                    <span class="likes-count">${this.formatNumber(p.likes)} mentions J'aime</span>
                    <div class="caption">
                        <b onclick="App.viewUserProfile('${p.author}')" style="cursor:pointer;">${p.author}</b> 
                        ${p.title}
                        ${p.tags && p.tags.length > 0 ? `
                            <div style="margin-top:10px;">
                                ${p.tags.map(tag => `<span class="hashtag" onclick="App.filterByTag('${tag}')">#${tag}</span>`).join(' ')}
                            </div>
                        ` : ''}
                    </div>
                    
                    <div style="margin-top:15px; color:var(--text-dim); font-size:13px;">
                        <span onclick="App.viewComments(${p.id})" style="cursor:pointer;">
                            Voir les ${p.comments} commentaires
                        </span>
                    </div>
                    
                    <div class="comment-input">
                        <input type="text" id="comment-${p.id}" placeholder="Ajouter un commentaire...">
                        <button onclick="App.addComment(${p.id})" style="background:var(--accent); color:white; border:none; padding:8px 15px; border-radius:var(--radius-md); cursor:pointer;">
                            Publier
                        </button>
                    </div>
                </div>
            </div>
        `;
    },

    // --- RENDER FEED ---
    renderFeed() {
        const feed = document.getElementById('main-feed');
        if(this.state.posts.length === 0) {
            feed.innerHTML = `
                <div style="text-align:center; padding:50px; color:var(--text-dim);">
                    <i class="fas fa-photo-video" style="font-size:50px; margin-bottom:20px;"></i>
                    <h3>Le flux est vide</h3>
                    <p>Soyez le premier √† publier !</p>
                    <button onclick="App.go('upload')" style="margin-top:20px; padding:12px 25px; background:var(--accent); color:white; border:none; border-radius:var(--radius-md); font-weight:700; cursor:pointer;">
                        <i class="fas fa-plus"></i> Cr√©er une publication
                    </button>
                </div>`;
            return;
        }

        feed.innerHTML = this.state.posts.map(p => this.renderPost(p)).join('');
    },

    // --- PROFILE ---
    renderProfile() {
        const userPosts = this.state.posts.filter(p => p.author === this.state.session.pseudo);
        this.updateProfileStats();
        
        const grid = document.getElementById('profile-grid');
        if(userPosts.length === 0) {
            grid.innerHTML = `
                <div style="grid-column:1/-1; text-align:center; padding:50px; color:var(--text-dim);">
                    <i class="fas fa-camera" style="font-size:50px; margin-bottom:20px;"></i>
                    <h3>Aucune publication</h3>
                    <p>Partagez votre premier contenu !</p>
                    <button onclick="App.go('upload')" style="margin-top:20px; padding:10px 20px; background:var(--accent); color:white; border:none; border-radius:var(--radius-md); font-weight:600; cursor:pointer;">
                        <i class="fas fa-plus"></i> Nouvelle publication
                    </button>
                </div>`;
            return;
        }
        
        grid.innerHTML = userPosts.map(p => `
            <div class="photo-item" onclick="App.viewPost(${p.id})">
                <img src="${p.type === 'photo' ? p.content : 'https://images.unsplash.com/photo-1611605698335-8b1569810432?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'}" alt="${p.title}">
                <div class="photo-overlay">
                    <div class="photo-stats">
                        <span><i class="fas fa-heart"></i> ${p.likes}</span>
                        <span><i class="fas fa-comment"></i> ${p.comments}</span>
                    </div>
                </div>
            </div>
        `).join('');
    },

    switchProfileTab(tab) {
        this.state.profileTab = tab;
        document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.profile-tab')[['posts', 'rshorts', 'saved'].indexOf(tab)].classList.add('active');
        
        document.querySelectorAll('.profile-content').forEach(c => c.classList.add('hidden'));
        document.getElementById(`profile-${tab}`).classList.remove('hidden');
        
        if(tab === 'rshorts') {
            this.renderProfileRshorts();
        }
    },

    renderProfileRshorts() {
        const container = document.getElementById('rshorts-container');
        const rshorts = this.state.posts.filter(p => p.author === this.state.session.pseudo && p.type === 'rshort');
        
        if(rshorts.length === 0) {
            container.innerHTML = `
                <i class="fas fa-play-circle" style="font-size:50px; margin-bottom:20px; color:var(--tiktok-pink);"></i>
                <p>Aucun RShort pour le moment</p>`;
            return;
        }
        
        container.innerHTML = `
            <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px;">
                ${rshorts.map(r => `
                    <div style="aspect-ratio:9/16; background:#111; border-radius:10px; overflow:hidden; position:relative; cursor:pointer;" onclick="App.viewPost(${r.id})">
                        <img src="https://images.unsplash.com/photo-1611605698335-8b1569810432?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" style="width:100%; height:100%; object-fit:cover;">
                        <div style="position:absolute; bottom:10px; left:10px; color:white; font-size:12px; display:flex; align-items:center; gap:5px;">
                            <i class="fas fa-play"></i> ${this.formatNumber(r.views)}
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
    },

    // --- INTERACTIONS ---
    likePost(id) {
        const post = this.state.posts.find(p => p.id === id);
        if(!post) return;
        
        const index = post.likedBy.indexOf(this.state.session.pseudo);
        
        if(index === -1) {
            post.likes++;
            post.likedBy.push(this.state.session.pseudo);
            this.notify("Publication aim√©e !", "success");
        } else {
            post.likes--;
            post.likedBy.splice(index, 1);
            this.notify("Like retir√©", "info");
        }
        
        this.sync();
        this.renderFeed();
        
        if(this.state.activeSection === 'rsshort') {
            this.renderRshorts();
        }
    },

    toggleSavePost(id) {
        const index = this.state.savedPosts.indexOf(id);
        
        if(index === -1) {
            this.state.savedPosts.push(id);
            this.notify("Publication enregistr√©e", "success");
        } else {
            this.state.savedPosts.splice(index, 1);
            this.notify("Publication retir√©e des enregistr√©s", "info");
        }
        
        this.sync();
        this.renderFeed();
    },

    addComment(id) {
        const post = this.state.posts.find(p => p.id === id);
        if(!post) return;
        
        const input = document.getElementById(`comment-${id}`);
        const text = input.value.trim();
        
        if(!text) {
            this.notify("Le commentaire ne peut pas √™tre vide", "warning");
            return;
        }
        
        post.comments = (post.comments || 0) + 1;
        this.sync();
        this.renderFeed();
        this.notify("Commentaire ajout√© !", "success");
        input.value = "";
    },

    viewComments(id) {
        const post = this.state.posts.find(p => p.id === id);
        if(!post) return;
        
        const comments = [
            { user: 'User1', text: 'Super contenu !', time: '2h' },
            { user: 'User2', text: 'J\'adore üòç', time: '3h' },
            { user: 'User3', text: 'Tr√®s int√©ressant', time: '4h' }
        ];
        
        const modal = `
            <div class="modal active" onclick="this.remove()">
                <div class="modal-content" onclick="event.stopPropagation()" style="max-width:500px; max-height:80vh;">
                    <div class="modal-header">
                        <h3>Commentaires (${post.comments})</h3>
                        <i class="fas fa-times" onclick="this.closest('.modal').remove()"></i>
                    </div>
                    <div style="padding:20px; overflow-y:auto; max-height:60vh;">
                        ${comments.map(c => `
                            <div class="comment">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${c.user}" style="width:40px; height:40px; border-radius:50%;">
                                <div style="flex:1;">
                                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                                        <b>${c.user}</b>
                                        <small style="color:var(--text-dim);">${c.time}</small>
                                    </div>
                                    <div>${c.text}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modal);
    },

    sharePost(id) {
        const post = this.state.posts.find(p => p.id === id);
        if(!post) return;
        
        post.shares = (post.shares || 0) + 1;
        this.sync();
        
        if(navigator.share) {
            navigator.share({
                title: `${post.author} sur Rasstube`,
                text: post.title,
                url: window.location.href
            });
        } else {
            this.copyToClipboard(`Regarde √ßa sur Rasstube !\n\n${post.author}: ${post.title}`);
        }
        
        this.notify("Publication partag√©e !", "success");
        this.renderFeed();
    },

    copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            this.notify("Lien copi√© !", "success");
        });
    },

    // --- SUBSCRIPTIONS ---
    isSubscribed(user) {
        const userSubscriptions = this.state.subscriptions[this.state.session.pseudo] || { followers: [], following: [] };
        return userSubscriptions.following.includes(user);
    },

    toggleSubscribe(user) {
        if(user === this.state.session.pseudo) {
            this.notify("Vous ne pouvez pas vous abonner √† vous-m√™me", "warning");
            return;
        }
        
        if(!this.state.subscriptions[this.state.session.pseudo]) {
            this.state.subscriptions[this.state.session.pseudo] = { followers: [], following: [] };
        }
        if(!this.state.subscriptions[user]) {
            this.state.subscriptions[user] = { followers: [], following: [] };
        }
        
        const userSubs = this.state.subscriptions[this.state.session.pseudo];
        const targetSubs = this.state.subscriptions[user];
        
        if(this.isSubscribed(user)) {
            userSubs.following = userSubs.following.filter(u => u !== user);
            targetSubs.followers = targetSubs.followers.filter(u => u !== this.state.session.pseudo);
            this.notify(`D√©sabonn√© de ${user}`, "info");
        } else {
            userSubs.following.push(user);
            targetSubs.followers.push(this.state.session.pseudo);
            this.notify(`Abonn√© √† ${user} !`, "success");
        }
        
        this.sync();
        this.renderFeed();
        this.updateProfileStats();
    },

    showFollowers() {
        const userSubscriptions = this.state.subscriptions[this.state.session.pseudo] || { followers: [], following: [] };
        const followers = userSubscriptions.followers.join(', ') || 'Aucun abonn√©';
        alert(`Vos abonn√©s:\n\n${followers}`);
    },

    showFollowing() {
        const userSubscriptions = this.state.subscriptions[this.state.session.pseudo] || { followers: [], following: [] };
        const following = userSubscriptions.following.join(', ') || 'Vous ne suivez personne';
        alert(`Vous suivez:\n\n${following}`);
    },

    // --- UTILS ---
    formatNumber(num) {
        if(num >= 1000000) return (num/1000000).toFixed(1) + 'M';
        if(num >= 1000) return (num/1000).toFixed(1) + 'k';
        return num.toString();
    },

    formatTime(timestamp) {
        if(!timestamp) return "√Ä l'instant";
        
        const now = new Date();
        const postDate = new Date(timestamp);
        const diff = now - postDate;
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);
        
        if(minutes < 1) return "√Ä l'instant";
        if(minutes < 60) return `Il y a ${minutes} min`;
        if(hours < 24) return `Il y a ${hours} h`;
        if(days < 7) return `Il y a ${days} j`;
        return postDate.toLocaleDateString('fr-FR');
    },

    formatDuration(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    },

    viewPost(id) {
        const post = this.state.posts.find(p => p.id === id);
        if(!post) return;
        
        post.views = (post.views || 0) + 1;
        this.sync();
        
        const modal = `
            <div class="modal active" onclick="this.remove()">
                <div class="modal-content" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <img src="${post.authorPfp}" style="width:40px; height:40px; border-radius:50%;">
                            <div>
                                <h4 style="margin:0;">${post.author}</h4>
                                <small style="color:var(--text-dim);">${this.formatTime(post.timestamp)}</small>
                            </div>
                        </div>
                        <i class="fas fa-times" onclick="this.closest('.modal').remove()"></i>
                    </div>
                    <div style="max-height:70vh; overflow-y:auto;">
                        <div class="post-media">
                            ${post.type === 'photo' ? 
                                `<img src="${post.content}" style="width:100%; max-height:60vh; object-fit:contain;">` : 
                                `<video src="${post.content}" controls style="width:100%; max-height:60vh;"></video>`
                            }
                        </div>
                        <div style="padding:20px;">
                            <div style="display:flex; gap:20px; margin-bottom:15px; font-size:20px;">
                                <i class="fa-heart ${post.likedBy.includes(this.state.session.pseudo) ? 'fas active' : 'far'}" style="cursor:pointer;" onclick="App.likePost(${post.id}); this.closest('.modal').remove();"></i>
                                <i class="far fa-comment" style="cursor:pointer;"></i>
                                <i class="far fa-share-square" style="cursor:pointer;" onclick="App.sharePost(${post.id})"></i>
                            </div>
                            <div style="margin-bottom:10px;">
                                <strong style="color:var(--accent);">${this.formatNumber(post.likes)} mentions J'aime ‚Ä¢ ${this.formatNumber(post.views)} vues</strong>
                            </div>
                            <p><b>${post.author}</b> ${post.title}</p>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modal);
    },

    viewUserProfile(user) {
        if(user === this.state.session.pseudo) {
            this.go('profile');
            return;
        }
        
        const userData = this.state.users.find(u => u.pseudo === user);
        if(!userData) return;
        
        const modal = `
            <div class="modal active" onclick="this.remove()">
                <div class="modal-content" onclick="event.stopPropagation()" style="max-width:500px;">
                    <div class="modal-header">
                        <h3>Profil de ${user}</h3>
                        <i class="fas fa-times" onclick="this.closest('.modal').remove()"></i>
                    </div>
                    <div style="padding:20px;">
                        <div style="text-align:center; margin-bottom:30px;">
                            <img src="${userData.pfp}" style="width:100px; height:100px; border-radius:50%; border:3px solid var(--accent); margin-bottom:15px;">
                            <h3 style="margin:0;">${user}</h3>
                            <p style="color:var(--text-dim);">${userData.bio || 'Aucune bio'}</p>
                            <button class="subscribe-btn ${this.isSubscribed(user) ? 'subscribed' : ''}" onclick="App.toggleSubscribe('${user}'); this.closest('.modal').remove();" style="margin-top:15px;">
                                ${this.isSubscribed(user) ? 'Abonn√©' : "S'abonner"}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modal);
    },

    editProfile() {
        const newBio = prompt("Modifiez votre bio:", this.state.session.bio || '');
        if(newBio !== null) {
            this.state.session.bio = newBio;
            this.sync();
            document.getElementById('prof-bio').innerText = newBio;
            this.notify("Profil mis √† jour", "success");
        }
    },

    showNotifications() {
        const notifications = [
            "Rayan a aim√© votre publication",
            "Sarah vous a envoy√© un message",
            "Nouveau RShort disponible",
            "Vous avez 3 nouveaux abonn√©s"
        ];
        
        alert(`Notifications:\n\n${notifications.join('\n')}`);
    },

    showMessages() {
        alert("Messagerie bient√¥t disponible !");
    },

    filterContent(query) {
        const feed = document.getElementById('main-feed');
        if(!query.trim()) {
            this.renderFeed();
            return;
        }
        
        const filtered = this.state.posts.filter(p => 
            p.title.toLowerCase().includes(query.toLowerCase()) || 
            p.author.toLowerCase().includes(query.toLowerCase()) ||
            (p.tags && p.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase())))
        );
        
        if(filtered.length === 0) {
            feed.innerHTML = `
                <div style="text-align:center; padding:50px; color:var(--text-dim);">
                    <i class="fas fa-search" style="font-size:40px; margin-bottom:15px;"></i>
                    <p>Aucun r√©sultat pour "${query}"</p>
                </div>`;
            return;
        }
        
        feed.innerHTML = filtered.map(p => this.renderPost(p)).join('');
    },

    notify(msg, type = "success") {
        const box = document.getElementById('notification-box');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        const icons = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            warning: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        };
        
        toast.innerHTML = `
            <i class="fas ${icons[type] || 'fa-info-circle'}"></i>
            <div>
                <strong style="font-size:14px;">${type.toUpperCase()}</strong>
                <p style="margin:5px 0 0; font-size:14px;">${msg}</p>
            </div>
        `;
        
        box.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'slideInRight 0.5s ease reverse';
            setTimeout(() => toast.remove(), 500);
        }, 3000);
    },

    renderAvatars() {
        const grid = document.getElementById('default-avatars');
        const seeds = ['Felix', 'Aneka', 'Rass', 'Shadow', 'Neo', 'Luna', 'Nova', 'Pulse'];
        grid.innerHTML = seeds.map(s => {
            const url = `https://api.dicebear.com/7.x/avataaars/svg?seed=${s}`;
            return `
                <div class="pfp-item ${this.state.selectedPfp === url ? 'selected' : ''}" onclick="App.selectPfp('${url}')">
                    <img src="${url}" alt="${s}">
                </div>
            `;
        }).join('');
    },

    selectPfp(url) {
        this.state.selectedPfp = url;
        document.getElementById('auth-pfp-preview').src = url;
        this.renderAvatars();
    },

    handlePfpFile(e) {
        const file = e.target.files[0];
        if(!file) return;
        
        if(!file.type.includes('image')) {
            this.notify("Veuillez s√©lectionner une image", "error");
            return;
        }
        
        const reader = new FileReader();
        reader.onload = (event) => {
            this.state.selectedPfp = event.target.result;
            document.getElementById('auth-pfp-preview').src = event.target.result;
            this.notify("Photo de profil mise √† jour", "success");
        };
        reader.readAsDataURL(file);
    },

    triggerPfpUpload() { 
        document.getElementById('real-pfp-input').click(); 
    },

    logout() {
        if(confirm("Voulez-vous vraiment vous d√©connecter de Rasstube ?")) {
            this.state.session = null;
            this.sync();
            location.reload();
        }
    }
};

// INITIALISATION
window.onload = () => App.init();

// Drag and drop pour upload
document.addEventListener('DOMContentLoaded', () => {
    const dropzone = document.getElementById('upload-dropzone');
    if(dropzone) {
        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.style.borderColor = 'var(--accent)';
            dropzone.style.background = 'var(--accent-soft)';
        });
        
        dropzone.addEventListener('dragleave', () => {
            dropzone.style.borderColor = 'var(--border)';
            dropzone.style.background = '';
        });
        
        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.style.borderColor = 'var(--border)';
            dropzone.style.background = '';
            
            const files = e.dataTransfer.files;
            const input = document.getElementById('file-upload');
            const dataTransfer = new DataTransfer();
            
            Array.from(files).forEach(file => {
                if(file.type.includes('image') || file.type.includes('video')) {
                    dataTransfer.items.add(file);
                }
            });
            
            input.files = dataTransfer.files;
            
            const event = new Event('change', { bubbles: true });
            input.dispatchEvent(event);
            
            if(dataTransfer.files.length > 0) {
                App.notify(`${dataTransfer.files.length} fichier(s) import√©(s) !`, 'success');
            }
        });
    }
});
</script>
</body>
</html>