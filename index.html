<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RASSTUBE ULTIMATE | v5.0 Elite Ecosystem</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #FF0032;
            --accent-soft: rgba(255, 0, 50, 0.15);
            --accent-glow: rgba(255, 0, 50, 0.5);
            --bg-deep: #050505;
            --bg-card: #0F0F0F;
            --bg-elevated: #1A1A1A;
            --bg-input: #121212;
            --text-main: #FFFFFF;
            --text-dim: #909090;
            --border: rgba(255, 255, 255, 0.08);
            --ai-color: #00D1FF;
            --ai-glow: rgba(0, 209, 255, 0.3);
            --success: #00FF85;
            --warning: #FFAA00;
            --youtube-red: #FF0000;
            --instagram-purple: #E4405F;
            --tiktok-pink: #FF0050;
            --radius-xl: 32px;
            --radius-lg: 20px;
            --radius-md: 12px;
            --shadow-lg: 0 20px 40px rgba(0,0,0,0.6);
            --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        /* RESET & BASE */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: var(--bg-deep); color: var(--text-main); 
            margin: 0; font-family: 'Plus Jakarta Sans', sans-serif;
            overflow-x: hidden; -webkit-user-select: none;
            min-height: 100vh;
        }

        /* ANIMATIONS */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseAccent { 0% { box-shadow: 0 0 0 0 var(--accent-glow); } 70% { box-shadow: 0 0 0 15px rgba(255, 0, 50, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 50, 0); } }
        @keyframes pulseAI { 0% { box-shadow: 0 0 0 0 var(--ai-glow); } 70% { box-shadow: 0 0 0 10px rgba(0, 209, 255, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 209, 255, 0); } }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes heartbeat { 0% { transform: scale(1); } 25% { transform: scale(1.1); } 50% { transform: scale(1); } 75% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes typing { 0% { width: 0; } 100% { width: 100%; } }
        @keyframes glow { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        @keyframes compressProgress { 0% { width: 0%; } 50% { width: 50%; } 100% { width: 100%; } }
        @keyframes flame { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.8; } }

        /* --- AUTHENTIFICATION ENGINE --- */
        #auth-portal {
            position: fixed; 
            inset: 0; 
            z-index: 9999; 
            background: radial-gradient(circle at top right, #1a0505, #000);
            display: flex; 
            align-items: flex-start;
            justify-content: center; 
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .auth-container {
            width: 100%; 
            max-width: 440px; 
            background: var(--bg-card);
            border-radius: var(--radius-xl); 
            border: 1px solid var(--border);
            padding: 40px 35px; 
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.8s ease;
            margin: 20px 0;
        }

        .auth-tabs {
            display: flex; background: var(--bg-input); padding: 6px;
            border-radius: 18px; margin-bottom: 30px; border: 1px solid var(--border);
        }

        .auth-tabs button {
            flex: 1; padding: 14px; border: none; background: none;
            color: var(--text-dim); font-weight: 700; cursor: pointer;
            border-radius: 14px; transition: var(--transition);
        }

        .auth-tabs button.active { background: var(--accent); color: white; box-shadow: 0 4px 15px var(--accent-glow); }

        .input-box { margin-bottom: 20px; position: relative; }
        .input-box i { position: absolute; left: 18px; top: 18px; color: var(--text-dim); font-size: 18px; }
        .input-control {
            width: 100%; padding: 18px 18px 18px 52px; background: var(--bg-input);
            border: 1px solid var(--border); border-radius: 18px; color: white;
            font-size: 15px; transition: var(--transition);
        }
        .input-control:focus { border-color: var(--accent); outline: none; background: #161616; }

        .pfp-selector { text-align: center; margin-bottom: 25px; }
        .pfp-main-preview {
            width: 110px; height: 110px; border-radius: 50%;
            border: 3px solid var(--accent); padding: 4px; object-fit: cover;
            margin-bottom: 15px; transition: var(--transition);
        }
        .pfp-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 15px;
        }
        .pfp-item {
            aspect-ratio: 1; border-radius: 14px; overflow: hidden; cursor: pointer;
            border: 2px solid transparent; transition: var(--transition);
        }
        .pfp-item.selected { border-color: var(--accent); transform: scale(1.1); }
        .pfp-item img { width: 100%; height: 100%; object-fit: cover; }

        /* --- CORE APP LAYOUT --- */
        #main-app { display: none; padding-bottom: 90px; min-height: 100vh; }

        .top-nav {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(25px);
            padding: 15px 20px; border-bottom: 1px solid var(--border);
        }

        .nav-wrapper {
            max-width: 1400px; margin: 0 auto;
            display: flex; justify-content: space-between; align-items: center;
        }

        .brand { 
            font-size: 28px; font-weight: 900; 
            background: linear-gradient(45deg, #FF0032, #FF8A00);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: -1.5px;
            animation: glow 2s infinite;
        }

        .search-bar {
            background: var(--bg-elevated); border-radius: 14px;
            padding: 10px 18px; display: flex; align-items: center;
            width: 40%; border: 1px solid var(--border);
            transition: var(--transition);
        }
        .search-bar:focus-within { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }
        .search-bar input { background: none; border: none; color: white; margin-left: 10px; width: 100%; outline: none; }

        /* --- SECTIONS --- */
        .content-container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

        /* Stories Instagram Style */
        .story-scroller {
            display: flex; gap: 18px; overflow-x: auto; padding: 10px 0 25px;
            scrollbar-width: none;
        }
        .story-scroller::-webkit-scrollbar { display: none; }
        .story-card {
            flex-shrink: 0; width: 85px; text-align: center; cursor: pointer;
            transition: var(--transition);
        }
        .story-card:hover { transform: translateY(-5px); }
        .story-ring {
            width: 78px; height: 78px; border-radius: 50%; padding: 3px;
            background: linear-gradient(45deg, var(--instagram-purple), var(--tiktok-pink));
            margin-bottom: 8px; transition: var(--transition);
        }
        .story-card img { width: 100%; height: 100%; border-radius: 50%; border: 3px solid var(--bg-deep); object-fit: cover; }
        .story-card:active .story-ring { transform: scale(0.9); }
        .story-label { font-size: 11px; font-weight: 600; color: var(--text-dim); }

        /* --- RSSHORT SECTION (TikTok Style) --- */
        #sec-rsshort {
            position: relative;
            height: calc(100vh - 140px);
            overflow: hidden;
        }

        .rsshort-container {
            height: 100%;
            position: relative;
        }

        .rsshort-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0;
        }

        .rsshort-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 30px 20px 100px;
            color: white;
            z-index: 2;
        }

        .rsshort-side-buttons {
            position: absolute;
            right: 20px;
            bottom: 150px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            align-items: center;
            z-index: 3;
        }

        .rsshort-btn {
            background: none;
            border: none;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: var(--transition);
        }

        .rsshort-btn i {
            width: 50px;
            height: 50px;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: var(--transition);
        }

        .rsshort-btn.active i {
            color: var(--accent);
            background: rgba(255, 0, 50, 0.2);
            animation: pulseAccent 2s infinite;
        }

        .rsshort-btn:active i {
            transform: scale(1.2);
        }

        .rsshort-btn:hover i {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.1);
        }

        .rsshort-progress {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255,255,255,0.3);
            z-index: 4;
        }

        .rsshort-progress-bar {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.1s linear;
        }

        /* --- IA CHAT SECTION (Addictive AI Chat) --- */
        #sec-aichat {
            position: relative;
            height: calc(100vh - 140px);
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 100%);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid rgba(0, 209, 255, 0.1);
        }

        .ai-chat-header {
            background: rgba(0, 209, 255, 0.1);
            padding: 20px;
            border-bottom: 1px solid var(--ai-glow);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ai-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--ai-color), #0099ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            animation: pulseAI 3s infinite;
        }

        .ai-chat-messages {
            height: calc(100% - 180px);
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            max-width: 70%;
            padding: 15px;
            border-radius: 20px;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        .ai-message.user {
            background: linear-gradient(135deg, var(--accent), #ff3366);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .ai-message.bot {
            background: rgba(0, 209, 255, 0.1);
            border: 1px solid var(--ai-glow);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        .ai-typing {
            display: flex;
            gap: 5px;
            padding: 10px 20px;
            background: rgba(0, 209, 255, 0.05);
            border-radius: 20px;
            width: fit-content;
        }

        .ai-typing span {
            width: 8px;
            height: 8px;
            background: var(--ai-color);
            border-radius: 50%;
            animation: pulseAI 1.5s infinite;
        }

        .ai-typing span:nth-child(2) { animation-delay: 0.2s; }
        .ai-typing span:nth-child(3) { animation-delay: 0.4s; }

        .ai-quick-actions {
            display: flex;
            gap: 10px;
            padding: 15px;
            overflow-x: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .ai-quick-btn {
            background: rgba(0, 209, 255, 0.1);
            border: 1px solid var(--ai-glow);
            color: var(--ai-color);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 13px;
            white-space: nowrap;
            cursor: pointer;
            transition: var(--transition);
        }

        .ai-quick-btn:hover {
            background: rgba(0, 209, 255, 0.2);
            transform: translateY(-2px);
        }

        .ai-input-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(5, 5, 5, 0.9);
            padding: 15px;
            display: flex;
            gap: 10px;
            border-top: 1px solid var(--border);
        }

        .ai-input {
            flex: 1;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 25px;
            padding: 15px 20px;
            color: white;
            font-size: 14px;
            outline: none;
            transition: var(--transition);
        }

        .ai-input:focus {
            border-color: var(--ai-color);
            box-shadow: 0 0 15px var(--ai-glow);
        }

        .ai-send-btn {
            background: linear-gradient(45deg, var(--ai-color), #0099ff);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
            animation: pulseAI 3s infinite;
        }

        .ai-send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--ai-glow);
        }

        /* --- EXPLORE SECTION --- */
        .explore-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .explore-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--border);
            cursor: pointer;
        }

        .explore-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent);
        }

        .explore-thumbnail {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
            display: block;
        }

        .explore-info {
            padding: 15px;
        }

        /* --- UPLOAD SECTION --- */
        #upload-dropzone {
            transition: var(--transition);
        }

        #upload-dropzone:hover {
            border-color: var(--accent);
            background: var(--accent-soft);
            transform: translateY(-5px);
        }

        /* --- COMPRESSOR SECTION --- */
        #compressor-dropzone {
            transition: var(--transition);
        }

        #compressor-dropzone:hover {
            border-color: var(--accent);
            background: var(--accent-soft);
            transform: translateY(-5px);
        }

        .quality-btn {
            flex: 1;
            padding: 12px 15px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-dim);
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .quality-btn.active {
            background: var(--accent-soft);
            border-color: var(--accent);
            color: var(--accent);
        }

        .quality-btn:hover:not(.active) {
            background: var(--bg-elevated);
            transform: translateY(-2px);
        }

        /* --- BOTTOM NAV --- */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(15, 15, 15, 0.95); backdrop-filter: blur(30px);
            border-top: 1px solid var(--border); padding: 12px 10px 22px;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000;
        }
        .nav-item { 
            color: var(--text-dim); text-align: center; 
            flex: 1; transition: var(--transition); cursor: pointer; 
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .nav-item.active { color: var(--accent); transform: translateY(-5px); }
        .nav-item.active i { animation: float 3s infinite; }
        .nav-item i { font-size: 22px; display: block; margin-bottom: 4px; transition: var(--transition); }
        .nav-item span { font-size: 10px; font-weight: 700; text-transform: uppercase; }

        .nav-item:hover {
            color: var(--accent);
            transform: translateY(-3px);
        }

        .fab-upload {
            background: var(--accent); width: 60px; height: 60px;
            border-radius: 22px; display: flex; align-items: center; justify-content: center;
            margin-top: -45px; border: 6px solid var(--bg-deep);
            color: white !important; font-size: 26px !important;
            animation: pulseAccent 2s infinite;
            cursor: pointer;
            z-index: 1001;
            transition: var(--transition);
        }

        .fab-upload:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 0 30px var(--accent-glow);
        }

        /* --- NOTIFICATION BADGES --- */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: 5px;
            background: var(--accent);
            color: white;
            font-size: 10px;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: heartbeat 1s infinite;
        }

        /* --- LOADING SKELETONS --- */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-input) 25%, var(--bg-elevated) 50%, var(--bg-input) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-md);
        }

        .loader {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            .nav-wrapper { flex-wrap: wrap; gap: 15px; }
            .search-bar { width: 100%; order: 3; }
            .content-container { padding: 0 15px; }
            .auth-container { padding: 30px 25px; margin: 10px 0; }
            #auth-portal { padding: 15px; }
            .pfp-grid { grid-template-columns: repeat(3, 1fr); }
            .bottom-bar { padding: 12px 5px 22px; }
            .nav-item i { font-size: 20px; }
            .nav-item span { font-size: 9px; }
            .explore-grid { grid-template-columns: 1fr; }
            .ai-chat-messages { height: calc(100% - 160px); }
        }

        /* --- UTILITY CLASSES --- */
        .hidden { display: none !important; }
        .visible { display: block !important; }
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }

        /* --- ADDICTIVE ELEMENTS --- */
        .streak-counter {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(45deg, #FF8A00, #FF0032);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            z-index: 999;
            animation: flame 2s infinite;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 0 15px rgba(255, 138, 0, 0.5);
        }

        .xp-bar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 6px;
            background: var(--bg-input);
            border-radius: 3px;
            overflow: hidden;
            z-index: 999;
        }

        .xp-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #ff8a00);
            transition: width 0.5s ease;
        }

        .daily-reward {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: linear-gradient(45deg, #ff8a00, #ff0032);
            color: white;
            padding: 15px;
            border-radius: var(--radius-lg);
            z-index: 999;
            animation: pulseAccent 3s infinite;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- ACHIEVEMENTS --- */
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            border: 2px solid var(--accent);
            border-radius: var(--radius-lg);
            padding: 30px;
            z-index: 9999;
            animation: fadeIn 0.5s ease;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 0 50px rgba(255, 0, 50, 0.5);
        }

        .achievement-icon {
            font-size: 50px;
            color: gold;
            margin-bottom: 20px;
            animation: float 2s infinite;
        }

        /* --- TOAST NOTIFICATIONS --- */
        .toast {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 4px solid var(--success);
            border-radius: var(--radius-md);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 9999;
            animation: slideInRight 0.5s ease;
            max-width: 350px;
            box-shadow: var(--shadow-lg);
        }

        .toast.error { border-left-color: var(--accent); }
        .toast.warning { border-left-color: var(--warning); }
        .toast.info { border-left-color: var(--ai-color); }

        /* --- PROFILE TABS --- */
        .profile-tab {
            padding: 15px 20px;
            background: none;
            border: none;
            color: var(--text-dim);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .profile-tab.active {
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
        }

        .photo-item {
            aspect-ratio: 1;
            overflow: hidden;
            cursor: pointer;
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .photo-item:hover img {
            transform: scale(1.1);
        }

        /* --- COMPRESSOR STATS --- */
        .compressor-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: var(--bg-input);
            padding: 15px;
            border-radius: var(--radius-md);
            text-align: center;
        }

        .stat-box .value {
            font-size: 20px;
            font-weight: 800;
            color: var(--accent);
            display: block;
        }

        .stat-box .label {
            font-size: 12px;
            color: var(--text-dim);
            margin-top: 5px;
        }

        /* --- YOUTUBE VIDEO PLAYER --- */
        .youtube-player-container {
            width: 100%;
            aspect-ratio: 16/9;
            background: black;
            border-radius: var(--radius-md);
            overflow: hidden;
            position: relative;
        }

        .youtube-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }

        .youtube-play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .youtube-play-button:hover {
            background: var(--youtube-red);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .youtube-play-button i {
            color: white;
            font-size: 30px;
            margin-left: 5px;
        }

        /* --- FLAME SYSTEM --- */
        .flame-progress {
            position: fixed;
            top: 130px;
            right: 20px;
            background: var(--bg-input);
            border-radius: 10px;
            padding: 8px 12px;
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(255, 138, 0, 0.3);
        }

        .flame-icon {
            color: #FF8A00;
            animation: flame 1.5s infinite;
        }

        .flame-bar-container {
            width: 100px;
            height: 6px;
            background: rgba(255, 138, 0, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .flame-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF8A00, #FF0032);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* --- SUBSCRIBER SYSTEM --- */
        .subscriber-badge {
            background: linear-gradient(45deg, var(--accent), #ff8a00);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .subscriber-count {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(45deg, var(--accent), #ff8a00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- UPLOAD PROGRESS --- */
        .upload-progress {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 15px 20px;
            z-index: 9999;
            min-width: 300px;
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        .progress-bar {
            height: 6px;
            background: var(--bg-input);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #ff8a00);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>

<div id="notification-box"></div>

<!-- XP Bar -->
<div class="xp-bar hidden" id="xp-bar">
    <div class="xp-progress" id="xp-progress" style="width: 0%"></div>
</div>

<!-- Streak Counter -->
<div class="streak-counter hidden" id="streak-counter">
    <i class="fas fa-fire"></i>
    <span id="streak-days">0 jours</span>
</div>

<!-- Flame Progress -->
<div class="flame-progress hidden" id="flame-progress">
    <i class="fas fa-fire flame-icon"></i>
    <div class="flame-bar-container">
        <div class="flame-bar" id="flame-bar" style="width: 0%"></div>
    </div>
    <span id="flame-days" style="font-size: 12px; color: #FF8A00; font-weight: 700;">0/7</span>
</div>

<!-- Daily Reward -->
<div class="daily-reward hidden" id="daily-reward" onclick="App.claimDailyReward()">
    <i class="fas fa-gift"></i>
    <div>
        <strong>RÃ‰COMPENSE QUOTIDIENNE</strong>
        <div style="font-size: 12px;">Cliquez pour rÃ©clamer !</div>
    </div>
</div>

<!-- AUTH PORTAL -->
<div id="auth-portal">
    <div class="auth-container">
        <div class="brand text-center" style="margin-bottom: 30px; font-size: 42px;">RASSTUBE</div>
        
        <div class="auth-tabs">
            <button id="tab-login" class="active" onclick="App.toggleAuth('login')">CONNEXION</button>
            <button id="tab-signup" onclick="App.toggleAuth('signup')">INSCRIPTION</button>
        </div>

        <div id="signup-profile-setup" class="hidden">
            <div class="pfp-selector">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Rass" class="pfp-main-preview" id="auth-pfp-preview">
                <div class="mt-20">
                    <button onclick="App.triggerPfpUpload()" style="background:var(--accent-soft); color:var(--accent); border:none; padding:10px 20px; border-radius:12px; font-weight:700; cursor:pointer; display: inline-flex; align-items: center; gap: 8px;">
                        <i class="fas fa-camera"></i> MA PHOTO
                    </button>
                </div>
                <input type="file" id="real-pfp-input" class="hidden" accept="image/*" onchange="App.handlePfpFile(event)">
                
                <div class="pfp-grid" id="default-avatars"></div>
            </div>
            
            <div class="input-box">
                <i class="fas fa-user-tag"></i>
                <input type="text" id="reg-pseudo" class="input-control" placeholder="Ton Pseudo Elite">
            </div>
        </div>

        <div class="input-box">
            <i class="fas fa-envelope"></i>
            <input type="email" id="auth-email" class="input-control" placeholder="Adresse e-mail">
        </div>
        
        <div class="input-box">
            <i class="fas fa-lock"></i>
            <input type="password" id="auth-pass" class="input-control" placeholder="Mot de passe (6+ caractÃ¨res)">
        </div>

        <button onclick="App.executeAuth()" id="auth-btn" style="width: 100%; padding: 22px; background: var(--accent); color: white; border: none; border-radius: 20px; font-weight: 800; font-size: 16px; margin-top: 15px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <span id="auth-btn-text">REJOINDRE LE RÃ‰SEAU</span>
            <div class="loader" id="auth-loader"></div>
        </button>
        
        <p id="auth-msg" style="text-align: center; color: #ff4444; font-size: 13px; margin-top: 20px; display: none;"></p>
    </div>
</div>

<!-- MAIN APP -->
<div id="main-app">
    <header class="top-nav">
        <div class="nav-wrapper">
            <div class="brand">RASSTUBE</div>
            <div class="search-bar">
                <i class="fas fa-search" style="color:var(--text-dim)"></i>
                <input type="text" id="search-input" placeholder="Rechercher vidÃ©os, photos, personnes..." onkeyup="App.filterContent(this.value)">
            </div>
            <div style="display: flex; gap: 20px; align-items: center;">
                <div style="position:relative; cursor:pointer;" onclick="App.showNotifications()">
                    <i class="fas fa-bell" style="font-size: 20px;" title="Notifications"></i>
                    <div class="notification-badge" id="notification-badge" style="display:none;">3</div>
                </div>
                <i class="fas fa-paper-plane" style="font-size: 20px; cursor: pointer;" title="Messages" onclick="App.showMessages()"></i>
                <img src="" id="user-pfp-top" style="width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--accent); cursor: pointer;" onclick="App.go('profile')" alt="Profil">
            </div>
        </div>
    </header>

    <main class="content-container">
        <!-- HOME SECTION -->
        <section id="sec-home" class="app-section">
            <div class="story-scroller" id="story-container"></div>
            <div id="main-feed"></div>
        </section>

        <!-- RSSHORT SECTION -->
        <section id="sec-rsshort" class="app-section hidden">
            <div class="reels-indicator" style="position:absolute; top:20px; left:20px; background:linear-gradient(45deg, var(--tiktok-pink), #00f2ea); color:white; padding:6px 12px; border-radius:20px; font-weight:700; font-size:12px; z-index:3;">
                <i class="fas fa-play-circle"></i> RSSHORT
            </div>
            <div class="rsshort-progress">
                <div class="rsshort-progress-bar" id="rsshort-progress"></div>
            </div>
            <div class="rsshort-container" id="rsshort-container"></div>
            <div class="rsshort-side-buttons" id="rsshort-side-buttons"></div>
            <div class="rsshort-overlay" id="rsshort-overlay"></div>
        </section>

        <!-- IA CHAT SECTION -->
        <section id="sec-aichat" class="app-section hidden">
            <div class="ai-chat-header">
                <div class="ai-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <h3 style="margin:0; color:var(--ai-color);">Assistant IA Rasstube</h3>
                    <p style="margin:5px 0 0; color:var(--text-dim); font-size:14px;">En ligne â€¢ PrÃªt Ã  vous aider</p>
                </div>
            </div>
            
            <div class="ai-chat-messages" id="ai-chat-messages">
                <div class="ai-message bot">
                    <strong>ðŸ¤– IA Rasstube:</strong>
                    <p>Bonjour ! Je suis votre assistant IA personnel. Je peux vous aider Ã  crÃ©er du contenu, analyser vos performances, et mÃªme vous donner des conseils personnalisÃ©s !</p>
                </div>
                <div class="ai-message bot">
                    <p>Que souhaitez-vous faire aujourd'hui ? ðŸ˜Š</p>
                </div>
            </div>
            
            <div class="ai-quick-actions" id="ai-quick-actions">
                <div class="ai-quick-btn" onclick="App.sendAIQuick('Conseils pour gagner des abonnÃ©s')">ðŸ’¡ Growth Hacking</div>
                <div class="ai-quick-btn" onclick="App.sendAIQuick('IdÃ©es de contenu tendance')">ðŸš€ Contenu viral</div>
                <div class="ai-quick-btn" onclick="App.sendAIQuick('Analyser mes performances')">ðŸ“Š Analytics</div>
                <div class="ai-quick-btn" onclick="App.sendAIQuick('Optimiser mes publications')">âš¡ Optimisation</div>
                <div class="ai-quick-btn" onclick="App.sendAIQuick('Me raconter une blague')">ðŸ˜‚ Divertissement</div>
            </div>
            
            <div class="ai-input-container">
                <input type="text" class="ai-input" id="ai-input" placeholder="Posez-moi n'importe quelle question..." onkeypress="if(event.key === 'Enter') App.sendAIMessage()">
                <button class="ai-send-btn" onclick="App.sendAIMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </section>

        <!-- UPLOAD SECTION -->
        <section id="sec-upload" class="app-section hidden">
            <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
                <h3 style="margin-top: 0; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-plus-circle" style="color:var(--accent)"></i> Nouvelle Publication
                </h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div>
                        <div style="border: 2px dashed var(--border); border-radius: var(--radius-lg); padding: 40px; text-align: center; cursor: pointer;" onclick="document.getElementById('file-upload').click()" id="upload-dropzone">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 50px; color: var(--accent); margin-bottom: 15px;"></i>
                            <p style="margin: 0; font-weight: 700; font-size: 18px;">Importer un fichier</p>
                            <p style="margin: 10px 0 0; font-size: 14px; color: var(--text-dim);">VidÃ©o, photo ou RShort</p>
                            <input type="file" id="file-upload" class="hidden" accept="video/*,image/*" onchange="App.previewUpload(event)" multiple>
                        </div>

                        <div id="upload-preview" class="hidden" style="margin-top: 25px; border-radius: var(--radius-lg); overflow: hidden;"></div>

                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="App.go('compressor')" style="background: var(--accent-soft); color: var(--accent); border: 1px solid var(--accent); padding: 12px 20px; border-radius: var(--radius-md); font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                                <i class="fas fa-compress-alt"></i>
                                Compresser une vidÃ©o avant upload
                            </button>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background: rgba(255, 0, 0, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(255, 0, 0, 0.3);">
                            <p style="margin: 0; font-size: 13px; color: #FF5555; display: flex; align-items: center; gap: 8px;">
                                <i class="fab fa-youtube"></i>
                                <span>Vous pouvez aussi importer des liens YouTube !</span>
                            </p>
                            <input type="text" id="youtube-link" class="input-control mt-20" placeholder="Collez un lien YouTube ici..." style="background: rgba(255, 0, 0, 0.05);">
                            <button onclick="App.importYouTubeVideo()" style="width: 100%; margin-top: 10px; padding: 12px; background: var(--youtube-red); color: white; border: none; border-radius: var(--radius-md); font-weight: 700; cursor: pointer;">
                                <i class="fab fa-youtube"></i> Importer depuis YouTube
                            </button>
                        </div>
                    </div>

                    <div>
                        <div class="input-box">
                            <i class="fas fa-heading"></i>
                            <input type="text" id="up-title" class="input-control" placeholder="Titre de la publication">
                        </div>

                        <div class="input-box">
                            <i class="fas fa-tag"></i>
                            <input type="text" id="up-tags" class="input-control" placeholder="Hashtags (sÃ©parÃ©s par des virgules)">
                        </div>

                        <div class="input-box">
                            <i class="fas fa-layer-group"></i>
                            <select id="up-type" class="input-control">
                                <option value="video">ðŸŽ¬ VidÃ©o Standard</option>
                                <option value="photo">ðŸ“· Photo</option>
                                <option value="rshort">âš¡ RShort (format court)</option>
                                <option value="youtube">ðŸ“º VidÃ©o YouTube</option>
                            </select>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background: var(--accent-soft); border-radius: var(--radius-md);">
                            <p style="margin: 0 0 10px 0; font-size: 13px; color: var(--accent); font-weight: 700;">
                                <i class="fas fa-chart-line"></i> Gain d'abonnÃ©s estimÃ©
                            </p>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="subscriber-count" id="estimated-subs">+0</div>
                                <span style="font-size: 12px; color: var(--text-dim);">abonnÃ©s potentiels</span>
                            </div>
                            <p style="margin: 10px 0 0; font-size: 11px; color: var(--text-dim);">
                                BasÃ© sur la qualitÃ© et les hashtags de votre publication
                            </p>
                        </div>

                        <button onclick="App.publishPost()" style="width: 100%; padding: 18px; background: var(--accent); color: white; border: none; border-radius: var(--radius-md); font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 20px;">
                            <i class="fas fa-paper-plane"></i>
                            <span id="publish-text">PUBLIER</span>
                            <div class="loader" id="publish-loader"></div>
                        </button>
                        
                        <div style="margin-top: 20px; padding: 15px; background: var(--accent-soft); border-radius: var(--radius-md);">
                            <p style="margin: 0; font-size: 13px; color: var(--accent);">
                                <i class="fas fa-lightbulb"></i> Conseil IA : Utilisez des hashtags pertinents pour 3x plus de visibilitÃ© !
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- COMPRESSOR SECTION -->
        <section id="sec-compressor" class="app-section hidden">
            <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
                <h3 style="margin-top: 0; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-compress-alt" style="color:var(--accent)"></i> Compresseur VidÃ©o
                </h3>
                
                <div style="background: var(--bg-card); border-radius: var(--radius-lg); padding: 30px; border: 1px solid var(--border);">
                    <div id="compressor-step-1">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <i class="fas fa-file-video" style="font-size: 60px; color: var(--accent); margin-bottom: 15px;"></i>
                            <h3>Compressez vos vidÃ©os avant de les poster</h3>
                            <p style="color: var(--text-dim);">RÃ©duisez la taille de vos vidÃ©os sans perdre en qualitÃ©</p>
                        </div>
                        
                        <div style="border: 2px dashed var(--border); border-radius: var(--radius-lg); padding: 40px; text-align: center; cursor: pointer;" 
                             onclick="document.getElementById('compressor-input').click()" id="compressor-dropzone">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 50px; color: var(--accent); margin-bottom: 15px;"></i>
                            <p style="margin: 0; font-weight: 700; font-size: 18px;">Glissez-dÃ©posez votre vidÃ©o ici</p>
                            <p style="margin: 10px 0 0; font-size: 14px; color: var(--text-dim);">MP4, MOV, AVI - Max 2GB</p>
                            <input type="file" id="compressor-input" class="hidden" accept="video/*" onchange="App.handleCompressorFile(event)">
                        </div>
                        
                        <div class="compressor-stats">
                            <div class="stat-box">
                                <div class="value">Jusqu'Ã  90%</div>
                                <div class="label">Plus lÃ©ger</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Rapide</div>
                                <div class="label">Compression</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">OptimisÃ©</div>
                                <div class="label">Pour mobile</div>
                            </div>
                            <div class="stat-box">
                                <div class="value">Gratuit</div>
                                <div class="label">Sans limite</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="compressor-step-2" class="hidden">
                        <div style="display: flex; gap: 30px; align-items: center; margin-bottom: 30px;">
                            <video id="compressor-preview" controls style="width: 200px; height: 350px; border-radius: var(--radius-md); object-fit: cover;"></video>
                            
                            <div style="flex: 1;">
                                <div style="margin-bottom: 20px;">
                                    <p style="margin: 0 0 5px 0; color: var(--text-dim); font-size: 14px;">Fichier original</p>
                                    <p id="original-file-info" style="margin: 0; font-weight: 600; font-size: 16px;"></p>
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <p style="margin: 0 0 5px 0; color: var(--text-dim); font-size: 14px;">AprÃ¨s compression</p>
                                    <p id="compressed-file-info" style="margin: 0; font-weight: 600; font-size: 16px; color: var(--success);"></p>
                                </div>
                                
                                <div style="background: var(--bg-input); padding: 15px; border-radius: var(--radius-md);">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span>Ã‰conomie d'espace</span>
                                        <span id="savings-percent" style="color: var(--success); font-weight: 700;">0%</span>
                                    </div>
                                    <div style="height: 6px; background: var(--bg-deep); border-radius: 3px; overflow: hidden;">
                                        <div id="compression-bar" style="height: 100%; background: linear-gradient(90deg, var(--accent), var(--success)); width: 0%; transition: width 0.5s ease;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <p style="margin: 0 0 10px 0; font-weight: 600;">QualitÃ© de compression</p>
                            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                <button class="quality-btn active" data-quality="high" onclick="App.setCompressionQuality('high')">Haute qualitÃ©</button>
                                <button class="quality-btn" data-quality="medium" onclick="App.setCompressionQuality('medium')">Ã‰quilibrÃ©e</button>
                                <button class="quality-btn" data-quality="low" onclick="App.setCompressionQuality('low')">Petite taille</button>
                            </div>
                        </div>
                        
                        <button onclick="App.startCompression()" id="compress-btn" style="width: 100%; padding: 18px; background: var(--accent); color: white; border: none; border-radius: var(--radius-md); font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <i class="fas fa-compress-alt"></i>
                            <span id="compress-btn-text">COMPRESSER LA VIDÃ‰O</span>
                            <div class="loader" id="compress-loader"></div>
                        </button>
                        
                        <div style="margin-top: 20px; padding: 15px; background: var(--accent-soft); border-radius: var(--radius-md);">
                            <p style="margin: 0; font-size: 13px; color: var(--accent);">
                                <i class="fas fa-info-circle"></i> Conseil : La compression "Ã‰quilibrÃ©e" est idÃ©ale pour Rasstube
                            </p>
                        </div>
                    </div>
                    
                    <div id="compressor-step-3" class="hidden">
                        <div style="text-align: center; padding: 30px;">
                            <i class="fas fa-check-circle" style="font-size: 60px; color: var(--success); margin-bottom: 20px;"></i>
                            <h3 style="margin-bottom: 10px;">Compression rÃ©ussie !</h3>
                            <p style="color: var(--text-dim); margin-bottom: 30px;">Votre vidÃ©o est maintenant prÃªte Ã  Ãªtre publiÃ©e</p>
                            
                            <div style="display: flex; gap: 15px; justify-content: center;">
                                <button onclick="App.downloadCompressedVideo()" style="padding: 15px 30px; background: var(--success); color: white; border: none; border-radius: var(--radius-md); font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-download"></i>
                                    TÃ©lÃ©charger
                                </button>
                                <button onclick="App.uploadCompressedVideo()" style="padding: 15px 30px; background: var(--accent); color: white; border: none; border-radius: var(--radius-md); font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-upload"></i>
                                    Publier maintenant
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PROFILE SECTION -->
        <section id="sec-profile" class="app-section hidden">
            <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
                <div style="display: flex; gap: 30px; margin-bottom: 40px; align-items: flex-start;">
                    <img src="" id="prof-pfp" style="width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--accent); padding: 5px; object-fit: cover;">
                    
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                            <h2 id="prof-name" style="margin: 0; font-size: 28px; font-weight: 800;"></h2>
                            <button onclick="App.editProfile()" style="background: var(--bg-input); border: 1px solid var(--border); color: var(--text-main); padding: 8px 20px; border-radius: var(--radius-md); font-weight: 600; cursor: pointer;">
                                <i class="fas fa-edit"></i> Modifier
                            </button>
                        </div>
                        
                        <p id="prof-email" style="color: var(--text-dim); margin-top: 5px; margin-bottom: 20px;"></p>
                        
                        <p id="prof-bio" style="margin-bottom: 25px; line-height: 1.5;"></p>
                        
                        <div style="display: flex; gap: 30px;">
                            <div style="text-align: center;">
                                <b style="display: block; font-size: 18px;" id="count-posts">0</b>
                                <span style="font-size: 13px; color: var(--text-dim);">Publications</span>
                            </div>
                            <div style="text-align: center;">
                                <b style="display: block; font-size: 18px;" id="count-followers">0</b>
                                <span style="font-size: 13px; color: var(--text-dim);">AbonnÃ©s</span>
                            </div>
                            <div style="text-align: center;">
                                <b style="display: block; font-size: 18px;" id="count-following">0</b>
                                <span style="font-size: 13px; color: var(--text-dim);">Abonnements</span>
                            </div>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background: rgba(255, 138, 0, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(255, 138, 0, 0.3);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <i class="fas fa-fire" style="color: #FF8A00;"></i>
                                <span style="font-weight: 700; color: #FF8A00;">Votre streak de flammes</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="flex: 1;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span style="font-size: 12px; color: var(--text-dim);">Progression</span>
                                        <span style="font-size: 12px; color: #FF8A00; font-weight: 700;" id="flame-streak-profile">0/7 jours</span>
                                    </div>
                                    <div style="height: 6px; background: rgba(255, 138, 0, 0.2); border-radius: 3px; overflow: hidden;">
                                        <div id="flame-progress-profile" style="height: 100%; background: linear-gradient(90deg, #FF8A00, #FF0032); width: 0%;"></div>
                                    </div>
                                </div>
                                <div style="font-size: 24px; font-weight: 800; color: #FF8A00;" id="flame-count">ðŸ”¥ 0</div>
                            </div>
                            <p style="margin: 10px 0 0; font-size: 11px; color: var(--text-dim);">
                                <i class="fas fa-info-circle"></i> Les flammes s'Ã©teignent aprÃ¨s 3 jours d'inactivitÃ©
                            </p>
                        </div>
                    </div>
                </div>

                <div style="display: flex; border-bottom: 1px solid var(--border); margin-bottom: 30px;">
                    <button class="profile-tab active" onclick="App.switchProfileTab('posts')" style="padding: 15px 20px; background: none; border: none; color: var(--accent); border-bottom: 2px solid var(--accent); font-weight: 700; cursor: pointer;">
                        <i class="fas fa-th-large"></i> Publications
                    </button>
                    <button class="profile-tab" onclick="App.switchProfileTab('rshorts')" style="padding: 15px 20px; background: none; border: none; color: var(--text-dim); font-weight: 600; cursor: pointer;">
                        <i class="fas fa-play-circle"></i> RShorts
                    </button>
                    <button class="profile-tab" onclick="App.switchProfileTab('youtube')" style="padding: 15px 20px; background: none; border: none; color: var(--text-dim); font-weight: 600; cursor: pointer;">
                        <i class="fab fa-youtube"></i> YouTube
                    </button>
                </div>

                <div id="profile-posts" class="profile-content">
                    <div class="photos-grid" id="profile-grid"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- BOTTOM NAVIGATION -->
    <nav class="bottom-bar">
        <div class="nav-item active" onclick="App.go('home')">
            <i class="fas fa-home"></i>
            <span>Accueil</span>
        </div>
        <div class="nav-item" onclick="App.go('rsshort')">
            <i class="fas fa-play-circle"></i>
            <span>RShort</span>
        </div>
        <div class="fab-upload" onclick="App.go('upload')" id="fab-upload-btn">
            <i class="fas fa-plus"></i>
        </div>
        <div class="nav-item" onclick="App.go('compressor')">
            <i class="fas fa-compress-alt"></i>
            <span>Compresser</span>
        </div>
        <div class="nav-item" onclick="App.go('aichat')">
            <i class="fas fa-robot"></i>
            <span>IA</span>
        </div>
        <div class="nav-item" onclick="App.go('profile')">
            <i class="fas fa-user"></i>
            <span>Profil</span>
        </div>
    </nav>
</div>

<script>
/**
 * RASSTUBE ULTIMATE v5.0 - SystÃ¨me complet avec YouTube, Flammes et AbonnÃ©s
 */

const App = {
    // Ã‰TAT GLOBAL
    state: {
        users: JSON.parse(localStorage.getItem('rt_v5_users') || '[]'),
        posts: JSON.parse(localStorage.getItem('rt_v5_posts') || '[]'),
        session: JSON.parse(localStorage.getItem('rt_v5_session') || 'null'),
        currentTab: 'login',
        selectedPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rass',
        activeSection: 'home',
        currentUploadFile: null,
        compressedVideoReady: null,
        youtubeVideoUrl: null,
        subscriptions: JSON.parse(localStorage.getItem('rt_v5_subscriptions') || '{}'),
        messages: JSON.parse(localStorage.getItem('rt_v5_messages') || '[]'),
        savedPosts: JSON.parse(localStorage.getItem('rt_v5_saved') || '[]'),
        currentRshort: 0,
        rshortPlaying: true,
        profileTab: 'posts',
        
        // SystÃ¨me de flammes (comme TikTok)
        flameDays: parseInt(localStorage.getItem('rt_flame_days') || '0'),
        flameProgress: parseInt(localStorage.getItem('rt_flame_progress') || '0'),
        lastLoginDate: localStorage.getItem('rt_last_login_date') || '',
        flameFreezeEnd: localStorage.getItem('rt_flame_freeze_end') || '',
        
        // SystÃ¨me d'abonnÃ©s
        subscribers: JSON.parse(localStorage.getItem('rt_subscribers') || '{}'),
        
        // XP et niveaux
        xp: parseInt(localStorage.getItem('rt_xp') || '0'),
        level: parseInt(localStorage.getItem('rt_level') || '1'),
        dailyRewardClaimed: localStorage.getItem('rt_daily_reward') === new Date().toDateString(),
        
        // IA Chat
        aiConversation: [],
        aiPersonality: 'enthusiastic',
        
        // SystÃ¨me de compression
        compressor: {
            currentFile: null,
            quality: 'medium',
            compressedBlob: null
        },
        
        // VidÃ©os YouTube disponibles
        youtubeVideos: [
            {
                id: 'dQw4w9WgXcQ',
                title: 'Never Gonna Give You Up',
                author: 'Rick Astley',
                thumbnail: 'https://img.youtube.com/vi/dQw4w9WgXcQ/maxresdefault.jpg',
                duration: '3:32',
                views: '1.4B'
            },
            {
                id: '9bZkp7q19f0',
                title: 'Gangnam Style',
                author: 'PSY',
                thumbnail: 'https://img.youtube.com/vi/9bZkp7q19f0/maxresdefault.jpg',
                duration: '4:13',
                views: '4.7B'
            },
            {
                id: 'kJQP7kiw5Fk',
                title: 'Despacito',
                author: 'Luis Fonsi',
                thumbnail: 'https://img.youtube.com/vi/kJQP7kiw5Fk/maxresdefault.jpg',
                duration: '4:41',
                views: '8.1B'
            },
            {
                id: 'OPf0YbXqDm0',
                title: 'Uptown Funk',
                author: 'Mark Ronson ft. Bruno Mars',
                thumbnail: 'https://img.youtube.com/vi/OPf0YbXqDm0/maxresdefault.jpg',
                duration: '4:30',
                views: '5.1B'
            },
            {
                id: '09R8_2nJtjg',
                title: 'Shape of You',
                author: 'Ed Sheeran',
                thumbnail: 'https://img.youtube.com/vi/09R8_2nJtjg/maxresdefault.jpg',
                duration: '4:24',
                views: '6.1B'
            }
        ],
        
        // RÃ©ponses IA programmÃ©es
        aiResponses: {
            growth: [
                "ðŸŽ¯ Pour gagner des abonnÃ©s rapidement : Publiez du contenu Ã  heure fixe chaque jour, utilisez au moins 5 hashtags pertinents, et collaborez avec d'autres crÃ©ateurs de votre niche !",
                "ðŸš€ Astuce growth : Les 3 premiÃ¨res secondes de votre vidÃ©o sont cruciales. Commencez par quelque chose de choquant, drÃ´le ou intriguant pour retenir l'attention !",
                "ðŸ’¡ Conseil IA : Analysez vos heures de pointe d'engagement (gÃ©nÃ©ralement 18h-21h) et programmez vos publications en consÃ©quence pour maximiser la visibilitÃ© !",
                "ðŸ“ˆ Pour augmenter l'engagement : Posez des questions dans vos lÃ©gendes, rÃ©pondez Ã  tous les commentaires dans l'heure, et organisez des Q&A en direct !"
            ],
            content: [
                "âœ¨ IdÃ©es de contenu viral : 1) Tutoriels rapides (60s max) 2) Avant/AprÃ¨s 3) DÃ©fis tendance 4) RÃ©actions express 5) Contenu Ã©ducatif animÃ© !",
                "ðŸŽ¬ Format gagnant : Les RShorts de moins de 30 secondes avec musique tendance ont 3x plus de chances de devenir viraux !",
                "ðŸ“± Conseil crÃ©ation : Utilisez des transitions fluides, des sous-titres dynamiques et des effets sonores pour rendre votre contenu plus professionnel !",
                "ðŸ”¥ Tendances du moment : #CapCutChallenge, #AIArt, #SatisfyingVideos, #LearnIn60Seconds - Sautez sur ces trends rapidement !"
            ],
            analytics: [
                "ðŸ“Š Votre contenu performe mieux les week-ends entre 11h et 14h. Le taux d'engagement est 40% plus Ã©levÃ© Ã  ces moments !",
                "ðŸ“ˆ Votre vidÃ©o la plus vue a gardÃ© 75% des viewers jusqu'Ã  la fin. RÃ©pliquez ce format !",
                "ðŸŽ¯ Votre audience est principalement composÃ©e de 18-24 ans (65%). Adaptez votre contenu Ã  cette dÃ©mographie !",
                "ðŸ“‰ Conseil : Les vidÃ©os entre 60 et 90 secondes ont le meilleur taux de rÃ©tention sur votre profil."
            ],
            optimization: [
                "âš¡ Optimisez vos hashtags : Utilisez 3 hashtags populaires (1M+), 3 hashtags moyens (100k-1M) et 3 hashtags de niche (<100k) !",
                "ðŸŽ¨ AmÃ©liorez vos miniatures : Utilisez des couleurs vives, des visages expressifs et du texte en gros caractÃ¨res !",
                "ðŸ” SEO pour Rasstube : Incluez vos mots-clÃ©s principaux dans les 50 premiers caractÃ¨res de votre description !",
                "ðŸ’Ž Pro-tip : Utilisez des appels Ã  l'action clairs (Likez si..., Abonnez-vous pour...) pour booster vos interactions !"
            ],
            entertainment: [
                "ðŸ˜‚ Pourquoi les dÃ©veloppeurs dÃ©testent-ils la nature ? Parce qu'il y a trop de bugs ! ðŸ›",
                "ðŸŽ® Savais-tu que le premier tweet a Ã©tÃ© envoyÃ© en 2006 ? Moi non plus, je suis une IA de 2024 ! ðŸ˜„",
                "âœ¨ Blague IA : Combien de programmeurs faut-il pour changer une ampoule ? Aucun, c'est un problÃ¨me matÃ©riel ! ðŸ’¡",
                "ðŸ˜† Pourquoi le livre de mathÃ©matiques Ã©tait-il triste ? Parce qu'il avait trop de problÃ¨mes !"
            ],
            general: [
                "ðŸŒŸ Salut ! Je suis ravi de discuter avec vous aujourd'hui. Comment puis-je vous aider Ã  dominer Rasstube ?",
                "ðŸ¤– En tant qu'IA Rasstube, j'ai analysÃ© des milliers de contenus viraux. Laissez-moi vous guider vers le succÃ¨s !",
                "ðŸ’« Wow, excellente question ! Permettez-moi de vous donner les insights les plus rÃ©cents du marchÃ©...",
                "ðŸš€ PrÃªt Ã  passer au niveau supÃ©rieur ? Je dÃ©tecte un grand potentiel dans votre profil. Continuons !"
            ]
        }
    },

    // INITIALISATION
    init() {
        this.verifySession();
        this.renderAvatars();
        this.sync();
        this.setupDragAndDrop();

        if(this.state.session) {
            this.launch();
        }
        
        // CrÃ©er des donnÃ©es par dÃ©faut
        if(this.state.posts.length === 0) {
            this.createDefaultData();
        }
        
        // VÃ©rifier la rÃ©compense quotidienne
        this.checkDailyReward();
        
        // VÃ©rifier le systÃ¨me de flammes
        this.checkFlameSystem();
    },

    // CRÃ‰ATION DES DONNÃ‰ES PAR DÃ‰FAUT
    createDefaultData() {
        const defaultUsers = [
            { 
                pseudo: 'Rayan', 
                email: 'rayan@example.com',
                pass: '123456',
                pfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rayan',
                bio: 'Gamer & Content Creator ðŸŽ® â€¢ Nouveau sur Rasstube',
                followers: 0, // COMMENCE Ã€ 0
                following: 0,
                flameDays: 7, // Pour dÃ©mo
                postsCount: 2
            },
            { 
                pseudo: 'Sarah', 
                email: 'sarah@example.com',
                pass: '123456',
                pfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah',
                bio: 'Photographe voyage ðŸŒ â€¢ AventuriÃ¨re digitale',
                followers: 0,
                following: 0,
                flameDays: 3,
                postsCount: 1
            },
            { 
                pseudo: 'Alex', 
                email: 'alex@example.com',
                pass: '123456',
                pfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Alex',
                bio: 'Chef cuisinier ðŸ‘¨â€ðŸ³ â€¢ Recettes en 60s',
                followers: 0,
                following: 0,
                flameDays: 5,
                postsCount: 0
            }
        ];
        
        defaultUsers.forEach(user => {
            if(!this.state.users.find(u => u.pseudo === user.pseudo)) {
                this.state.users.push({
                    id: Date.now() + Math.random(),
                    ...user,
                    joined: new Date().toLocaleDateString('fr-FR')
                });
            }
        });

        const defaultPosts = [
            {
                id: 1,
                author: 'Rayan',
                authorPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rayan',
                title: 'Nouveau record sur Fortnite ! ðŸŽ® #gaming #fortnite #record',
                type: 'rshort',
                content: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4',
                likes: 1245,
                likedBy: ['Rayan', 'Sarah'],
                comments: 89,
                shares: 45,
                views: 12500,
                duration: 15,
                timestamp: new Date(Date.now() - 3600000).toISOString(),
                tags: ['gaming', 'fortnite', 'record'],
                estimatedSubs: 45 // AbonnÃ©s gagnÃ©s grÃ¢ce Ã  cette vidÃ©o
            },
            {
                id: 2,
                author: 'Sarah',
                authorPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah',
                title: 'Coucher de soleil Ã  Bali ðŸŒ… #voyage #bali #photographie #paradis',
                type: 'photo',
                content: 'https://images.unsplash.com/photo-1518548419970-58e3b4079ab2?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                likes: 892,
                likedBy: ['Sarah', 'Alex'],
                comments: 67,
                shares: 23,
                views: 8900,
                timestamp: new Date(Date.now() - 7200000).toISOString(),
                tags: ['voyage', 'bali', 'photographie'],
                estimatedSubs: 32
            },
            {
                id: 3,
                author: 'Rayan',
                authorPfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Rayan',
                title: 'Tuto YouTube - Comment monter une vidÃ©o',
                type: 'youtube',
                content: 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                youtubeId: 'dQw4w9WgXcQ',
                likes: 542,
                likedBy: ['Sarah'],
                comments: 23,
                shares: 12,
                views: 3200,
                timestamp: new Date(Date.now() - 86400000).toISOString(),
                tags: ['tuto', 'montage', 'youtube'],
                estimatedSubs: 28
            }
        ];
        
        this.state.posts = defaultPosts;
        this.sync();
    },

    // LANCEMENT APP
    launch() {
        document.getElementById('auth-portal').classList.add('hidden');
        document.getElementById('main-app').style.display = 'block';
        
        // Mettre Ã  jour l'interface
        document.getElementById('user-pfp-top').src = this.state.session.pfp;
        document.getElementById('prof-pfp').src = this.state.session.pfp;
        document.getElementById('prof-name').innerText = this.state.session.pseudo;
        document.getElementById('prof-email').innerText = this.state.session.email;
        document.getElementById('prof-bio').innerText = this.state.session.bio || "Aucune bio pour le moment";
        
        // Mettre Ã  jour les flammes et XP
        this.updateFlameSystem();
        this.updateXPBar();
        
        // Afficher les Ã©lÃ©ments addictifs
        document.getElementById('xp-bar').classList.remove('hidden');
        document.getElementById('streak-counter').classList.remove('hidden');
        document.getElementById('flame-progress').classList.remove('hidden');
        
        if(!this.state.dailyRewardClaimed) {
            document.getElementById('daily-reward').classList.remove('hidden');
        }
        
        // Afficher la badge de notification
        document.getElementById('notification-badge').style.display = 'block';
        
        this.updateProfileStats();
        this.renderFeed();
        this.renderStories();
        this.go('home');
        
        // DÃ©clencher une notification de bienvenue
        setTimeout(() => {
            if(this.state.flameDays > 0) {
                this.notify(`ðŸ”¥ Streak de ${this.state.flameDays} jours ! Continuez comme Ã§a !`, 'success');
            } else {
                this.notify(`ðŸŽ‰ Bienvenue sur Rasstube ! Commencez votre streak de flammes dÃ¨s aujourd'hui !`, 'success');
            }
            this.showAchievement('Bienvenue !', 'fas fa-trophy', 'Vous avez ouvert Rasstube aujourd\'hui !');
        }, 1000);
    },

    // SYSTÃˆME DE FLAMMES (comme TikTok)
    checkFlameSystem() {
        const today = new Date().toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        const threeDaysAgo = new Date(Date.now() - (3 * 86400000)).toDateString();
        
        // RÃ©cupÃ©rer la derniÃ¨re date de connexion
        const lastLogin = this.state.lastLoginDate ? new Date(this.state.lastLoginDate) : null;
        
        if(!lastLogin) {
            // PremiÃ¨re connexion
            this.state.flameDays = 0;
            this.state.flameProgress = 0;
            this.state.lastLoginDate = today;
        } else {
            const lastLoginDateStr = lastLogin.toDateString();
            
            // VÃ©rifier si la flamme est gelÃ©e
            if(this.state.flameFreezeEnd) {
                const freezeEnd = new Date(this.state.flameFreezeEnd);
                if(new Date() > freezeEnd) {
                    // Fin du gel - rÃ©initialiser les flammes
                    this.state.flameDays = 0;
                    this.state.flameProgress = 0;
                    this.state.flameFreezeEnd = '';
                    this.notify("â„ï¸ Votre streak de flammes a Ã©tÃ© rÃ©initialisÃ© aprÃ¨s 3 jours d'inactivitÃ©", "warning");
                }
            }
            
            // Mettre Ã  jour le streak
            if(lastLoginDateStr === yesterday) {
                // Connexion quotidienne - augmenter la progression
                this.state.flameProgress += 1;
                
                if(this.state.flameProgress >= 7) {
                    this.state.flameDays += 1;
                    this.state.flameProgress = 0;
                    this.showAchievement('Flamme gagnÃ©e !', 'fas fa-fire', `Vous avez maintenant ${this.state.flameDays} jours de streak !`);
                }
            } else if(lastLoginDateStr !== today) {
                // Connexion aprÃ¨s plus d'un jour
                if(this.state.flameDays > 0) {
                    // Commencer le gel de 3 jours
                    const freezeEnd = new Date();
                    freezeEnd.setDate(freezeEnd.getDate() + 3);
                    this.state.flameFreezeEnd = freezeEnd.toISOString();
                    this.notify("â„ï¸ Attention : Votre streak est maintenant gelÃ© pour 3 jours ! Revenez demain pour le sauver.", "warning");
                }
            }
            
            this.state.lastLoginDate = today;
        }
        
        this.syncFlameData();
    },

    updateFlameSystem() {
        // Mettre Ã  jour l'affichage des flammes
        document.getElementById('streak-days').innerText = this.state.flameDays + ' jours';
        
        const flameProgressPercent = (this.state.flameProgress / 7) * 100;
        document.getElementById('flame-bar').style.width = flameProgressPercent + '%';
        document.getElementById('flame-days').innerText = this.state.flameProgress + '/7';
        
        // Mettre Ã  jour dans le profil
        document.getElementById('flame-streak-profile').innerText = this.state.flameProgress + '/7 jours';
        document.getElementById('flame-progress-profile').style.width = flameProgressPercent + '%';
        document.getElementById('flame-count').innerHTML = `ðŸ”¥ ${this.state.flameDays}`;
        
        // Animation spÃ©ciale pour les flammes
        if(this.state.flameDays > 0) {
            document.getElementById('streak-counter').style.animation = 'flame 2s infinite';
        }
    },

    syncFlameData() {
        localStorage.setItem('rt_flame_days', this.state.flameDays.toString());
        localStorage.setItem('rt_flame_progress', this.state.flameProgress.toString());
        localStorage.setItem('rt_last_login_date', this.state.lastLoginDate);
        if(this.state.flameFreezeEnd) {
            localStorage.setItem('rt_flame_freeze_end', this.state.flameFreezeEnd);
        }
    },

    // SYSTÃˆME D'ABONNÃ‰S
    addSubscribers(userPseudo, amount) {
        // Trouver l'utilisateur
        const user = this.state.users.find(u => u.pseudo === userPseudo);
        if(user) {
            user.followers = (user.followers || 0) + amount;
            
            // Mettre Ã  jour le compteur d'abonnÃ©s dans le profil
            if(user.pseudo === this.state.session.pseudo) {
                document.getElementById('count-followers').innerText = user.followers;
            }
            
            this.sync();
            
            // Notifier l'utilisateur
            if(amount > 0) {
                this.notify(`ðŸŽ‰ +${amount} nouveaux abonnÃ©s !`, 'success');
                
                // Gagner de l'XP pour les nouveaux abonnÃ©s
                this.addXP(amount * 5);
            }
        }
    },

    calculateEstimatedSubs(title, tags, type) {
        // Calculer les abonnÃ©s estimÃ©s basÃ©s sur le titre, les hashtags et le type
        let baseSubs = 10;
        
        // Bonus pour le titre (longueur optimale)
        if(title.length > 20 && title.length < 60) baseSubs += 5;
        
        // Bonus pour les hashtags (entre 3 et 5 hashtags optimaux)
        const tagCount = tags.split(',').filter(t => t.trim()).length;
        if(tagCount >= 3 && tagCount <= 5) baseSubs += 8;
        
        // Bonus pour le type de contenu
        if(type === 'rshort') baseSubs += 15;
        if(type === 'youtube') baseSubs += 12;
        
        // AlÃ©atoire entre -5 et +10
        const randomBonus = Math.floor(Math.random() * 16) - 5;
        
        return Math.max(5, baseSubs + randomBonus);
    },

    // XP SYSTEM
    updateXPBar() {
        const xpNeededForNextLevel = this.state.level * 100;
        const progress = (this.state.xp % 100) / 100 * 100;
        document.getElementById('xp-progress').style.width = progress + '%';
    },

    addXP(amount) {
        this.state.xp += amount;
        const oldLevel = this.state.level;
        this.state.level = Math.floor(this.state.xp / 100) + 1;
        
        if(this.state.level > oldLevel) {
            this.showAchievement('Niveau ' + this.state.level + ' atteint !', 'fas fa-star', 'Vous progressez rapidement !');
            this.notify(`ðŸŽ‰ FÃ©licitations ! Vous avez atteint le niveau ${this.state.level} !`, 'success');
        }
        
        localStorage.setItem('rt_xp', this.state.xp.toString());
        localStorage.setItem('rt_level', this.state.level.toString());
        this.updateXPBar();
    },

    checkDailyReward() {
        const today = new Date().toDateString();
        if(localStorage.getItem('rt_daily_reward') !== today) {
            this.state.dailyRewardClaimed = false;
        }
    },

    claimDailyReward() {
        this.state.dailyRewardClaimed = true;
        localStorage.setItem('rt_daily_reward', new Date().toDateString());
        
        const rewardXP = 50 + (this.state.flameDays * 10);
        this.addXP(rewardXP);
        
        // Ajouter aussi des abonnÃ©s pour la rÃ©compense quotidienne
        const rewardSubs = 3 + this.state.flameDays;
        this.addSubscribers(this.state.session.pseudo, rewardSubs);
        
        document.getElementById('daily-reward').classList.add('hidden');
        this.showAchievement('RÃ©compense quotidienne !', 'fas fa-gift', `+${rewardXP} XP et +${rewardSubs} abonnÃ©s !`);
        this.notify(`ðŸŽ RÃ©compense quotidienne : +${rewardXP} XP et +${rewardSubs} abonnÃ©s !`, 'success');
    },

    showAchievement(title, icon, description) {
        const popup = document.createElement('div');
        popup.className = 'achievement-popup';
        popup.innerHTML = `
            <div class="achievement-icon">
                <i class="${icon}"></i>
            </div>
            <h3 style="margin:0 0 10px 0; color:var(--accent);">${title}</h3>
            <p style="margin:0; color:var(--text-dim);">${description}</p>
            <button onclick="this.parentElement.remove()" style="margin-top:20px; padding:10px 20px; background:var(--accent); color:white; border:none; border-radius:var(--radius-md); cursor:pointer;">
                Super !
            </button>
        `;
        
        document.body.appendChild(popup);
        
        setTimeout(() => {
            if(popup.parentElement) {
                popup.remove();
            }
        }, 5000);
    },

    // IMPORTATION YOUTUBE
    importYouTubeVideo() {
        const url = document.getElementById('youtube-link').value;
        if(!url) {
            this.notify("âŒ Veuillez coller un lien YouTube", "error");
            return;
        }
        
        // Extraire l'ID de la vidÃ©o YouTube
        let videoId = '';
        const patterns = [
            /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]+)/,
            /youtube\.com\/shorts\/([a-zA-Z0-9_-]+)/
        ];
        
        for(const pattern of patterns) {
            const match = url.match(pattern);
            if(match && match[1]) {
                videoId = match[1];
                break;
            }
        }
        
        if(!videoId) {
            this.notify("âŒ Lien YouTube invalide", "error");
            return;
        }
        
        // Trouver la vidÃ©o dans notre liste ou en crÃ©er une nouvelle
        let youtubeVideo = this.state.youtubeVideos.find(v => v.id === videoId);
        
        if(!youtubeVideo) {
            // CrÃ©er une vidÃ©o YouTube par dÃ©faut
            youtubeVideo = {
                id: videoId,
                title: 'VidÃ©o YouTube importÃ©e',
                author: 'YouTube Creator',
                thumbnail: `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`,
                duration: '4:00',
                views: '1M'
            };
        }
        
        this.state.youtubeVideoUrl = `https://www.youtube.com/embed/${videoId}`;
        
        // Mettre Ã  jour l'interface
        document.getElementById('upload-preview').innerHTML = `
            <div class="youtube-player-container">
                <img src="${youtubeVideo.thumbnail}" class="youtube-thumbnail">
                <div class="youtube-play-button">
                    <i class="fas fa-play"></i>
                </div>
            </div>
            <div style="margin-top:15px; display:flex; align-items:center; gap:10px;">
                <i class="fab fa-youtube" style="color:var(--youtube-red)"></i>
                <span>${youtubeVideo.title} â€¢ ${youtubeVideo.duration}</span>
            </div>
            <p style="margin:5px 0 0; color:var(--text-dim); font-size:13px;">
                <i class="fas fa-user"></i> ${youtubeVideo.author} â€¢ <i class="fas fa-eye"></i> ${youtubeVideo.views} vues
            </p>
        `;
        
        document.getElementById('upload-preview').classList.remove('hidden');
        document.getElementById('up-type').value = 'youtube';
        
        // Estimer les abonnÃ©s pour une vidÃ©o YouTube
        const estimatedSubs = this.calculateEstimatedSubs('VidÃ©o YouTube importÃ©e', 'youtube,video,tendance', 'youtube');
        document.getElementById('estimated-subs').innerText = `+${estimatedSubs}`;
        
        this.notify("âœ… VidÃ©o YouTube importÃ©e avec succÃ¨s !", "success");
    },

    // SYSTEME DE COMPRESSION
    setCompressionQuality(quality) {
        this.state.compressor.quality = quality;
        document.querySelectorAll('.quality-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`.quality-btn[data-quality="${quality}"]`).classList.add('active');
    },

    handleCompressorFile(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        // VÃ©rifier que c'est une vidÃ©o
        if (!file.type.startsWith('video/')) {
            this.notify("âŒ Veuillez sÃ©lectionner une vidÃ©o", "error");
            return;
        }
        
        // VÃ©rifier la taille (max 2GB)
        if (file.size > 2 * 1024 * 1024 * 1024) {
            this.notify("âŒ La vidÃ©o est trop lourde (max 2GB)", "error");
            return;
        }
        
        this.state.compressor.currentFile = file;
        
        // Afficher les infos du fichier
        const fileSize = (file.size / (1024 * 1024)).toFixed(1);
        document.getElementById('original-file-info').innerText = 
            `${file.name} â€¢ ${fileSize} MB`;
        
        // PrÃ©visualiser la vidÃ©o
        const preview = document.getElementById('compressor-preview');
        preview.src = URL.createObjectURL(file);
        
        // Passer Ã  l'Ã©tape 2
        document.getElementById('compressor-step-1').classList.add('hidden');
        document.getElementById('compressor-step-2').classList.remove('hidden');
        
        this.notify("ðŸ“¹ VidÃ©o chargÃ©e avec succÃ¨s", "success");
    },

    async startCompression() {
        const file = this.state.compressor.currentFile;
        if (!file) return;
        
        const btn = document.getElementById('compress-btn');
        const btnText = document.getElementById('compress-btn-text');
        const loader = document.getElementById('compress-loader');
        
        btn.disabled = true;
        btnText.innerText = "COMPRESSION EN COURS...";
        loader.style.display = 'block';
        
        try {
            // Simuler la compression
            await this.simulateCompression(file);
            
            // Passer Ã  l'Ã©tape 3
            document.getElementById('compressor-step-2').classList.add('hidden');
            document.getElementById('compressor-step-3').classList.remove('hidden');
            
            // Gagner XP pour la compression
            this.addXP(25);
            this.notify("âœ… Compression rÃ©ussie !", "success");
            
        } catch (error) {
            this.notify("âŒ Erreur lors de la compression", "error");
        } finally {
            btn.disabled = false;
            btnText.innerText = "COMPRESSER LA VIDÃ‰O";
            loader.style.display = 'none';
        }
    },

    simulateCompression(file) {
        return new Promise((resolve) => {
            const quality = this.state.compressor.quality;
            const originalSize = file.size;
            
            // Facteurs de compression selon la qualitÃ©
            const compressionFactors = {
                high: 0.6,    // -40%
                medium: 0.3,  // -70%
                low: 0.1      // -90%
            };
            
            const factor = compressionFactors[quality];
            const newSize = originalSize * factor;
            
            // Mettre Ã  jour la barre de progression
            const bar = document.getElementById('compression-bar');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += 2;
                bar.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Mettre Ã  jour les infos
                    const originalMB = (originalSize / (1024 * 1024)).toFixed(1);
                    const newMB = (newSize / (1024 * 1024)).toFixed(1);
                    const savings = (100 - (newSize / originalSize * 100)).toFixed(0);
                    
                    document.getElementById('compressed-file-info').innerText = 
                        `Version compressÃ©e â€¢ ${newMB} MB`;
                    document.getElementById('savings-percent').innerText = 
                        `${savings}% d'Ã©conomie`;
                    
                    // CrÃ©er un blob simulÃ©
                    this.state.compressor.compressedBlob = new Blob(
                        [file.slice(0, file.size * factor)], 
                        { type: file.type }
                    );
                    
                    resolve();
                }
            }, 30);
        });
    },

    downloadCompressedVideo() {
        if (!this.state.compressor.compressedBlob) return;
        
        const url = URL.createObjectURL(this.state.compressor.compressedBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `compressed_${this.state.compressor.currentFile.name}`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        this.notify("ðŸ“¥ TÃ©lÃ©chargement lancÃ©", "success");
    },

    uploadCompressedVideo() {
        if (!this.state.compressor.compressedBlob) return;
        
        // CrÃ©er un fichier Ã  partir du blob
        const compressedFile = new File(
            [this.state.compressor.compressedBlob],
            `compressed_${this.state.compressor.currentFile.name}`,
            { type: this.state.compressor.currentFile.type }
        );
        
        // Rediriger vers la section upload avec le fichier prÃ©-chargÃ©
        this.go('upload');
        
        // Simuler le chargement du fichier dans l'upload
        setTimeout(() => {
            const dropzone = document.getElementById('upload-dropzone');
            dropzone.innerHTML = `
                <div style="text-align: center;">
                    <i class="fas fa-check-circle" style="font-size: 40px; color: var(--success); margin-bottom: 15px;"></i>
                    <p style="margin: 0; font-weight: 700;">VidÃ©o compressÃ©e prÃªte</p>
                    <p style="margin: 5px 0 0; color: var(--text-dim);">${compressedFile.name}</p>
                    <p style="margin: 5px 0 0; color: var(--success); font-size: 12px;">
                        <i class="fas fa-check"></i> OptimisÃ©e pour Rasstube
                    </p>
                </div>
            `;
            
            // Stocker le fichier pour la publication
            this.state.compressedVideoReady = compressedFile;
            
            this.notify("ðŸŽ¬ VidÃ©o compressÃ©e prÃªte Ã  Ãªtre publiÃ©e", "success");
        }, 500);
    },

    // IA CHAT ADDICTIVE
    sendAIMessage() {
        const input = document.getElementById('ai-input');
        const message = input.value.trim();
        
        if(!message) return;
        
        // Ajouter le message utilisateur
        this.addAIMessage(message, 'user');
        input.value = '';
        
        // RÃ©ponse IA avec dÃ©lai
        setTimeout(() => {
            this.generateAIResponse(message);
        }, 1000 + Math.random() * 1000);
    },

    sendAIQuick(message) {
        document.getElementById('ai-input').value = message;
        this.sendAIMessage();
    },

    addAIMessage(text, sender) {
        const container = document.getElementById('ai-chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `ai-message ${sender}`;
        
        if(sender === 'user') {
            messageDiv.innerHTML = `<strong>ðŸ‘¤ Vous:</strong><p>${text}</p>`;
        } else {
            messageDiv.innerHTML = `<strong>ðŸ¤– IA Rasstube:</strong><p>${text}</p>`;
        }
        
        container.appendChild(messageDiv);
        container.scrollTop = container.scrollHeight;
        
        // Ajouter XP pour interaction
        if(sender === 'user') {
            this.addXP(5);
        }
    },

    generateAIResponse(userMessage) {
        const lowerMessage = userMessage.toLowerCase();
        let response = '';
        
        // Montrer l'indicateur de frappe
        const typingIndicator = document.createElement('div');
        typingIndicator.className = 'ai-typing';
        typingIndicator.innerHTML = '<span></span><span></span><span></span>';
        document.getElementById('ai-chat-messages').appendChild(typingIndicator);
        
        // GÃ©nÃ©rer une rÃ©ponse basÃ©e sur le message
        setTimeout(() => {
            typingIndicator.remove();
            
            if(lowerMessage.includes('abonnÃ©') || lowerMessage.includes('follower') || lowerMessage.includes('croissance')) {
                response = this.state.aiResponses.growth[Math.floor(Math.random() * this.state.aiResponses.growth.length)];
            } else if(lowerMessage.includes('contenu') || lowerMessage.includes('idÃ©e') || lowerMessage.includes('vidÃ©o')) {
                response = this.state.aiResponses.content[Math.floor(Math.random() * this.state.aiResponses.content.length)];
            } else if(lowerMessage.includes('analyse') || lowerMessage.includes('stat') || lowerMessage.includes('performance')) {
                response = this.state.aiResponses.analytics[Math.floor(Math.random() * this.state.aiResponses.analytics.length)];
            } else if(lowerMessage.includes('optim') || lowerMessage.includes('hashtag') || lowerMessage.includes('seo')) {
                response = this.state.aiResponses.optimization[Math.floor(Math.random() * this.state.aiResponses.optimization.length)];
            } else if(lowerMessage.includes('blague') || lowerMessage.includes('drÃ´le') || lowerMessage.includes('rire')) {
                response = this.state.aiResponses.entertainment[Math.floor(Math.random() * this.state.aiResponses.entertainment.length)];
            } else {
                response = this.state.aiResponses.general[Math.floor(Math.random() * this.state.aiResponses.general.length)];
            }
            
            // Ajouter des Ã©lÃ©ments addictifs
            if(Math.random() > 0.7) {
                response += `\n\nðŸŽ® **Astuce du jour** : ${this.getDailyTip()}`;
            }
            
            if(Math.random() > 0.8) {
                response += `\n\nðŸ”¥ **Votre streak** : ${this.state.flameDays} jours - Continuez comme Ã§a !`;
            }
            
            this.addAIMessage(response, 'bot');
            
            // Ajouter XP pour rÃ©ponse IA
            this.addXP(10);
        }, 1500 + Math.random() * 2000);
    },

    getDailyTip() {
        const tips = [
            "Likez 10 posts par jour pour augmenter votre visibilitÃ© de 30%",
            "Postez un RShort entre 18h et 20h pour maximiser les vues",
            "Utilisez 3 hashtags exacts dans vos 3 premiers commentaires",
            "RÃ©pondez aux commentaires dans les 15 minutes pour booster l'algorithme",
            "Collaborez avec un crÃ©ateur de votre niche cette semaine"
        ];
        return tips[Math.floor(Math.random() * tips.length)];
    },

    // RSSHORT ADDICTIVE
    renderRshorts() {
        const rshorts = this.state.posts.filter(p => p.type === 'rshort' || p.type === 'youtube');
        if(rshorts.length === 0) {
            document.getElementById('rsshort-container').innerHTML = `
                <div style="display:flex; align-items:center; justify-content:center; height:100%; background:var(--bg-deep); color:white;">
                    <div style="text-align:center;">
                        <i class="fas fa-play-circle" style="font-size:60px; color:var(--tiktok-pink); margin-bottom:20px;"></i>
                        <h3>Aucun RShort disponible</h3>
                        <p>Soyez le premier Ã  crÃ©er un RShort !</p>
                        <button onclick="App.go('upload')" style="margin-top:20px; padding:12px 25px; background:var(--tiktok-pink); color:white; border:none; border-radius:var(--radius-md); cursor:pointer;">
                            CrÃ©er mon premier RShort
                        </button>
                    </div>
                </div>
            `;
            return;
        }
        
        const currentRshort = rshorts[this.state.currentRshort];
        
        // Container principal
        if(currentRshort.type === 'youtube') {
            document.getElementById('rsshort-container').innerHTML = `
                <iframe 
                    src="${currentRshort.content}?autoplay=1&mute=1&controls=0&modestbranding=1&rel=0"
                    style="width:100%; height:100%; border:none;"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
                </iframe>
            `;
        } else {
            document.getElementById('rsshort-container').innerHTML = `
                <video class="rsshort-video" id="rsshort-video" autoplay muted playsinline>
                    <source src="${currentRshort.content}" type="video/mp4">
                </video>
            `;
        }
        
        // Overlay avec infos
        document.getElementById('rsshort-overlay').innerHTML = `
            <div style="margin-bottom:15px;">
                <h3 style="margin:0 0 10px 0; display:flex; align-items:center; gap:10px;">
                    <img src="${currentRshort.authorPfp}" style="width:40px; height:40px; border-radius:50%; border:2px solid var(--accent);">
                    ${currentRshort.author}
                    ${currentRshort.estimatedSubs ? `<span class="subscriber-badge" style="margin-left:10px;">+${currentRshort.estimatedSubs} abonnÃ©s</span>` : ''}
                </h3>
                <p style="margin:0; font-size:16px;">${currentRshort.title}</p>
            </div>
            <div style="display:flex; gap:15px; font-size:13px; color:var(--text-dim);">
                ${currentRshort.type === 'youtube' ? '<span><i class="fab fa-youtube" style="color:var(--youtube-red)"></i> YouTube</span>' : '<span><i class="fas fa-music"></i> Son original</span>'}
                <span><i class="fas fa-eye"></i> ${this.formatNumber(currentRshort.views)} vues</span>
                <span><i class="fas fa-clock"></i> ${this.formatTime(currentRshort.timestamp)}</span>
            </div>
        `;
        
        // Boutons latÃ©raux avec animations
        document.getElementById('rsshort-side-buttons').innerHTML = `
            <div class="rsshort-btn ${currentRshort.likedBy.includes(this.state.session.pseudo) ? 'active' : ''}" onclick="App.likePost(${currentRshort.id})">
                <i class="fas fa-heart"></i>
                <span>${this.formatNumber(currentRshort.likes)}</span>
            </div>
            <div class="rsshort-btn" onclick="App.focusComment(${currentRshort.id})">
                <i class="fas fa-comment"></i>
                <span>${this.formatNumber(currentRshort.comments)}</span>
            </div>
            <div class="rsshort-btn" onclick="App.sharePost(${currentRshort.id})">
                <i class="fas fa-share"></i>
                <span>${this.formatNumber(currentRshort.shares)}</span>
            </div>
            <div class="rsshort-btn" onclick="App.toggleRshortPlay()">
                <i class="fas fa-${this.state.rshortPlaying ? 'pause' : 'play'}"></i>
                <span>${this.state.rshortPlaying ? 'Pause' : 'Play'}</span>
            </div>
            <div class="rsshort-btn" onclick="App.nextRshort()">
                <i class="fas fa-forward"></i>
                <span>Suivant</span>
            </div>
        `;
        
        // Configurer la vidÃ©o (si ce n'est pas YouTube)
        if(currentRshort.type !== 'youtube') {
            const video = document.getElementById('rsshort-video');
            if(video) {
                video.onended = () => {
                    this.nextRshort();
                    this.addXP(3); // XP pour avoir regardÃ© jusqu'au bout
                };
                video.onclick = () => this.toggleRshortPlay();
                
                if(this.state.rshortPlaying) {
                    video.play();
                } else {
                    video.pause();
                }
                
                // Barre de progression
                video.ontimeupdate = () => {
                    const progress = (video.currentTime / video.duration) * 100;
                    document.getElementById('rsshort-progress').style.width = progress + '%';
                };
            }
        }
        
        // Ajouter une vue
        setTimeout(() => {
            currentRshort.views = (currentRshort.views || 0) + 1;
            this.sync();
        }, 3000);
    },

    nextRshort() {
        const rshorts = this.state.posts.filter(p => p.type === 'rshort' || p.type === 'youtube');
        this.state.currentRshort = (this.state.currentRshort + 1) % rshorts.length;
        this.renderRshorts();
        this.addXP(2); // XP pour avoir regardÃ© un nouveau RShort
    },

    toggleRshortPlay() {
        this.state.rshortPlaying = !this.state.rshortPlaying;
        
        if(this.state.posts.filter(p => p.type === 'rshort' || p.type === 'youtube')[this.state.currentRshort].type !== 'youtube') {
            const video = document.getElementById('rsshort-video');
            if(video) {
                if(this.state.rshortPlaying) {
                    video.play();
                } else {
                    video.pause();
                }
            }
        }
        
        this.renderRshorts();
    },

    likePost(id) {
        const post = this.state.posts.find(p => p.id === id);
        if(!post) return;
        
        const index = post.likedBy.indexOf(this.state.session.pseudo);
        
        if(index === -1) {
            post.likes++;
            post.likedBy.push(this.state.session.pseudo);
            this.notify("â¤ï¸ Publication aimÃ©e ! +5 XP", "success");
            this.addXP(5);
            
            // Animation spÃ©ciale
            const heart = document.createElement('div');
            heart.innerHTML = '<i class="fas fa-heart" style="color:var(--accent); font-size:50px;"></i>';
            heart.style.cssText = 'position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); z-index:1000; animation:heartbeat 0.5s ease;';
            document.getElementById('rsshort-container').appendChild(heart);
            setTimeout(() => heart.remove(), 500);
        } else {
            post.likes--;
            post.likedBy.splice(index, 1);
            this.notify("Like retirÃ©", "info");
        }
        
        this.sync();
        this.renderRshorts();
    },

    sharePost(id) {
        const post = this.state.posts.find(p => p.id === id);
        if(!post) return;
        
        post.shares = (post.shares || 0) + 1;
        this.sync();
        this.addXP(10);
        
        this.notify("ðŸ“¤ Partage rÃ©ussi ! +10 XP", "success");
        
        if(navigator.share) {
            navigator.share({
                title: `${post.author} sur Rasstube`,
                text: post.title,
                url: window.location.href
            });
        } else {
            navigator.clipboard.writeText(`Regarde ce RShort sur Rasstube !\n\n${post.author}: ${post.title}`);
        }
        
        this.renderRshorts();
    },

    // UPLOAD SYSTEM
    previewUpload(event) {
        const files = event.target.files;
        if (!files || files.length === 0) return;
        
        const file = files[0];
        const preview = document.getElementById('upload-preview');
        
        // VÃ©rifier la taille du fichier
        if (file.size > 100 * 1024 * 1024) { // 100MB max
            this.notify("âš ï¸ Fichier trop volumineux. Utilisez le compresseur.", "warning");
            this.go('compressor');
            return;
        }
        
        preview.classList.remove('hidden');
        
        if (file.type.startsWith('video/')) {
            preview.innerHTML = `
                <video controls style="width:100%; max-height:400px; border-radius:var(--radius-md);">
                    <source src="${URL.createObjectURL(file)}" type="${file.type}">
                </video>
                <div style="margin-top:15px; display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-file-video" style="color:var(--accent)"></i>
                    <span>${file.name} â€¢ ${(file.size/(1024*1024)).toFixed(1)} MB</span>
                </div>
            `;
        } else if (file.type.startsWith('image/')) {
            preview.innerHTML = `
                <img src="${URL.createObjectURL(file)}" style="width:100%; max-height:400px; object-fit:cover; border-radius:var(--radius-md);">
                <div style="margin-top:15px; display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-image" style="color:var(--accent)"></i>
                    <span>${file.name} â€¢ ${(file.size/(1024*1024)).toFixed(1)} MB</span>
                </div>
            `;
        }
        
        this.state.currentUploadFile = file;
        
        // Estimer les abonnÃ©s
        const title = document.getElementById('up-title').value || 'Nouvelle publication';
        const tags = document.getElementById('up-tags').value || '';
        const type = document.getElementById('up-type').value;
        const estimatedSubs = this.calculateEstimatedSubs(title, tags, type);
        document.getElementById('estimated-subs').innerText = `+${estimatedSubs}`;
        
        this.notify("ðŸ“ Fichier chargÃ© avec succÃ¨s", "success");
    },

    async publishPost() {
        const title = document.getElementById('up-title').value;
        const tags = document.getElementById('up-tags').value;
        const type = document.getElementById('up-type').value;
        
        if (!title.trim()) {
            this.notify("âŒ Veuillez ajouter un titre", "error");
            return;
        }
        
        if (!this.state.currentUploadFile && !this.state.compressedVideoReady && !this.state.youtubeVideoUrl && type !== 'youtube') {
            this.notify("âŒ Veuillez sÃ©lectionner un fichier", "error");
            return;
        }
        
        // Calculer les abonnÃ©s estimÃ©s
        const estimatedSubs = this.calculateEstimatedSubs(title, tags, type);
        
        const btnText = document.getElementById('publish-text');
        const loader = document.getElementById('publish-loader');
        
        btnText.innerText = "PUBLICATION...";
        loader.style.display = 'block';
        
        // CrÃ©er une barre de progression
        const progressBar = document.createElement('div');
        progressBar.className = 'upload-progress';
        progressBar.innerHTML = `
            <div style="display:flex; align-items:center; gap:10px;">
                <i class="fas fa-upload" style="color:var(--accent)"></i>
                <span>Publication en cours...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="upload-progress-fill"></div>
            </div>
        `;
        document.body.appendChild(progressBar);
        
        // Simuler l'upload avec progression
        let progress = 0;
        const interval = setInterval(() => {
            progress += 10;
            document.getElementById('upload-progress-fill').style.width = progress + '%';
            
            if(progress >= 100) {
                clearInterval(interval);
                
                // CrÃ©er le post
                let content = '';
                
                if(type === 'youtube' && this.state.youtubeVideoUrl) {
                    content = this.state.youtubeVideoUrl;
                } else if(this.state.compressedVideoReady) {
                    content = URL.createObjectURL(this.state.compressedVideoReady);
                } else if(this.state.currentUploadFile) {
                    content = URL.createObjectURL(this.state.currentUploadFile);
                } else {
                    // Utiliser une vidÃ©o YouTube par dÃ©faut
                    const randomVideo = this.state.youtubeVideos[Math.floor(Math.random() * this.state.youtubeVideos.length)];
                    content = `https://www.youtube.com/embed/${randomVideo.id}`;
                }
                
                const newPost = {
                    id: Date.now(),
                    author: this.state.session.pseudo,
                    authorPfp: this.state.session.pfp,
                    title: title,
                    type: type,
                    content: content,
                    likes: 0,
                    likedBy: [],
                    comments: 0,
                    shares: 0,
                    views: 0,
                    timestamp: new Date().toISOString(),
                    tags: tags.split(',').map(tag => tag.trim()),
                    estimatedSubs: estimatedSubs
                };
                
                // Si c'est une vidÃ©o YouTube, sauvegarder l'ID
                if(type === 'youtube' && content.includes('youtube.com/embed/')) {
                    const match = content.match(/embed\/([a-zA-Z0-9_-]+)/);
                    if(match) {
                        newPost.youtubeId = match[1];
                    }
                }
                
                this.state.posts.unshift(newPost);
                this.sync();
                
                // Ajouter des abonnÃ©s Ã  l'utilisateur
                this.addSubscribers(this.state.session.pseudo, estimatedSubs);
                
                // RÃ©initialiser le formulaire
                document.getElementById('up-title').value = '';
                document.getElementById('up-tags').value = '';
                document.getElementById('upload-preview').innerHTML = '';
                document.getElementById('upload-preview').classList.add('hidden');
                document.getElementById('upload-dropzone').innerHTML = `
                    <i class="fas fa-cloud-upload-alt" style="font-size: 50px; color: var(--accent); margin-bottom: 15px;"></i>
                    <p style="margin: 0; font-weight: 700; font-size: 18px;">Importer un fichier</p>
                    <p style="margin: 10px 0 0; font-size: 14px; color: var(--text-dim);">VidÃ©o, photo ou RShort</p>
                `;
                document.getElementById('youtube-link').value = '';
                document.getElementById('estimated-subs').innerText = '+0';
                
                this.state.currentUploadFile = null;
                this.state.compressedVideoReady = null;
                this.state.youtubeVideoUrl = null;
                
                btnText.innerText = "PUBLIER";
                loader.style.display = 'none';
                
                // Supprimer la barre de progression
                setTimeout(() => {
                    progressBar.remove();
                }, 1000);
                
                this.addXP(30);
                this.notify(`ðŸŽ‰ Publication rÃ©ussie ! +${estimatedSubs} abonnÃ©s gagnÃ©s !`, "success");
                this.go('home');
            }
        }, 100);
    },

    // DRAG AND DROP SYSTEM
    setupDragAndDrop() {
        const dropzone = document.getElementById('upload-dropzone');
        const compressorDropzone = document.getElementById('compressor-dropzone');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            [dropzone, compressorDropzone].forEach(zone => {
                if (zone) {
                    zone.addEventListener(eventName, preventDefaults, false);
                }
            });
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        function highlight(e) {
            e.currentTarget.style.borderColor = 'var(--accent)';
            e.currentTarget.style.background = 'var(--accent-soft)';
        }
        
        function unhighlight(e) {
            e.currentTarget.style.borderColor = 'var(--border)';
            e.currentTarget.style.background = '';
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropzone?.addEventListener(eventName, highlight, false);
            compressorDropzone?.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropzone?.addEventListener(eventName, unhighlight, false);
            compressorDropzone?.addEventListener(eventName, unhighlight, false);
        });
        
        dropzone?.addEventListener('drop', handleDrop, false);
        compressorDropzone?.addEventListener('drop', handleCompressorDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('video/') || file.type.startsWith('image/')) {
                    // Simuler un changement sur l'input file
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    document.getElementById('file-upload').files = dataTransfer.files;
                    
                    // DÃ©clencher l'Ã©vÃ©nement change
                    const event = new Event('change', { bubbles: true });
                    document.getElementById('file-upload').dispatchEvent(event);
                }
            }
        }
        
        function handleCompressorDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('video/')) {
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    document.getElementById('compressor-input').files = dataTransfer.files;
                    
                    const event = new Event('change', { bubbles: true });
                    document.getElementById('compressor-input').dispatchEvent(event);
                }
            }
        }
    },

    // FONCTIONS UTILITAIRES
    formatNumber(num) {
        if(num >= 1000000) return (num/1000000).toFixed(1) + 'M';
        if(num >= 1000) return (num/1000).toFixed(1) + 'k';
        return num;
    },

    formatTime(timestamp) {
        const now = new Date();
        const postDate = new Date(timestamp);
        const diff = now - postDate;
        const hours = Math.floor(diff / 3600000);
        
        if(hours < 1) return "Ã€ l'instant";
        if(hours < 24) return `Il y a ${hours}h`;
        return `${Math.floor(hours/24)}j`;
    },

    notify(msg, type = "success") {
        const box = document.getElementById('notification-box');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        toast.innerHTML = `
            <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
            <div>
                <p style="margin:0; font-size:14px;">${msg}</p>
            </div>
        `;
        
        box.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'slideInRight 0.5s ease reverse';
            setTimeout(() => toast.remove(), 500);
        }, 3000);
    },

    // FONCTIONS DE NAVIGATION
    go(sec) {
        document.querySelectorAll('.app-section').forEach(s => s.classList.add('hidden'));
        document.getElementById('sec-' + sec).classList.remove('hidden');
        
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        
        const navIndexes = { home: 0, rsshort: 1, upload: 2, compressor: 3, aichat: 4, profile: 5 };
        if(navIndexes[sec] !== undefined) {
            document.querySelectorAll('.nav-item')[navIndexes[sec]].classList.add('active');
        }
        
        document.getElementById('fab-upload-btn').classList.toggle('active', sec === 'upload');
        
        if(sec === 'rsshort') {
            this.renderRshorts();
        } else if(sec === 'aichat') {
            this.addXP(2); // XP pour avoir visitÃ© le chat IA
        }
        
        this.state.activeSection = sec;
    },

    // FONCTIONS D'AUTHENTIFICATION
    toggleAuth(tab) {
        this.state.currentTab = tab;
        document.getElementById('tab-login').classList.toggle('active', tab === 'login');
        document.getElementById('tab-signup').classList.toggle('active', tab === 'signup');
        document.getElementById('signup-profile-setup').classList.toggle('hidden', tab === 'login');
        document.getElementById('auth-btn-text').innerText = tab === 'login' ? 'SE CONNECTER' : 'CRÃ‰ER MON COMPTE';
    },

    executeAuth() {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-pass').value;
        const pseudo = document.getElementById('reg-pseudo') ? document.getElementById('reg-pseudo').value : '';
        
        if(!email || !pass) {
            this.showAuthMessage("âŒ Veuillez remplir tous les champs");
            return;
        }
        
        if(this.state.currentTab === 'signup' && (!pseudo || pseudo.length < 3)) {
            this.showAuthMessage("âŒ Le pseudo doit faire au moins 3 caractÃ¨res");
            return;
        }
        
        if(pass.length < 6) {
            this.showAuthMessage("âŒ Le mot de passe doit faire au moins 6 caractÃ¨res");
            return;
        }
        
        const loader = document.getElementById('auth-loader');
        const btnText = document.getElementById('auth-btn-text');
        
        btnText.innerText = 'CHARGEMENT...';
        loader.style.display = 'block';
        
        setTimeout(() => {
            if(this.state.currentTab === 'login') {
                const user = this.state.users.find(u => u.email === email && u.pass === pass);
                if(user) {
                    this.state.session = user;
                    localStorage.setItem('rt_v5_session', JSON.stringify(user));
                    this.launch();
                } else {
                    this.showAuthMessage("âŒ Identifiants incorrects");
                }
            } else {
                // Inscription - COMMENCE Ã€ 0 ABONNÃ‰S
                const newUser = {
                    id: Date.now(),
                    pseudo: pseudo,
                    email: email,
                    pass: pass,
                    pfp: this.state.selectedPfp,
                    bio: "Nouvel utilisateur Rasstube ðŸš€",
                    followers: 0, // COMMENCE Ã€ 0
                    following: 0,
                    flameDays: 0, // COMMENCE Ã€ 0 FLAMMES
                    flameProgress: 0,
                    postsCount: 0,
                    joined: new Date().toLocaleDateString('fr-FR')
                };
                
                this.state.users.push(newUser);
                this.state.session = newUser;
                localStorage.setItem('rt_v5_session', JSON.stringify(newUser));
                localStorage.setItem('rt_v5_users', JSON.stringify(this.state.users));
                
                this.launch();
            }
            
            btnText.innerText = this.state.currentTab === 'login' ? 'SE CONNECTER' : 'CRÃ‰ER MON COMPTE';
            loader.style.display = 'none';
        }, 1500);
    },

    showAuthMessage(msg) {
        const elem = document.getElementById('auth-msg');
        elem.innerText = msg;
        elem.style.display = 'block';
        setTimeout(() => { elem.style.display = 'none'; }, 3000);
    },

    // AUTRES FONCTIONS
    verifySession() {
        if(this.state.session && this.state.session.pseudo) {
            this.launch();
        }
    },

    sync() {
        localStorage.setItem('rt_v5_users', JSON.stringify(this.state.users));
        localStorage.setItem('rt_v5_posts', JSON.stringify(this.state.posts));
        localStorage.setItem('rt_subscribers', JSON.stringify(this.state.subscribers));
    },

    updateProfileStats() {
        const userPosts = this.state.posts.filter(p => p.author === this.state.session.pseudo);
        document.getElementById('count-posts').innerText = userPosts.length;
        document.getElementById('count-followers').innerText = this.state.session.followers || 0;
        document.getElementById('count-following').innerText = this.state.session.following || 0;
        
        // Mettre Ã  jour les flammes dans le profil
        this.updateFlameSystem();
    },

    renderStories() {
        const container = document.getElementById('story-container');
        const stories = this.state.users.slice(0, 8);
        
        container.innerHTML = stories.map(user => `
            <div class="story-card" onclick="App.viewStory('${user.pseudo}')">
                <div class="story-ring">
                    <img src="${user.pfp}" alt="${user.pseudo}">
                </div>
                <div class="story-label">${user.pseudo}</div>
                ${user.flameDays > 0 ? `<div style="position:absolute; top:-5px; right:0; background:#FF8A00; color:white; width:18px; height:18px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:10px; font-weight:700;">${user.flameDays}</div>` : ''}
            </div>
        `).join('');
    },

    renderFeed() {
        const container = document.getElementById('main-feed');
        const posts = this.state.posts.slice(0, 10);
        
        container.innerHTML = posts.map(post => `
            <div class="explore-card" onclick="App.viewPost(${post.id})">
                ${post.type === 'youtube' ? `
                    <div class="youtube-player-container">
                        <img src="https://img.youtube.com/vi/${post.youtubeId || 'dQw4w9WgXcQ'}/maxresdefault.jpg" class="youtube-thumbnail">
                        <div class="youtube-play-button">
                            <i class="fas fa-play"></i>
                        </div>
                        <div style="position:absolute; bottom:10px; right:10px; background:rgba(0,0,0,0.8); color:white; padding:2px 6px; border-radius:3px; font-size:11px;">
                            <i class="fab fa-youtube"></i> YouTube
                        </div>
                    </div>
                ` : `
                    <img src="${post.type === 'photo' ? post.content : 'https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'}" class="explore-thumbnail">
                `}
                <div class="explore-info">
                    <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                        <img src="${post.authorPfp}" style="width:30px; height:30px; border-radius:50%;">
                        <span style="font-weight:600;">${post.author}</span>
                        ${post.estimatedSubs ? `<span class="subscriber-badge">+${post.estimatedSubs}</span>` : ''}
                    </div>
                    <p style="margin:0 0 10px 0; font-size:14px;">${post.title}</p>
                    <div style="display:flex; justify-content:space-between; font-size:12px; color:var(--text-dim);">
                        <span><i class="fas fa-heart"></i> ${this.formatNumber(post.likes)}</span>
                        <span><i class="fas fa-comment"></i> ${this.formatNumber(post.comments)}</span>
                        <span><i class="fas fa-eye"></i> ${this.formatNumber(post.views)}</span>
                    </div>
                </div>
            </div>
        `).join('');
    },

    renderAvatars() {
        const container = document.getElementById('default-avatars');
        const avatars = [
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Rass',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Alex',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Max',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Emma',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Lucas',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Chloe',
            'https://api.dicebear.com/7.x/avataaars/svg?seed=Leo'
        ];
        
        container.innerHTML = avatars.map((avatar, index) => `
            <div class="pfp-item ${index === 0 ? 'selected' : ''}" onclick="App.selectPfp('${avatar}')">
                <img src="${avatar}" alt="Avatar ${index + 1}">
            </div>
        `).join('');
    },

    selectPfp(url) {
        this.state.selectedPfp = url;
        document.getElementById('auth-pfp-preview').src = url;
        document.querySelectorAll('.pfp-item').forEach(item => item.classList.remove('selected'));
        event.target.closest('.pfp-item').classList.add('selected');
    },

    handlePfpFile(e) {
        const file = e.target.files[0];
        if(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                this.state.selectedPfp = e.target.result;
                document.getElementById('auth-pfp-preview').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    },

    triggerPfpUpload() {
        document.getElementById('real-pfp-input').click();
    },

    editProfile() {
        const newBio = prompt("Entrez votre nouvelle bio:", this.state.session.bio);
        if(newBio !== null) {
            this.state.session.bio = newBio;
            document.getElementById('prof-bio').innerText = newBio;
            this.sync();
            this.notify("âœ… Bio mise Ã  jour", "success");
        }
    },

    showNotifications() {
        this.notify("ðŸŽ‰ 3 nouvelles notifications !", "info");
        this.addXP(2);
    },

    showMessages() {
        this.notify("ðŸ’¬ Messages bientÃ´t disponibles !", "info");
    },

    switchProfileTab(tab) {
        this.state.profileTab = tab;
        document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        
        if(tab === 'posts') {
            this.renderProfilePosts();
        } else if(tab === 'rshorts') {
            this.renderProfileRshorts();
        } else if(tab === 'youtube') {
            this.renderProfileYouTube();
        }
    },

    renderProfilePosts() {
        const container = document.getElementById('profile-grid');
        const userPosts = this.state.posts.filter(p => p.author === this.state.session.pseudo);
        
        container.innerHTML = userPosts.map(post => `
            <div class="photo-item" onclick="App.viewPost(${post.id})">
                <img src="${post.type === 'photo' ? post.content : 'https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'}" alt="Post">
                ${post.estimatedSubs ? `<div style="position:absolute; bottom:5px; right:5px; background:var(--accent); color:white; padding:2px 6px; border-radius:3px; font-size:10px; font-weight:700;">+${post.estimatedSubs}</div>` : ''}
            </div>
        `).join('');
    },

    renderProfileRshorts() {
        const container = document.getElementById('profile-grid');
        const userRshorts = this.state.posts.filter(p => p.author === this.state.session.pseudo && p.type === 'rshort');
        
        if(userRshorts.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align:center; padding:40px;">
                    <i class="fas fa-play-circle" style="font-size:50px; color:var(--text-dim); margin-bottom:15px;"></i>
                    <p style="color:var(--text-dim);">Aucun RShort publiÃ©</p>
                </div>
            `;
        } else {
            container.innerHTML = userRshorts.map(post => `
                <div class="photo-item" onclick="App.viewPost(${post.id})">
                    <img src="https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="RShort">
                    <div style="position:absolute; bottom:5px; right:5px; background:rgba(0,0,0,0.7); color:white; padding:2px 6px; border-radius:3px; font-size:10px;">
                        <i class="fas fa-play"></i>
                    </div>
                </div>
            `).join('');
        }
    },

    renderProfileYouTube() {
        const container = document.getElementById('profile-grid');
        const userYouTube = this.state.posts.filter(p => p.author === this.state.session.pseudo && p.type === 'youtube');
        
        if(userYouTube.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align:center; padding:40px;">
                    <i class="fab fa-youtube" style="font-size:50px; color:var(--text-dim); margin-bottom:15px;"></i>
                    <p style="color:var(--text-dim);">Aucune vidÃ©o YouTube importÃ©e</p>
                </div>
            `;
        } else {
            container.innerHTML = userYouTube.map(post => `
                <div class="photo-item" onclick="App.viewPost(${post.id})">
                    <img src="https://img.youtube.com/vi/${post.youtubeId || 'dQw4w9WgXcQ'}/maxresdefault.jpg" alt="YouTube">
                    <div style="position:absolute; bottom:5px; right:5px; background:var(--youtube-red); color:white; padding:2px 6px; border-radius:3px; font-size:10px;">
                        <i class="fab fa-youtube"></i>
                    </div>
                </div>
            `).join('');
        }
    },

    viewStory(user) {
        this.notify(`ðŸ“– Story de ${user}`, "info");
        this.addXP(1);
    },

    viewPost(id) {
        const post = this.state.posts.find(p => p.id === id);
        if(post) {
            if(post.type === 'rshort' || post.type === 'youtube') {
                this.go('rsshort');
                setTimeout(() => {
                    const rshorts = this.state.posts.filter(p => p.type === 'rshort' || p.type === 'youtube');
                    const index = rshorts.findIndex(p => p.id === id);
                    if(index !== -1) {
                        this.state.currentRshort = index;
                        this.renderRshorts();
                    }
                }, 100);
            } else {
                alert(`Voir le post: ${post.title}\n\nAuteur: ${post.author}\n\nAbonnÃ©s gagnÃ©s: +${post.estimatedSubs || 0}`);
            }
        }
    },

    focusComment(id) {
        this.notify("ðŸ’¬ Section commentaires bientÃ´t disponible", "info");
    },

    filterContent(query) {
        if(query.length > 0) {
            this.notify(`ðŸ” Recherche: ${query}`, "info");
        }
    }
};

// GESTION DES GESTES POUR RSSHORT
let startY = 0;
document.addEventListener('touchstart', (e) => {
    if(App.state.activeSection === 'rsshort') {
        startY = e.touches[0].clientY;
    }
});

document.addEventListener('touchend', (e) => {
    if(App.state.activeSection === 'rsshort') {