<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RASSTUBE SOCIAL | Plateforme Vid√©o Communautaire</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ===== VARIABLES ===== */
        :root {
            --primary: #FF2A2A;
            --secondary: #8A2BE2;
            --accent: #FF1493;
            --dark: #0a0a0a;
            --darker: #000000;
            --light: #ffffff;
            --gray: #aaaaaa;
            --success: #32CD32;
            --card-bg: #1a1a1a;
            --hover-bg: #252525;
        }

        /* ===== RESET ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark);
            color: var(--light);
            line-height: 1.6;
        }

        /* ===== LAYOUT ===== */
        .app {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            background: var(--darker);
            border-right: 1px solid rgba(255,255,255,0.1);
            position: fixed;
            width: 280px;
            height: 100vh;
            padding: 20px 0;
            overflow-y: auto;
        }

        .logo {
            padding: 0 20px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .logo i {
            font-size: 28px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(138, 43, 226, 0.1);
            color: var(--light);
            border-left: 3px solid var(--primary);
        }

        .section-title {
            padding: 20px 20px 10px;
            color: var(--gray);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ===== HEADER ===== */
        .header {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .search-box {
            flex: 1;
            display: flex;
            max-width: 600px;
        }

        .search-input {
            flex: 1;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 12px 20px;
            color: var(--light);
            border-radius: 25px 0 0 25px;
            outline: none;
        }

        .search-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            padding: 0 25px;
            border-radius: 0 25px 25px 0;
            cursor: pointer;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
        }

        .upload-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            margin-left: 280px;
            padding: 30px;
        }

        /* ===== FEED ===== */
        .feed {
            max-width: 800px;
            margin: 0 auto;
        }

        .create-post {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .post-input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--light);
            font-size: 16px;
            margin-bottom: 15px;
            resize: none;
            outline: none;
        }

        .post-actions {
            display: flex;
            gap: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 15px;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.05);
            border: none;
            color: var(--gray);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .post-action:hover {
            background: rgba(255,42,42,0.1);
            color: var(--light);
        }

        /* ===== POSTS ===== */
        .post {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .post-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
        }

        .post-user {
            flex: 1;
        }

        .post-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .post-time {
            color: var(--gray);
            font-size: 14px;
        }

        .post-content {
            margin-bottom: 15px;
        }

        .post-video {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .post-video video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-image {
            width: 100%;
            max-height: 500px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .post-image img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        .post-stats {
            display: flex;
            gap: 20px;
            color: var(--gray);
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .post-actions-bar {
            display: flex;
            gap: 10px;
            padding-top: 15px;
        }

        .post-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: transparent;
            border: none;
            color: var(--gray);
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .post-btn:hover {
            background: rgba(255,255,255,0.05);
            color: var(--light);
        }

        .post-btn.liked {
            color: var(--primary);
        }

        /* ===== CHAT ===== */
        .chat-container {
            position: fixed;
            bottom: 0;
            right: 30px;
            width: 350px;
            height: 500px;
            background: var(--darker);
            border-radius: 15px 15px 0 0;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .chat-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .online-count {
            background: var(--success);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        .chat-close {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 15px;
            border-radius: 15px;
            position: relative;
        }

        .message.received {
            align-self: flex-start;
            background: rgba(255,255,255,0.05);
            border-bottom-left-radius: 5px;
        }

        .message.sent {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-bottom-right-radius: 5px;
        }

        .message-sender {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .message-text {
            word-wrap: break-word;
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }

        .chat-input-area {
            padding: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 12px 20px;
            border-radius: 25px;
            color: var(--light);
            outline: none;
        }

        .chat-send {
            background: var(--primary);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
        }

        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: var(--gray);
            font-size: 20px;
            cursor: pointer;
        }

        .modal-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--light);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-input {
            width: 100%;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            color: var(--light);
            outline: none;
        }

        .form-input:focus {
            border-color: var(--primary);
        }

        .file-upload {
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: var(--primary);
            background: rgba(255,42,42,0.05);
        }

        .file-upload i {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--gray);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255,42,42,0.2);
        }

        /* ===== PROFILE ===== */
        .profile-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid rgba(255,255,255,0.2);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .profile-stats {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            color: var(--gray);
            font-size: 14px;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .app {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
                z-index: 1000;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1001;
                background: var(--primary);
                color: white;
                border: none;
                width: 50px;
                height: 50px;
                border-radius: 10px;
                font-size: 20px;
            }
            
            .chat-container {
                right: 20px;
                bottom: 20px;
                height: 400px;
            }
        }

        .menu-toggle {
            display: none;
        }

        /* ===== NOTIFICATIONS ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: slideIn 0.3s;
            display: none;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* ===== LOADING ===== */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- NOTIFICATION -->
    <div class="notification" id="notification"></div>

    <!-- MODAL LOGIN/REGISTER -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('authModal')">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="modal-title" id="modalTitle">Connexion</h2>
            
            <div class="form-group">
                <input type="text" class="form-input" id="authUsername" placeholder="Nom d'utilisateur">
            </div>
            
            <div class="form-group">
                <input type="password" class="form-input" id="authPassword" placeholder="Mot de passe">
            </div>
            
            <div class="form-group" id="confirmGroup" style="display: none;">
                <input type="password" class="form-input" id="authConfirm" placeholder="Confirmer le mot de passe">
            </div>
            
            <div class="form-group" id="emailGroup" style="display: none;">
                <input type="email" class="form-input" id="authEmail" placeholder="Email">
            </div>
            
            <button class="btn-primary" onclick="handleAuth()" id="authButton">Se connecter</button>
            
            <div style="text-align: center; margin-top: 20px; color: var(--gray);">
                <span id="switchText">Pas de compte ?</span>
                <a href="#" style="color: var(--primary);" onclick="switchAuthMode()" id="switchLink">S'inscrire</a>
            </div>
        </div>
    </div>

    <!-- MODAL UPLOAD -->
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('uploadModal')">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="modal-title">Publier une vid√©o</h2>
            
            <div class="form-group">
                <input type="text" class="form-input" id="postTitle" placeholder="Titre de la vid√©o">
            </div>
            
            <div class="form-group">
                <textarea class="form-input" id="postDescription" placeholder="Description" rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <div class="file-upload" onclick="document.getElementById('videoInput').click()">
                    <i class="fas fa-video"></i>
                    <p>Cliquez pour s√©lectionner une vid√©o</p>
                    <p style="font-size: 12px; color: var(--gray);">MP4, AVI, MOV jusqu'√† 500MB</p>
                </div>
                <input type="file" id="videoInput" accept="video/*" style="display: none;" onchange="handleVideoUpload(event)">
            </div>
            
            <div class="form-group">
                <div class="file-upload" onclick="document.getElementById('imageInput').click()">
                    <i class="fas fa-image"></i>
                    <p>Cliquez pour s√©lectionner une miniature</p>
                    <p style="font-size: 12px; color: var(--gray);">JPG, PNG jusqu'√† 10MB</p>
                </div>
                <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
            </div>
            
            <div id="uploadPreview" style="display: none; margin-bottom: 20px;">
                <video id="videoPreview" controls style="width: 100%; border-radius: 10px; display: none;"></video>
                <img id="imagePreview" style="width: 100%; border-radius: 10px; display: none;">
            </div>
            
            <button class="btn-primary" onclick="publishPost()" id="publishButton">Publier</button>
        </div>
    </div>

    <!-- BOUTON MENU MOBILE -->
    <button class="menu-toggle" onclick="toggleMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- APPLICATION -->
    <div class="app">
        <!-- SIDEBAR -->
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <i class="fas fa-satellite-dish"></i>
                <span>RASSTUBE</span>
            </div>
            
            <div class="nav-item active" onclick="loadFeed()">
                <i class="fas fa-home"></i>
                <span>Fil d'actualit√©</span>
            </div>
            
            <div class="nav-item" onclick="loadProfile()">
                <i class="fas fa-user"></i>
                <span>Mon profil</span>
            </div>
            
            <div class="nav-item" onclick="showUploadModal()">
                <i class="fas fa-upload"></i>
                <span>Uploader</span>
            </div>
            
            <div class="section-title">Communaut√©</div>
            
            <div class="nav-item" onclick="loadCommunity()">
                <i class="fas fa-users"></i>
                <span>D√©couvrir</span>
            </div>
            
            <div class="nav-item" onclick="toggleChat()">
                <i class="fas fa-comments"></i>
                <span>Chat</span>
            </div>
            
            <div class="section-title">Param√®tres</div>
            
            <div class="nav-item" onclick="showSettings()">
                <i class="fas fa-cog"></i>
                <span>Param√®tres</span>
            </div>
            
            <div class="nav-item" onclick="logout()" style="color: var(--primary);">
                <i class="fas fa-sign-out-alt"></i>
                <span>D√©connexion</span>
            </div>
        </div>

        <!-- HEADER -->
        <div class="header">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="Rechercher des vid√©os, amis...">
                <button class="search-btn" onclick="searchContent()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <div class="user-actions">
                <button class="upload-btn" onclick="showUploadModal()">
                    <i class="fas fa-plus"></i>
                    <span>Uploader</span>
                </button>
                <div id="userAvatar" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer;" onclick="loadProfile()">
                    ?
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="feed" id="mainContent">
                <!-- Contenu dynamique -->
            </div>
        </div>

        <!-- CHAT -->
        <div class="chat-container" id="chatContainer" style="display: none;">
            <div class="chat-header">
                <div class="chat-title">
                    <i class="fas fa-comments"></i>
                    <span>Chat Communaut√©</span>
                    <span class="online-count" id="onlineCount">0 en ligne</span>
                </div>
                <button class="chat-close" onclick="toggleChat()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <!-- Messages de chat -->
            </div>
            
            <div class="chat-input-area">
                <input type="text" class="chat-input" id="chatInput" placeholder="√âcrire un message...">
                <button class="chat-send" onclick="sendChatMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== BASE DE DONN√âES SIMUL√âE =====
        let database = {
            users: [],
            posts: [],
            messages: [],
            currentUser: null
        };

        // ===== UTILISATEURS PAR D√âFAUT =====
        const defaultUsers = [
            {
                id: 1,
                username: "AlexGamer",
                avatar: "A",
                color: "#FF6B6B",
                followers: 1250,
                following: 342,
                posts: 45,
                isOnline: true
            },
            {
                id: 2,
                username: "SarahMusic",
                avatar: "S",
                color: "#4ECDC4",
                followers: 890,
                following: 215,
                posts: 32,
                isOnline: true
            },
            {
                id: 3,
                username: "MaxTech",
                avatar: "M",
                color: "#FFD166",
                followers: 2100,
                following: 421,
                posts: 78,
                isOnline: false
            },
            {
                id: 4,
                username: "EmmaStyle",
                avatar: "E",
                color: "#EF476F",
                followers: 1560,
                following: 289,
                posts: 56,
                isOnline: true
            },
            {
                id: 5,
                username: "TomSports",
                avatar: "T",
                color: "#118AB2",
                followers: 950,
                following: 178,
                posts: 29,
                isOnline: true
            }
        ];

        // ===== POSTS PAR D√âFAUT =====
        const defaultPosts = [
            {
                id: 1,
                userId: 1,
                username: "AlexGamer",
                userAvatar: "A",
                userColor: "#FF6B6B",
                title: "Gameplay Fortnite - Victoire Royale !",
                content: "Nouveau record personnel avec 18 √©liminations ! üî•",
                videoUrl: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
                thumbnail: "",
                likes: 245,
                comments: 32,
                shares: 15,
                timestamp: "Il y a 2 heures",
                type: "video"
            },
            {
                id: 2,
                userId: 2,
                username: "SarahMusic",
                userAvatar: "S",
                userColor: "#4ECDC4",
                title: "Cover - Shape of You",
                content: "J'ai essay√© de faire ma version de cette chanson iconique ! üéµ",
                videoUrl: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
                thumbnail: "",
                likes: 189,
                comments: 24,
                shares: 8,
                timestamp: "Il y a 5 heures",
                type: "video"
            },
            {
                id: 3,
                userId: 4,
                username: "EmmaStyle",
                userAvatar: "E",
                userColor: "#EF476F",
                title: "Nouvelle collection printemps",
                content: "D√©couvrez mes derni√®res cr√©ations fashion ! üëó‚ú®",
                videoUrl: "",
                thumbnail: "https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=800&auto=format&fit=crop",
                likes: 312,
                comments: 45,
                shares: 21,
                timestamp: "Il y a 1 jour",
                type: "image"
            },
            {
                id: 4,
                userId: 5,
                username: "TomSports",
                userAvatar: "T",
                userColor: "#118AB2",
                title: "Entra√Ænement matinal",
                content: "Routine sportive pour commencer la journ√©e en forme ! üí™",
                videoUrl: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
                thumbnail: "",
                likes: 167,
                comments: 19,
                shares: 12,
                timestamp: "Il y a 2 jours",
                type: "video"
            }
        ];

        // ===== MESSAGES DE CHAT PAR D√âFAUT =====
        const defaultMessages = [
            { userId: 1, username: "AlexGamer", text: "Salut tout le monde ! Qui est l√† ?", time: "14:30" },
            { userId: 2, username: "SarahMusic", text: "Coucou Alex ! Je viens de poster une nouvelle vid√©o", time: "14:32" },
            { userId: 4, username: "EmmaStyle", text: "Moi aussi j'ai upload√© ma nouvelle collection", time: "14:35" },
            { userId: 5, username: "TomSports", text: "Super ! Je vais regarder √ßa tout de suite", time: "14:40" },
            { userId: 1, username: "AlexGamer", text: "Quelqu'un veut faire une partie de Fortnite ?", time: "14:45" }
        ];

        // ===== INITIALISATION =====
        function initApp() {
            loadDatabase();
            
            if (database.currentUser) {
                showApp();
            } else {
                showLoginModal();
            }
        }

        function loadDatabase() {
            const savedData = localStorage.getItem('rasstube_db');
            
            if (savedData) {
                database = JSON.parse(savedData);
            } else {
                // Initialiser avec les donn√©es par d√©faut
                database.users = defaultUsers;
                database.posts = defaultPosts;
                database.messages = defaultMessages;
                saveDatabase();
            }
        }

        function saveDatabase() {
            localStorage.setItem('rasstube_db', JSON.stringify(database));
        }

        // ===== AUTHENTIFICATION =====
        function showLoginModal() {
            document.getElementById('authModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        let isLoginMode = true;

        function switchAuthMode() {
            isLoginMode = !isLoginMode;
            
            const title = document.getElementById('modalTitle');
            const button = document.getElementById('authButton');
            const switchText = document.getElementById('switchText');
            const switchLink = document.getElementById('switchLink');
            const confirmGroup = document.getElementById('confirmGroup');
            const emailGroup = document.getElementById('emailGroup');
            
            if (isLoginMode) {
                title.textContent = "Connexion";
                button.textContent = "Se connecter";
                switchText.textContent = "Pas de compte ?";
                switchLink.textContent = "S'inscrire";
                confirmGroup.style.display = "none";
                emailGroup.style.display = "none";
            } else {
                title.textContent = "Inscription";
                button.textContent = "Cr√©er un compte";
                switchText.textContent = "D√©j√† un compte ?";
                switchLink.textContent = "Se connecter";
                confirmGroup.style.display = "block";
                emailGroup.style.display = "block";
            }
        }

        function handleAuth() {
            const username = document.getElementById('authUsername').value.trim();
            const password = document.getElementById('authPassword').value.trim();
            
            if (!username || !password) {
                showNotification("Veuillez remplir tous les champs");
                return;
            }
            
            if (isLoginMode) {
                // Connexion
                const user = database.users.find(u => u.username === username);
                
                if (user) {
                    database.currentUser = user;
                    saveDatabase();
                    showApp();
                    closeModal('authModal');
                    showNotification(`Bienvenue ${username} !`);
                } else {
                    showNotification("Utilisateur non trouv√©");
                }
            } else {
                // Inscription
                const confirm = document.getElementById('authConfirm').value.trim();
                const email = document.getElementById('authEmail').value.trim();
                
                if (password !== confirm) {
                    showNotification("Les mots de passe ne correspondent pas");
                    return;
                }
                
                if (database.users.find(u => u.username === username)) {
                    showNotification("Ce nom d'utilisateur existe d√©j√†");
                    return;
                }
                
                const newUser = {
                    id: Date.now(),
                    username: username,
                    avatar: username.charAt(0).toUpperCase(),
                    color: getRandomColor(),
                    followers: 0,
                    following: 0,
                    posts: 0,
                    isOnline: true
                };
                
                database.users.push(newUser);
                database.currentUser = newUser;
                saveDatabase();
                
                showApp();
                closeModal('authModal');
                showNotification(`Compte cr√©√© avec succ√®s, ${username} !`);
                
                // Ajouter un message de bienvenue dans le chat
                const welcomeMessage = {
                    userId: newUser.id,
                    username: "Syst√®me",
                    text: `Bienvenue ${username} dans la communaut√© Rasstube ! üéâ`,
                    time: getCurrentTime()
                };
                database.messages.push(welcomeMessage);
                saveDatabase();
                updateChat();
            }
        }

        function logout() {
            database.currentUser = null;
            saveDatabase();
            showLoginModal();
        }

        // ===== AFFICHAGE PRINCIPAL =====
        function showApp() {
            updateUserAvatar();
            loadFeed();
        }

        function updateUserAvatar() {
            if (database.currentUser) {
                const avatar = document.getElementById('userAvatar');
                avatar.textContent = database.currentUser.avatar;
                avatar.style.background = `linear-gradient(135deg, ${database.currentUser.color}, var(--secondary))`;
            }
        }

        function loadFeed() {
            const content = document.getElementById('mainContent');
            
            let html = `
                <div class="create-post">
                    <textarea class="post-input" id="newPostText" placeholder="Partagez quelque chose avec la communaut√©..."></textarea>
                    <div class="post-actions">
                        <button class="post-action" onclick="showUploadModal()">
                            <i class="fas fa-video"></i>
                            <span>Vid√©o</span>
                        </button>
                        <button class="post-action" onclick="uploadImage()">
                            <i class="fas fa-image"></i>
                            <span>Photo</span>
                        </button>
                        <button class="post-action" onclick="createTextPost()">
                            <i class="fas fa-edit"></i>
                            <span>Texte</span>
                        </button>
                    </div>
                </div>
            `;
            
            // Afficher les posts
            database.posts.forEach(post => {
                html += createPostHtml(post);
            });
            
            content.innerHTML = html;
        }

        function createPostHtml(post) {
            const isLiked = post.likedBy ? post.likedBy.includes(database.currentUser.id) : false;
            
            let mediaHtml = '';
            
            if (post.type === 'video' && post.videoUrl) {
                mediaHtml = `
                    <div class="post-video">
                        <video controls>
                            <source src="${post.videoUrl}" type="video/mp4">
                            Votre navigateur ne supporte pas les vid√©os.
                        </video>
                    </div>
                `;
            } else if (post.type === 'image' && post.thumbnail) {
                mediaHtml = `
                    <div class="post-image">
                        <img src="${post.thumbnail}" alt="${post.title}">
                    </div>
                `;
            }
            
            return `
                <div class="post" id="post-${post.id}">
                    <div class="post-header">
                        <div class="post-avatar" style="background: ${post.userColor}">${post.userAvatar}</div>
                        <div class="post-user">
                            <div class="post-name">${post.username}</div>
                            <div class="post-time">${post.timestamp}</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <h3>${post.title}</h3>
                        <p>${post.content}</p>
                    </div>
                    ${mediaHtml}
                    <div class="post-stats">
                        <span>${post.likes} J'aime</span>
                        <span>${post.comments} Commentaires</span>
                        <span>${post.shares} Partages</span>
                    </div>
                    <div class="post-actions-bar">
                        <button class="post-btn ${isLiked ? 'liked' : ''}" onclick="likePost(${post.id})">
                            <i class="fas fa-thumbs-up"></i>
                            <span>J'aime</span>
                        </button>
                        <button class="post-btn" onclick="commentOnPost(${post.id})">
                            <i class="fas fa-comment"></i>
                            <span>Commenter</span>
                        </button>
                        <button class="post-btn" onclick="sharePost(${post.id})">
                            <i class="fas fa-share"></i>
                            <span>Partager</span>
                        </button>
                    </div>
                </div>
            `;
        }

        // ===== UPLOAD DE VID√âOS =====
        function showUploadModal() {
            if (!database.currentUser) {
                showLoginModal();
                return;
            }
            
            document.getElementById('uploadModal').classList.add('active');
        }

        let selectedVideo = null;
        let selectedImage = null;

        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 500 * 1024 * 1024) { // 500MB
                showNotification("La vid√©o est trop volumineuse (max 500MB)");
                return;
            }
            
            const url = URL.createObjectURL(file);
            selectedVideo = url;
            
            document.getElementById('uploadPreview').style.display = 'block';
            document.getElementById('videoPreview').style.display = 'block';
            document.getElementById('videoPreview').src = url;
            document.getElementById('imagePreview').style.display = 'none';
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 10 * 1024 * 1024) { // 10MB
                showNotification("L'image est trop volumineuse (max 10MB)");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                selectedImage = e.target.result;
                
                document.getElementById('uploadPreview').style.display = 'block';
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('videoPreview').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function publishPost() {
            if (!database.currentUser) return;
            
            const title = document.getElementById('postTitle').value.trim();
            const description = document.getElementById('postDescription').value.trim();
            
            if (!title) {
                showNotification("Veuillez entrer un titre");
                return;
            }
            
            let mediaUrl = selectedVideo || selectedImage;
            if (!mediaUrl) {
                showNotification("Veuillez s√©lectionner une vid√©o ou une image");
                return;
            }
            
            const newPost = {
                id: Date.now(),
                userId: database.currentUser.id,
                username: database.currentUser.username,
                userAvatar: database.currentUser.avatar,
                userColor: database.currentUser.color,
                title: title,
                content: description,
                videoUrl: selectedVideo ? selectedVideo : "",
                thumbnail: selectedImage ? selectedImage : "",
                likes: 0,
                comments: 0,
                shares: 0,
                timestamp: "√Ä l'instant",
                type: selectedVideo ? "video" : "image",
                likedBy: []
            };
            
            database.posts.unshift(newPost);
            saveDatabase();
            
            // Mettre √† jour le compte de posts de l'utilisateur
            const user = database.users.find(u => u.id === database.currentUser.id);
            if (user) {
                user.posts++;
                saveDatabase();
            }
            
            closeModal('uploadModal');
            showNotification("Votre vid√©o a √©t√© publi√©e !");
            loadFeed();
            
            // R√©initialiser
            document.getElementById('postTitle').value = '';
            document.getElementById('postDescription').value = '';
            selectedVideo = null;
            selectedImage = null;
            document.getElementById('uploadPreview').style.display = 'none';
        }

        function uploadImage() {
            document.getElementById('imageInput').click();
        }

        function createTextPost() {
            const text = document.getElementById('newPostText').value.trim();
            if (!text) {
                showNotification("Veuillez √©crire quelque chose");
                return;
            }
            
            const newPost = {
                id: Date.now(),
                userId: database.currentUser.id,
                username: database.currentUser.username,
                userAvatar: database.currentUser.avatar,
                userColor: database.currentUser.color,
                title: "Nouveau post",
                content: text,
                videoUrl: "",
                thumbnail: "",
                likes: 0,
                comments: 0,
                shares: 0,
                timestamp: "√Ä l'instant",
                type: "text",
                likedBy: []
            };
            
            database.posts.unshift(newPost);
            saveDatabase();
            
            document.getElementById('newPostText').value = '';
            showNotification("Post publi√© !");
            loadFeed();
        }

        // ===== INTERACTIONS =====
        function likePost(postId) {
            const post = database.posts.find(p => p.id === postId);
            if (!post) return;
            
            if (!post.likedBy) {
                post.likedBy = [];
            }
            
            const userId = database.currentUser.id;
            const index = post.likedBy.indexOf(userId);
            
            if (index === -1) {
                // Ajouter le like
                post.likedBy.push(userId);
                post.likes++;
            } else {
                // Retirer le like
                post.likedBy.splice(index, 1);
                post.likes--;
            }
            
            saveDatabase();
            
            // Mettre √† jour l'affichage
            const postElement = document.getElementById(`post-${postId}`);
            if (postElement) {
                const likeBtn = postElement.querySelector('.post-btn');
                const stats = postElement.querySelector('.post-stats span:first-child');
                
                if (likeBtn && stats) {
                    likeBtn.classList.toggle('liked');
                    stats.textContent = `${post.likes} J'aime`;
                }
            }
        }

        function commentOnPost(postId) {
            const comment = prompt("√âcrivez votre commentaire :");
            if (comment && comment.trim()) {
                const post = database.posts.find(p => p.id === postId);
                if (post) {
                    post.comments++;
                    saveDatabase();
                    
                    showNotification("Commentaire ajout√© !");
                    
                    // Mettre √† jour l'affichage
                    const postElement = document.getElementById(`post-${postId}`);
                    if (postElement) {
                        const stats = postElement.querySelectorAll('.post-stats span')[1];
                        if (stats) {
                            stats.textContent = `${post.comments} Commentaires`;
                        }
                    }
                }
            }
        }

        function sharePost(postId) {
            const post = database.posts.find(p => p.id === postId);
            if (post) {
                post.shares++;
                saveDatabase();
                
                showNotification("Post partag√© !");
                
                // Mettre √† jour l'affichage
                const postElement = document.getElementById(`post-${postId}`);
                if (postElement) {
                    const stats = postElement.querySelectorAll('.post-stats span')[2];
                    if (stats) {
                        stats.textContent = `${post.shares} Partages`;
                    }
                }
            }
        }

        // ===== PROFIL =====
        function loadProfile() {
            if (!database.currentUser) return;
            
            const content = document.getElementById('mainContent');
            const user = database.currentUser;
            const userPosts = database.posts.filter(p => p.userId === user.id);
            
            let html = `
                <div class="profile-header">
                    <div class="profile-avatar" style="background: ${user.color}">${user.avatar}</div>
                    <div class="profile-info">
                        <h1 class="profile-name">${user.username}</h1>
                        <p style="color: var(--gray);">Membre depuis aujourd'hui</p>
                        <div class="profile-stats">
                            <div class="stat">
                                <span class="stat-value">${userPosts.length}</span>
                                <span class="stat-label">Publications</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value">${user.followers}</span>
                                <span class="stat-label">Abonn√©s</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value">${user.following}</span>
                                <span class="stat-label">Abonnements</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            if (userPosts.length === 0) {
                html += `
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-video-slash" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3>Aucune publication</h3>
                        <p>Commencez par uploader votre premi√®re vid√©o !</p>
                        <button class="upload-btn" style="margin-top: 20px;" onclick="showUploadModal()">
                            <i class="fas fa-plus"></i>
                            <span>Uploader une vid√©o</span>
                        </button>
                    </div>
                `;
            } else {
                userPosts.forEach(post => {
                    html += createPostHtml(post);
                });
            }
            
            content.innerHTML = html;
        }

        // ===== CHAT =====
        let isChatOpen = false;

        function toggleChat() {
            isChatOpen = !isChatOpen;
            const chat = document.getElementById('chatContainer');
            
            if (isChatOpen) {
                chat.style.display = 'flex';
                updateChat();
                updateOnlineCount();
            } else {
                chat.style.display = 'none';
            }
        }

        function updateOnlineCount() {
            const onlineUsers = database.users.filter(u => u.isOnline).length;
            document.getElementById('onlineCount').textContent = `${onlineUsers} en ligne`;
        }

        function updateChat() {
            const messagesContainer = document.getElementById('chatMessages');
            
            let html = '';
            
            database.messages.forEach(msg => {
                const user = database.users.find(u => u.id === msg.userId) || 
                           { username: msg.username, avatar: "?", color: "#666" };
                
                const isCurrentUser = msg.userId === database.currentUser?.id;
                
                html += `
                    <div class="message ${isCurrentUser ? 'sent' : 'received'}">
                        <div class="message-sender">${user.username}</div>
                        <div class="message-text">${msg.text}</div>
                        <div class="message-time">${msg.time}</div>
                    </div>
                `;
            });
            
            messagesContainer.innerHTML = html;
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            
            if (!text || !database.currentUser) return;
            
            const newMessage = {
                userId: database.currentUser.id,
                username: database.currentUser.username,
                text: text,
                time: getCurrentTime()
            };
            
            database.messages.push(newMessage);
            saveDatabase();
            
            input.value = '';
            updateChat();
            
            // Simuler des r√©ponses automatiques
            setTimeout(() => generateAutoResponse(text), 1000 + Math.random() * 2000);
        }

        function generateAutoResponse(userMessage) {
            const onlineUsers = database.users.filter(u => u.isOnline && u.id !== database.currentUser.id);
            
            if (onlineUsers.length === 0) return;
            
            const randomUser = onlineUsers[Math.floor(Math.random() * onlineUsers.length)];
            const responses = [
                "Int√©ressant ! J'aime beaucoup cette id√©e.",
                "Je viens de regarder ta derni√®re vid√©o, c'√©tait g√©nial !",
                "Tu devrais voir ma nouvelle publication aussi.",
                "On pourrait collaborer sur une vid√©o ensemble ?",
                "C'est exactement ce que je pensais !",
                "J'ai une question sur ton dernier upload...",
                "Super discussion !"
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            const autoMessage = {
                userId: randomUser.id,
                username: randomUser.username,
                text: randomResponse,
                time: getCurrentTime()
            };
            
            database.messages.push(autoMessage);
            saveDatabase();
            updateChat();
        }

        // ===== FONCTIONS UTILITAIRES =====
        function getRandomColor() {
            const colors = [
                "#FF6B6B", "#4ECDC4", "#FFD166", "#EF476F", "#118AB2",
                "#8A2BE2", "#32CD32", "#FFA500", "#FF1493", "#00CED1"
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function getCurrentTime() {
            const now = new Date();
            return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        function searchContent() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            if (!query) {
                loadFeed();
                return;
            }
            
            const results = database.posts.filter(post => 
                post.title.toLowerCase().includes(query) || 
                post.content.toLowerCase().includes(query) ||
                post.username.toLowerCase().includes(query)
            );
            
            const content = document.getElementById('mainContent');
            
            if (results.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-search" style="font-size: 48px; color: var(--gray); margin-bottom: 20px;"></i>
                        <h3>Aucun r√©sultat trouv√©</h3>
                        <p style="color: var(--gray);">Essayez d'autres mots-cl√©s</p>
                    </div>
                `;
            } else {
                let html = `<h2 style="margin-bottom: 20px;">R√©sultats pour "${query}"</h2>`;
                results.forEach(post => {
                    html += createPostHtml(post);
                });
                content.innerHTML = html;
            }
        }

        function loadCommunity() {
            const content = document.getElementById('mainContent');
            
            let html = '<h2 style="margin-bottom: 20px;">D√©couvrir la communaut√©</h2>';
            
            database.users.forEach(user => {
                if (user.id !== database.currentUser.id) {
                    html += `
                        <div style="background: var(--card-bg); border-radius: 15px; padding: 20px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px;">
                            <div class="post-avatar" style="background: ${user.color}">${user.avatar}</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">${user.username}</div>
                                <div style="color: var(--gray); font-size: 14px;">${user.posts} publications ‚Ä¢ ${user.followers} abonn√©s</div>
                            </div>
                            <button style="background: var(--primary); color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer;">
                                Suivre
                            </button>
                        </div>
                    `;
                }
            });
            
            content.innerHTML = html;
        }

        function showSettings() {
            showNotification("Param√®tres - Fonctionnalit√© √† venir !");
        }

        // ===== INITIALISER L'APPLICATION =====
        document.addEventListener('DOMContentLoaded', initApp);

        // Simuler des utilisateurs en ligne
        setInterval(() => {
            database.users.forEach(user => {
                if (Math.random() > 0.3) { // 70% de chance d'√™tre en ligne
                    user.isOnline = true;
                }
            });
            if (isChatOpen) {
                updateOnlineCount();
            }
        }, 30000); // Toutes les 30 secondes
    </script>
</body>
</html>